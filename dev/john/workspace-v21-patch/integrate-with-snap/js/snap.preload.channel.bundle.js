/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "../../node_modules/@openfin/snap-sdk/openfin.snap.mjs":
/*!*************************************************************!*\
  !*** ../../node_modules/@openfin/snap-sdk/openfin.snap.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   SnapServer: () => (/* binding */ w)
/* harmony export */ });
var e={827:e=>{var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,i){function a(n){e.removeListener(t,r),i(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",a),n([].slice.call(arguments))}y(e,t,r,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}(e,a,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function p(e,t,n,i){var a,r,o,p;if(s(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),o=r[t]),void 0===o)o=r[t]=n,++e._eventsCount;else if("function"==typeof o?o=r[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(a=c(e))>0&&o.length>a&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,p=l,console&&console.warn&&console.warn(p)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},a=l.bind(i);return a.listener=n,i.wrapFn=a,a}function u(e,t,n){var i=e._events;if(void 0===i)return[];var a=i[t];return void 0===a?[]:"function"==typeof a?n?[a.listener||a]:[a]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(a):f(a,a.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function y(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function a(r){i.once&&e.removeEventListener(t,a),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var a="error"===e,r=this._events;if(void 0!==r)a=a&&void 0===r.error;else if(!a)return!1;if(a){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var p=c.length,l=f(c,p);for(n=0;n<p;++n)i(l[n],this,t)}return!0},r.prototype.addListener=function(e,t){return p(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return p(this,e,t,!0)},r.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,a,r,o;if(s(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(a=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){o=n[r].listener,a=r;break}if(a<0)return this;0===a?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,a),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var a,r=Object.keys(n);for(i=0;i<r.length;++i)"removeListener"!==(a=r[i])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};n.d(i,{q:()=>l});var a=n(827);const r="openfin-snap",o="1.3.0",s=(e,t)=>`${e} ${t instanceof Error?t.message:"string"==typeof t?t:JSON.stringify(t)}`,c=async()=>{try{return(await fin.System.getAppAssetInfo({alias:r})).version===o}catch(e){return!1}},p="internal-generated-window-";class l{constructor(e){if(this.server_id=e,this.emitter=new a.EventEmitter,this.__extensions=[],!fin)throw new Error("OpenFin is not available")}async start(e){try{const e=await fin.System.getRuntimeInfo();"x64"!==e?.architecture&&console.warn(`The architecture of the connected OpenFin runtime is '${e.architecture}' - Window snapping is currently only supported with 64-bit applications. Snapping will be disabled.`)}catch(e){console.warn(`Could not get runtime info: ${e}`)}const t=await fin.System.queryPermissionForCurrentContext("System.launchExternalProcess");if(!t.granted)throw new Error("The 'System.launchExternalProcess' permission is required to launch the Snap server");if(t.rawValue){if(e?.executablePath&&!t.rawValue?.executables?.enabled)throw new Error("The 'System.launchExternalProcess.assets' permission is required to launch the Snap server from an executable path");if(!e?.executablePath&&!t.rawValue?.assets?.enabled)throw new Error("The 'System.launchExternalProcess.assets' permission is required to launch the Snap server from a URL")}e?.executablePath||await(async e=>{const t=await fin.Application.getCurrentSync().getManifest(),n=t.appAssets?.find((e=>e.alias===r));if(n)return void console.warn("Detected Snap package in app manifest appAssets",n);if(await c())return void console.info("Using existing Snap package");const i=e??`https://cdn.openfin.co/release/snap/${o}/snap.zip`;console.info(`Downloading Snap asset from: '${i}'`);const a={alias:r,src:`${i}`,target:"OpenFinSnap.exe",version:o};console.info("Downloading Snap package",a);try{await fin.System.downloadAsset(a,(()=>{}))}catch(e){throw new Error(s("Unable to download Snap package.",e))}})(e?.customSnapAssetSource);const n=await this.build_command_line(e);let i={alias:r,arguments:n,lifetime:"window"};e?.executablePath&&(i={path:e.executablePath,arguments:n,lifetime:"window"});try{this.snap_identity=await fin.System.launchExternalProcess(i)}catch(e){throw new Error(s("Failed to launch the Snap server.",e))}return this.connect()}async connect(){this.client=await fin.InterApplicationBus.Channel.connect(`snap-server-core-${this.server_id}`),this.client.register("snap_handshake",(async(e,t)=>{try{await fin.System.registerUsage({type:"adapter-feature",data:{apiVersion:e.version,componentName:"snap-server"}})}catch{console.warn("SnapSDK: Failed to register usage for Snap Server")}}));try{await fin.System.registerUsage({type:"adapter-feature",data:{apiVersion:"1.3.0",componentName:"snap-client"}})}catch{console.warn("SnapSDK: Failed to register usage for Snap Server")}this.client.register("snap_updates",((e,t)=>this.handleSnapEvents(e,t))),this.__extensions.forEach((e=>e.onConnected(this.client)))}__addExtension(e){this.__extensions.push(e)}async stop(){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"shutdown"}))}async getLayout(){if(!this.client)throw new Error("Snap server is not running");const e=await(this.client?.dispatch("snap_api_invoke",{action:"serialiseLayout"}));return e?.payload.layout}async setLayout(e,t=!0){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"deserialiseLayout",payload:{layout:e,reset:t}}))}async prepareToApplySnapshot(e,t){if(!e||e.options?.closeExistingWindows||e.options?.closeSnapshotWindows)return this.needToResetLayout=!0,void await(this.client?.dispatch("snap_api_invoke",{action:"resetAll"}));this.needToResetLayout=!1;const n=e.snapshot,i=JSON.stringify(n,null,2),a=n.snap;if(!a)return;const r=t??v,o=(await this.getLayout())?.clients.map((e=>e.id))??[],s=f(n.windows),c=Array.from(s.keys()).filter((e=>o.includes(e)));a.clients.filter((e=>c.includes(e.id))).forEach((e=>{const t=e.id,n=r(t);e.id=n,y(a.connections,t,n);const i=s.get(t);i.customData.snapClientId=n,i.name=n}));const p=JSON.stringify(n,null,2);console.debug(`Snap SDK modified snapshot data before applying it.\nOriginal snapshot:\n${i}\nModified snapshot:\n${p}`)}async decorateSnapshot(e){return{...e,snap:await this.getLayout()}}async applySnapshot(e){e.snap&&await this.setLayout(e.snap,this.needToResetLayout)}async launch(e){if(!this.client)throw new Error("Not connected to an Snap server");e.appAssetInfo&&(e.path=await d({target:e.path,...e.appAssetInfo})),console.log("options: ",e);const t={action:"startProcess",payload:{...e,args:e.args||[]}};if(e.strategy){const{type:n,...i}=e.strategy;t.payload.strategy={type:n,parameters:{...i}}}const n=await(this.client?.dispatch("snap_api_invoke",t));if(n?.payload?.success)return{process_id:n.payload.process_id};throw new Error(`Failed to launch process: ${n?.payload?.error}`)}async registerWindow(e,t,n){await(this.client?.dispatch("snap_api_invoke",{action:"hookAndRegisterWindow",payload:{clientId:e,windowHandle:t,resizingBehavior:n}}))}async enableAutoWindowRegistration(){const e=e=>this.handleNewWindow(e);return await fin.Platform.getCurrentSync().addListener("window-created",e),async()=>{await fin.System.removeListener("window-created",e)}}async attachWindows(e,t,n,i){await(this.client?.dispatch("snap_api_invoke",{action:"attach",payload:{targetClientId:e,toAttachClientId:t,targetSide:n,offset:i}}))}async detachFromGroup(e){await(this.client?.dispatch("snap_api_invoke",{action:"detachFromGroup",payload:{clientId:e}}))}async getAttached(e){return(await(this.client?.dispatch("snap_api_invoke",{action:"getAttachedInstances",payload:{clientId:e}}))).payload.attached}async hasAttachments(e){return(await(this.client?.dispatch("snap_api_invoke",{action:"hasAttachments",payload:{clientId:e}}))).payload.hasAttachments}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}once(e,t){this.emitter.once(e,t)}async getGroupIdForWindow(e){const t="number"==typeof e?{nativeWindowId:e}:{clientId:e},n=await(this.client?.dispatch("snap_api_invoke",{action:"getGroupIdForWindow",payload:t}));if(!n.payload.groupId)throw new Error("No group found for window");return n.payload.groupId}async getWindowResizable(e){const t="number"==typeof e?{nativeWindowId:e}:{clientId:e},n=await(this.client?.dispatch("snap_api_invoke",{action:"getResizable",payload:t}));if(null===n.payload.resizable)throw new Error("No window found for given ID");return n.payload.resizable}async setWindowResizable(e,t){const n="number"==typeof e?{nativeWindowId:e,resizable:t}:{clientId:e,resizable:t};await(this.client?.dispatch("snap_api_invoke",{action:"setResizable",payload:n}))}async getWindowsInGroup(e){const t=await(this.client?.dispatch("snap_api_invoke",{action:"getWindowsInGroup",payload:{groupId:e}}));return t.payload.windows?t.payload.windows.map((e=>({nativeId:e[0],clientId:e[1]}))):[]}async getAllGroupIds(){return(await(this.client?.dispatch("snap_api_invoke",{action:"getAllGroupIds"}))).payload.groupIds}async minimizeGroup(e){await(this.client?.dispatch("snap_api_invoke",{action:"minimizeGroup",payload:{groupId:e}}))}async restoreGroup(e){await(this.client?.dispatch("snap_api_invoke",{action:"restoreGroup",payload:{groupId:e}}))}async handleNewWindow(e){const t=await fin.Window.wrap({uuid:e.uuid,name:e.name}),n=await t.getNativeId();let i=t.identity.name;const a=await t.getOptions();if(void 0!==a.includeInSnapshots&&!1===a.includeInSnapshots)return void console.log(`SnapSDK: Not registering ${e.uuid}:${e.name}, Window is explicitly excluded -includeInSnapshots == false`);const r=a.customData||{};r.snapClientId?i=r.snapClientId:await t.updateOptions({customData:{...r,snapClientId:i}}),console.log(`SnapSDK: Auto-registering window: snapClientId:${i}, handle ${n}, uuid:${e.uuid}, name:${e.name}`),await this.registerWindow(i,n,r.snapResizingBehavior)}emit_event(e,...t){this.emitter.emit(e,...t)}handleSnapEvents(e,t){switch(this.emit_event("all-events",{type:e.action,payload:e.payload}),e.action){case"clientRegistered":this.emit_event("client-registered",{clientId:e.payload.clientId,windowHandle:`#${e.payload.windowHandle.toString(16).toUpperCase()}`,owningProcessId:e.payload.owningProcessId});break;case"clientUnRegistered":this.emit_event("client-unregistered",{...e.payload});break;case"moveSizeCompleted":this.emit_event("move-size-completed",{...e.payload});break;case"clientsAttached":this.emit_event("clients-attached",{...e.payload});break;case"clientDetached":this.emit_event("client-detached",{...e.payload});break;case"groupsChanged":this.emit_event("groups-changed",{...e.payload});break;case"clientActivated":this.emit_event("client-activated",{...e.payload});break;case"clientDeactivated":this.emit_event("client-deactivated",{...e.payload})}}async build_command_line(e){let t=`--id ${this.server_id} `;e?.showDebug&&(t+=" --show-debug "),e?.disableGPUAcceleratedDragging&&(t+=" --disable-gpu-accelerated-dragging true "),e?.disableBlurDropPreview&&(t+=" --blur-drop-preview false "),void 0!==e?.blurEffectPerformanceThreshold&&(t+=` --blur-effect-performance-threshold=${e?.blurEffectPerformanceThreshold} `),e?.disableUserUnstick&&(t+=" --disable-user-unstick "),!0!==e?.keyToStick&&"string"!=typeof e?.keyToStick||(t+=` --ks=${!0===e.keyToStick?"ctrl":e.keyToStick} `),e?.keyToUnstick&&(t+=` --kus=${e.keyToUnstick} `),e?.hideTaskbarEntry&&(t+=" --no-tb "),e?.taskbarIconGroup&&(t+=` --tb-id=${e?.taskbarIconGroup} `),e?.taskbarIcon&&(t+=` --tb-icon=${e?.taskbarIcon} `),e?.disableRuntimeHeartbeating&&(t+=" --no-hb "),e?.autoHideClientTaskbarIcons&&(t+=" --tb-auto-hide "),e?.theme&&(t+=` --thm=${e.theme} `),e?.defaultResizingBehavior&&(t+=` --res=${e?.defaultResizingBehavior} `);const n=await fin.System.getRuntimeInfo();return t+=`--runtime-port ${n.port} `,t+=`--runtime-version ${n.version} `,t.trim()}}const d=async e=>{let t=(await fin.System.getRuntimeInfo()).args["local-startup-url"].replace("config.json","");const n=t.includes("\\")?"\\":"/";return t.endsWith(n)&&(t=t.slice(0,-1)),[t,"assets",e.alias,e.version,e.target].join(n)},u=()=>"undefined"!=typeof crypto&&"randomUUID"in crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),h=e=>/^app:\/[^/]+\/[^/]+$/.test(e??""),f=e=>{const t=new Map;return e.forEach((e=>{const n=!e.name,i=e.name?.startsWith(p)??!1,a=e.customData?.snapClientId;(n||i||h(e.name))&&a&&t.set(a,e)})),t},y=(e,t,n)=>{Object.values(e).forEach((e=>{e.attachedClientId===t?e.attachedClientId=n:e.targetClientId===t&&(e.targetClientId=n)}))},v=e=>{if(!h(e))return`${p}${u()}`;const t=e.split("/");return t[t.length-1]=u(),t.join("/")};var w=i.q;

/***/ }),

/***/ "./client/src/preload/preload.common.ts":
/*!**********************************************!*\
  !*** ./client/src/preload/preload.common.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   initialize: () => (/* binding */ initialize)
/* harmony export */ });
/* harmony import */ var _openfin_snap_sdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @openfin/snap-sdk */ "../../node_modules/@openfin/snap-sdk/openfin.snap.mjs");
/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../settings */ "./client/src/settings.ts");


/**
 * Initialize the snap components.
 * @param options The options for initializing the snap provider.
 * @param createLayoutChannel Whether to create a simple channel api service that exposes the getLayout and applyLayout functionality of snap.
 */
async function initialize(options, createLayoutChannel = false) {
    const settings = await (0,_settings__WEBPACK_IMPORTED_MODULE_1__.getSettings)();
    const settingsServerOptions = settings?.serverOptions ?? {};
    const passedOptions = options?.serverOptions ?? {};
    const finalOptions = { ...settingsServerOptions, ...passedOptions };
    const finalPlatformId = options?.platformId ?? settings?.platformId;
    try {
        if (finalPlatformId) {
            console.log("Registering Snap with platformId", finalPlatformId);
            const server = new _openfin_snap_sdk__WEBPACK_IMPORTED_MODULE_0__.SnapServer(finalPlatformId);
            console.log("Enabling debug window:", finalOptions.showDebug ?? false);
            await server.start(finalOptions);
            if (createLayoutChannel) {
                try {
                    const channelName = `${fin.me.identity.uuid}-snap-layout`;
                    console.log(`Channel Service: Creating snap preload layout channel: ${channelName}`);
                    const channel = await fin.InterApplicationBus.Channel.create(channelName);
                    channel.register("getLayout", async () => {
                        console.log("Channel Service: Getting layout from Snap");
                        const layout = await server.getLayout();
                        console.log("Channel Service: Got layout from Snap", layout);
                        return layout;
                    });
                    channel.register("applyLayout", async (payload) => {
                        console.log("Channel Service: Applying layout to Snap", payload);
                        console.log("Channel Service: Preparing to apply snapshot");
                        await server.prepareToApplySnapshot();
                        console.log("Channel Service: Applying snapshot");
                        await server.applySnapshot(payload);
                        console.log("Channel Service: Applied snapshot");
                    });
                    channel.onConnection(async (identity) => {
                        console.log("Channel Service: Connection request from:", identity);
                        // eslint-disable-next-line prefer-template
                        if (identity.uuid !== fin.me.identity.uuid) {
                            const message = `Channel Service: Rejecting connection request as it is not coming from within the application. Identity should be: ${fin.me.identity.uuid} and connection request is coming from: ${identity.uuid}`;
                            console.error(message);
                            throw new Error(message);
                        }
                    });
                    channel.onDisconnection(async (identity) => {
                        console.log("Channel Service: Disconnection request from:", identity);
                    });
                    setTimeout(async () => {
                        try {
                            console.log("Channel Client: Connecting to snap preload layout channel to validate connection.");
                            const clientChannelName = `${fin.me.identity.uuid}-snap-layout`;
                            const snapPreloadClient = await fin.InterApplicationBus.Channel.connect(clientChannelName);
                            // fetch the current snap layout
                            console.log("Channel Client: Requesting layout from Snap");
                            const layout = (await snapPreloadClient.dispatch("getLayout"));
                            console.log("Channel Client: Got layout from Snap", layout);
                            // apply the layout
                            console.log("Channel Client: Applying layout to Snap");
                            await snapPreloadClient.dispatch("applyLayout", layout);
                            console.log("Channel Client: Applied layout to Snap");
                            console.log("Channel Client: Intentionally disconnecting from snap preload Channel Service");
                            await snapPreloadClient.disconnect();
                        }
                        catch (clientError) {
                            console.error("Channel Client: Error connecting to snap preload layout Channel Service", clientError);
                        }
                    }, 1000);
                }
                catch (err) {
                    console.error("Channel Service: Error creating snap layout channel", err);
                }
            }
            const app = fin.Application.getCurrentSync();
            await app.on("window-created", async (e) => {
                const win = fin.Window.wrapSync(e);
                const winOptions = await win.getOptions();
                if (!winOptions.includeInSnapshots) {
                    console.log("Window is not registered with Snap because includeInSnapshots is disabled.");
                }
                else {
                    const nativeId = await win.getNativeId();
                    console.log("Registering window with NativeID with Snap", nativeId);
                    await server.registerWindow(win.identity.name, nativeId);
                }
            });
            const hostOptions = (await fin.me.getOptions());
            if (hostOptions.autoShow) {
                console.log("Registering current window with snap");
                await server.registerWindow(fin.me.identity.name, await fin.Window.getCurrentSync().getNativeId());
            }
            else {
                console.log("Current window is not registered with Snap because autoShow is disabled.");
            }
        }
    }
    catch (err) {
        console.error("Error initializing Snap", err);
    }
}


/***/ }),

/***/ "./client/src/settings.ts":
/*!********************************!*\
  !*** ./client/src/settings.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getSettings: () => (/* binding */ getSettings)
/* harmony export */ });
/**
 * Gets settings from the manifest.
 * @param showDebugWindow Whether to enable the debug window regardless of manifest settings.
 * @returns The snap provider options from the manifest.
 */
async function getSettings(showDebugWindow) {
    const app = await fin.Application.getCurrent();
    const manifest = await app.getManifest();
    if (manifest.appAssets?.[0]?.src === "SNAP_ASSET_URL") {
        console.error("Please request the SNAP_ASSET_URL from OpenFin and update manifest.fin.json before running the sample");
    }
    const settings = await getManifestCustomSettings(manifest);
    settings.snapProvider ??= {};
    if (settings.snapProvider.serverOptions === undefined) {
        settings.snapProvider.serverOptions = {
            showDebug: showDebugWindow
        };
    }
    return settings.snapProvider;
}
/**
 * Read the custom settings from the manifest.fin.json.
 * @param manifest The manifest to load the custom settings from.
 * @returns The custom settings from the manifest.
 */
async function getManifestCustomSettings(manifest) {
    return manifest.customSettings ?? {};
}


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it needs to be isolated against other modules in the chunk.
(() => {
/*!***********************************************!*\
  !*** ./client/src/preload/preload.channel.ts ***!
  \***********************************************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _preload_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./preload.common */ "./client/src/preload/preload.common.ts");

if (window === window.top) {
    console.log("Adding snap support through a preload with layout support.");
    window.addEventListener("DOMContentLoaded", async () => {
        const snapOptions = {
            platformId: fin.me.identity.uuid
        };
        await (0,_preload_common__WEBPACK_IMPORTED_MODULE_0__.initialize)(snapOptions, true);
    });
}

})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dEJBO1dBQ0E7V0FDQTtXQUNBO1dBQ0EseUNBQXlDLHdDQUF3QztXQUNqRjtXQUNBO1dBQ0E7Ozs7O1dDUEE7Ozs7O1dDQUE7V0FDQTtXQUNBO1dBQ0EsdURBQXVELGlCQUFpQjtXQUN4RTtXQUNBLGdEQUFnRCxhQUFhO1dBQzdEOzs7Ozs7Ozs7Ozs7QUNMOEM7QUFFOUMsSUFBSSxNQUFNLEtBQUssTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsNERBQTRELENBQUMsQ0FBQztJQUUxRSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDdEQsTUFBTSxXQUFXLEdBQXdCO1lBQ3hDLFVBQVUsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJO1NBQ2hDLENBQUM7UUFDRixNQUFNLDJEQUFVLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL29wZW5maW4td29ya3NwYWNlLS1pbnRlZ3JhdGUtd2l0aC1zbmFwLy4uLy4uL25vZGVfbW9kdWxlcy9Ab3BlbmZpbi9zbmFwLXNkay9vcGVuZmluLnNuYXAubWpzIiwid2VicGFjazovL29wZW5maW4td29ya3NwYWNlLS1pbnRlZ3JhdGUtd2l0aC1zbmFwLy4vY2xpZW50L3NyYy9wcmVsb2FkL3ByZWxvYWQuY29tbW9uLnRzIiwid2VicGFjazovL29wZW5maW4td29ya3NwYWNlLS1pbnRlZ3JhdGUtd2l0aC1zbmFwLy4vY2xpZW50L3NyYy9zZXR0aW5ncy50cyIsIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vb3BlbmZpbi13b3Jrc3BhY2UtLWludGVncmF0ZS13aXRoLXNuYXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL29wZW5maW4td29ya3NwYWNlLS1pbnRlZ3JhdGUtd2l0aC1zbmFwLy4vY2xpZW50L3NyYy9wcmVsb2FkL3ByZWxvYWQuY2hhbm5lbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZT17ODI3OmU9Pnt2YXIgdCxuPVwib2JqZWN0XCI9PXR5cGVvZiBSZWZsZWN0P1JlZmxlY3Q6bnVsbCxpPW4mJlwiZnVuY3Rpb25cIj09dHlwZW9mIG4uYXBwbHk/bi5hcHBseTpmdW5jdGlvbihlLHQsbil7cmV0dXJuIEZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseS5jYWxsKGUsdCxuKX07dD1uJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBuLm93bktleXM/bi5vd25LZXlzOk9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM/ZnVuY3Rpb24oZSl7cmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGUpLmNvbmNhdChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpKX06ZnVuY3Rpb24oZSl7cmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGUpfTt2YXIgYT1OdW1iZXIuaXNOYU58fGZ1bmN0aW9uKGUpe3JldHVybiBlIT1lfTtmdW5jdGlvbiByKCl7ci5pbml0LmNhbGwodGhpcyl9ZS5leHBvcnRzPXIsZS5leHBvcnRzLm9uY2U9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uKG4saSl7ZnVuY3Rpb24gYShuKXtlLnJlbW92ZUxpc3RlbmVyKHQsciksaShuKX1mdW5jdGlvbiByKCl7XCJmdW5jdGlvblwiPT10eXBlb2YgZS5yZW1vdmVMaXN0ZW5lciYmZS5yZW1vdmVMaXN0ZW5lcihcImVycm9yXCIsYSksbihbXS5zbGljZS5jYWxsKGFyZ3VtZW50cykpfXkoZSx0LHIse29uY2U6ITB9KSxcImVycm9yXCIhPT10JiZmdW5jdGlvbihlLHQsbil7XCJmdW5jdGlvblwiPT10eXBlb2YgZS5vbiYmeShlLFwiZXJyb3JcIix0LG4pfShlLGEse29uY2U6ITB9KX0pKX0sci5FdmVudEVtaXR0ZXI9cixyLnByb3RvdHlwZS5fZXZlbnRzPXZvaWQgMCxyLnByb3RvdHlwZS5fZXZlbnRzQ291bnQ9MCxyLnByb3RvdHlwZS5fbWF4TGlzdGVuZXJzPXZvaWQgMDt2YXIgbz0xMDtmdW5jdGlvbiBzKGUpe2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIGUpdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlIFwibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgRnVuY3Rpb24uIFJlY2VpdmVkIHR5cGUgJyt0eXBlb2YgZSl9ZnVuY3Rpb24gYyhlKXtyZXR1cm4gdm9pZCAwPT09ZS5fbWF4TGlzdGVuZXJzP3IuZGVmYXVsdE1heExpc3RlbmVyczplLl9tYXhMaXN0ZW5lcnN9ZnVuY3Rpb24gcChlLHQsbixpKXt2YXIgYSxyLG8scDtpZihzKG4pLHZvaWQgMD09PShyPWUuX2V2ZW50cyk/KHI9ZS5fZXZlbnRzPU9iamVjdC5jcmVhdGUobnVsbCksZS5fZXZlbnRzQ291bnQ9MCk6KHZvaWQgMCE9PXIubmV3TGlzdGVuZXImJihlLmVtaXQoXCJuZXdMaXN0ZW5lclwiLHQsbi5saXN0ZW5lcj9uLmxpc3RlbmVyOm4pLHI9ZS5fZXZlbnRzKSxvPXJbdF0pLHZvaWQgMD09PW8pbz1yW3RdPW4sKytlLl9ldmVudHNDb3VudDtlbHNlIGlmKFwiZnVuY3Rpb25cIj09dHlwZW9mIG8/bz1yW3RdPWk/W24sb106W28sbl06aT9vLnVuc2hpZnQobik6by5wdXNoKG4pLChhPWMoZSkpPjAmJm8ubGVuZ3RoPmEmJiFvLndhcm5lZCl7by53YXJuZWQ9ITA7dmFyIGw9bmV3IEVycm9yKFwiUG9zc2libGUgRXZlbnRFbWl0dGVyIG1lbW9yeSBsZWFrIGRldGVjdGVkLiBcIitvLmxlbmd0aCtcIiBcIitTdHJpbmcodCkrXCIgbGlzdGVuZXJzIGFkZGVkLiBVc2UgZW1pdHRlci5zZXRNYXhMaXN0ZW5lcnMoKSB0byBpbmNyZWFzZSBsaW1pdFwiKTtsLm5hbWU9XCJNYXhMaXN0ZW5lcnNFeGNlZWRlZFdhcm5pbmdcIixsLmVtaXR0ZXI9ZSxsLnR5cGU9dCxsLmNvdW50PW8ubGVuZ3RoLHA9bCxjb25zb2xlJiZjb25zb2xlLndhcm4mJmNvbnNvbGUud2FybihwKX1yZXR1cm4gZX1mdW5jdGlvbiBsKCl7aWYoIXRoaXMuZmlyZWQpcmV0dXJuIHRoaXMudGFyZ2V0LnJlbW92ZUxpc3RlbmVyKHRoaXMudHlwZSx0aGlzLndyYXBGbiksdGhpcy5maXJlZD0hMCwwPT09YXJndW1lbnRzLmxlbmd0aD90aGlzLmxpc3RlbmVyLmNhbGwodGhpcy50YXJnZXQpOnRoaXMubGlzdGVuZXIuYXBwbHkodGhpcy50YXJnZXQsYXJndW1lbnRzKX1mdW5jdGlvbiBkKGUsdCxuKXt2YXIgaT17ZmlyZWQ6ITEsd3JhcEZuOnZvaWQgMCx0YXJnZXQ6ZSx0eXBlOnQsbGlzdGVuZXI6bn0sYT1sLmJpbmQoaSk7cmV0dXJuIGEubGlzdGVuZXI9bixpLndyYXBGbj1hLGF9ZnVuY3Rpb24gdShlLHQsbil7dmFyIGk9ZS5fZXZlbnRzO2lmKHZvaWQgMD09PWkpcmV0dXJuW107dmFyIGE9aVt0XTtyZXR1cm4gdm9pZCAwPT09YT9bXTpcImZ1bmN0aW9uXCI9PXR5cGVvZiBhP24/W2EubGlzdGVuZXJ8fGFdOlthXTpuP2Z1bmN0aW9uKGUpe2Zvcih2YXIgdD1uZXcgQXJyYXkoZS5sZW5ndGgpLG49MDtuPHQubGVuZ3RoOysrbil0W25dPWVbbl0ubGlzdGVuZXJ8fGVbbl07cmV0dXJuIHR9KGEpOmYoYSxhLmxlbmd0aCl9ZnVuY3Rpb24gaChlKXt2YXIgdD10aGlzLl9ldmVudHM7aWYodm9pZCAwIT09dCl7dmFyIG49dFtlXTtpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBuKXJldHVybiAxO2lmKHZvaWQgMCE9PW4pcmV0dXJuIG4ubGVuZ3RofXJldHVybiAwfWZ1bmN0aW9uIGYoZSx0KXtmb3IodmFyIG49bmV3IEFycmF5KHQpLGk9MDtpPHQ7KytpKW5baV09ZVtpXTtyZXR1cm4gbn1mdW5jdGlvbiB5KGUsdCxuLGkpe2lmKFwiZnVuY3Rpb25cIj09dHlwZW9mIGUub24paS5vbmNlP2Uub25jZSh0LG4pOmUub24odCxuKTtlbHNle2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIGUuYWRkRXZlbnRMaXN0ZW5lcil0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgXCJlbWl0dGVyXCIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEV2ZW50RW1pdHRlci4gUmVjZWl2ZWQgdHlwZSAnK3R5cGVvZiBlKTtlLmFkZEV2ZW50TGlzdGVuZXIodCwoZnVuY3Rpb24gYShyKXtpLm9uY2UmJmUucmVtb3ZlRXZlbnRMaXN0ZW5lcih0LGEpLG4ocil9KSl9fU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLFwiZGVmYXVsdE1heExpc3RlbmVyc1wiLHtlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiBvfSxzZXQ6ZnVuY3Rpb24oZSl7aWYoXCJudW1iZXJcIiE9dHlwZW9mIGV8fGU8MHx8YShlKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHZhbHVlIG9mIFwiZGVmYXVsdE1heExpc3RlbmVyc1wiIGlzIG91dCBvZiByYW5nZS4gSXQgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuIFJlY2VpdmVkICcrZStcIi5cIik7bz1lfX0pLHIuaW5pdD1mdW5jdGlvbigpe3ZvaWQgMCE9PXRoaXMuX2V2ZW50cyYmdGhpcy5fZXZlbnRzIT09T2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLl9ldmVudHN8fCh0aGlzLl9ldmVudHM9T2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLl9ldmVudHNDb3VudD0wKSx0aGlzLl9tYXhMaXN0ZW5lcnM9dGhpcy5fbWF4TGlzdGVuZXJzfHx2b2lkIDB9LHIucHJvdG90eXBlLnNldE1heExpc3RlbmVycz1mdW5jdGlvbihlKXtpZihcIm51bWJlclwiIT10eXBlb2YgZXx8ZTwwfHxhKGUpKXRocm93IG5ldyBSYW5nZUVycm9yKCdUaGUgdmFsdWUgb2YgXCJuXCIgaXMgb3V0IG9mIHJhbmdlLiBJdCBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIG51bWJlci4gUmVjZWl2ZWQgJytlK1wiLlwiKTtyZXR1cm4gdGhpcy5fbWF4TGlzdGVuZXJzPWUsdGhpc30sci5wcm90b3R5cGUuZ2V0TWF4TGlzdGVuZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIGModGhpcyl9LHIucHJvdG90eXBlLmVtaXQ9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PVtdLG49MTtuPGFyZ3VtZW50cy5sZW5ndGg7bisrKXQucHVzaChhcmd1bWVudHNbbl0pO3ZhciBhPVwiZXJyb3JcIj09PWUscj10aGlzLl9ldmVudHM7aWYodm9pZCAwIT09cilhPWEmJnZvaWQgMD09PXIuZXJyb3I7ZWxzZSBpZighYSlyZXR1cm4hMTtpZihhKXt2YXIgbztpZih0Lmxlbmd0aD4wJiYobz10WzBdKSxvIGluc3RhbmNlb2YgRXJyb3IpdGhyb3cgbzt2YXIgcz1uZXcgRXJyb3IoXCJVbmhhbmRsZWQgZXJyb3IuXCIrKG8/XCIgKFwiK28ubWVzc2FnZStcIilcIjpcIlwiKSk7dGhyb3cgcy5jb250ZXh0PW8sc312YXIgYz1yW2VdO2lmKHZvaWQgMD09PWMpcmV0dXJuITE7aWYoXCJmdW5jdGlvblwiPT10eXBlb2YgYylpKGMsdGhpcyx0KTtlbHNle3ZhciBwPWMubGVuZ3RoLGw9ZihjLHApO2ZvcihuPTA7bjxwOysrbilpKGxbbl0sdGhpcyx0KX1yZXR1cm4hMH0sci5wcm90b3R5cGUuYWRkTGlzdGVuZXI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gcCh0aGlzLGUsdCwhMSl9LHIucHJvdG90eXBlLm9uPXIucHJvdG90eXBlLmFkZExpc3RlbmVyLHIucHJvdG90eXBlLnByZXBlbmRMaXN0ZW5lcj1mdW5jdGlvbihlLHQpe3JldHVybiBwKHRoaXMsZSx0LCEwKX0sci5wcm90b3R5cGUub25jZT1mdW5jdGlvbihlLHQpe3JldHVybiBzKHQpLHRoaXMub24oZSxkKHRoaXMsZSx0KSksdGhpc30sci5wcm90b3R5cGUucHJlcGVuZE9uY2VMaXN0ZW5lcj1mdW5jdGlvbihlLHQpe3JldHVybiBzKHQpLHRoaXMucHJlcGVuZExpc3RlbmVyKGUsZCh0aGlzLGUsdCkpLHRoaXN9LHIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyPWZ1bmN0aW9uKGUsdCl7dmFyIG4saSxhLHIsbztpZihzKHQpLHZvaWQgMD09PShpPXRoaXMuX2V2ZW50cykpcmV0dXJuIHRoaXM7aWYodm9pZCAwPT09KG49aVtlXSkpcmV0dXJuIHRoaXM7aWYobj09PXR8fG4ubGlzdGVuZXI9PT10KTA9PS0tdGhpcy5fZXZlbnRzQ291bnQ/dGhpcy5fZXZlbnRzPU9iamVjdC5jcmVhdGUobnVsbCk6KGRlbGV0ZSBpW2VdLGkucmVtb3ZlTGlzdGVuZXImJnRoaXMuZW1pdChcInJlbW92ZUxpc3RlbmVyXCIsZSxuLmxpc3RlbmVyfHx0KSk7ZWxzZSBpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBuKXtmb3IoYT0tMSxyPW4ubGVuZ3RoLTE7cj49MDtyLS0paWYobltyXT09PXR8fG5bcl0ubGlzdGVuZXI9PT10KXtvPW5bcl0ubGlzdGVuZXIsYT1yO2JyZWFrfWlmKGE8MClyZXR1cm4gdGhpczswPT09YT9uLnNoaWZ0KCk6ZnVuY3Rpb24oZSx0KXtmb3IoO3QrMTxlLmxlbmd0aDt0KyspZVt0XT1lW3QrMV07ZS5wb3AoKX0obixhKSwxPT09bi5sZW5ndGgmJihpW2VdPW5bMF0pLHZvaWQgMCE9PWkucmVtb3ZlTGlzdGVuZXImJnRoaXMuZW1pdChcInJlbW92ZUxpc3RlbmVyXCIsZSxvfHx0KX1yZXR1cm4gdGhpc30sci5wcm90b3R5cGUub2ZmPXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyLHIucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycz1mdW5jdGlvbihlKXt2YXIgdCxuLGk7aWYodm9pZCAwPT09KG49dGhpcy5fZXZlbnRzKSlyZXR1cm4gdGhpcztpZih2b2lkIDA9PT1uLnJlbW92ZUxpc3RlbmVyKXJldHVybiAwPT09YXJndW1lbnRzLmxlbmd0aD8odGhpcy5fZXZlbnRzPU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy5fZXZlbnRzQ291bnQ9MCk6dm9pZCAwIT09bltlXSYmKDA9PS0tdGhpcy5fZXZlbnRzQ291bnQ/dGhpcy5fZXZlbnRzPU9iamVjdC5jcmVhdGUobnVsbCk6ZGVsZXRlIG5bZV0pLHRoaXM7aWYoMD09PWFyZ3VtZW50cy5sZW5ndGgpe3ZhciBhLHI9T2JqZWN0LmtleXMobik7Zm9yKGk9MDtpPHIubGVuZ3RoOysraSlcInJlbW92ZUxpc3RlbmVyXCIhPT0oYT1yW2ldKSYmdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoYSk7cmV0dXJuIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKFwicmVtb3ZlTGlzdGVuZXJcIiksdGhpcy5fZXZlbnRzPU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy5fZXZlbnRzQ291bnQ9MCx0aGlzfWlmKFwiZnVuY3Rpb25cIj09dHlwZW9mKHQ9bltlXSkpdGhpcy5yZW1vdmVMaXN0ZW5lcihlLHQpO2Vsc2UgaWYodm9pZCAwIT09dClmb3IoaT10Lmxlbmd0aC0xO2k+PTA7aS0tKXRoaXMucmVtb3ZlTGlzdGVuZXIoZSx0W2ldKTtyZXR1cm4gdGhpc30sci5wcm90b3R5cGUubGlzdGVuZXJzPWZ1bmN0aW9uKGUpe3JldHVybiB1KHRoaXMsZSwhMCl9LHIucHJvdG90eXBlLnJhd0xpc3RlbmVycz1mdW5jdGlvbihlKXtyZXR1cm4gdSh0aGlzLGUsITEpfSxyLmxpc3RlbmVyQ291bnQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm5cImZ1bmN0aW9uXCI9PXR5cGVvZiBlLmxpc3RlbmVyQ291bnQ/ZS5saXN0ZW5lckNvdW50KHQpOmguY2FsbChlLHQpfSxyLnByb3RvdHlwZS5saXN0ZW5lckNvdW50PWgsci5wcm90b3R5cGUuZXZlbnROYW1lcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9ldmVudHNDb3VudD4wP3QodGhpcy5fZXZlbnRzKTpbXX19fSx0PXt9O2Z1bmN0aW9uIG4oaSl7dmFyIGE9dFtpXTtpZih2b2lkIDAhPT1hKXJldHVybiBhLmV4cG9ydHM7dmFyIHI9dFtpXT17ZXhwb3J0czp7fX07cmV0dXJuIGVbaV0ocixyLmV4cG9ydHMsbiksci5leHBvcnRzfW4uZD0oZSx0KT0+e2Zvcih2YXIgaSBpbiB0KW4ubyh0LGkpJiYhbi5vKGUsaSkmJk9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLGkse2VudW1lcmFibGU6ITAsZ2V0OnRbaV19KX0sbi5vPShlLHQpPT5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KTt2YXIgaT17fTtuLmQoaSx7cTooKT0+bH0pO3ZhciBhPW4oODI3KTtjb25zdCByPVwib3BlbmZpbi1zbmFwXCIsbz1cIjEuMy4wXCIscz0oZSx0KT0+YCR7ZX0gJHt0IGluc3RhbmNlb2YgRXJyb3I/dC5tZXNzYWdlOlwic3RyaW5nXCI9PXR5cGVvZiB0P3Q6SlNPTi5zdHJpbmdpZnkodCl9YCxjPWFzeW5jKCk9Pnt0cnl7cmV0dXJuKGF3YWl0IGZpbi5TeXN0ZW0uZ2V0QXBwQXNzZXRJbmZvKHthbGlhczpyfSkpLnZlcnNpb249PT1vfWNhdGNoKGUpe3JldHVybiExfX0scD1cImludGVybmFsLWdlbmVyYXRlZC13aW5kb3ctXCI7Y2xhc3MgbHtjb25zdHJ1Y3RvcihlKXtpZih0aGlzLnNlcnZlcl9pZD1lLHRoaXMuZW1pdHRlcj1uZXcgYS5FdmVudEVtaXR0ZXIsdGhpcy5fX2V4dGVuc2lvbnM9W10sIWZpbil0aHJvdyBuZXcgRXJyb3IoXCJPcGVuRmluIGlzIG5vdCBhdmFpbGFibGVcIil9YXN5bmMgc3RhcnQoZSl7dHJ5e2NvbnN0IGU9YXdhaXQgZmluLlN5c3RlbS5nZXRSdW50aW1lSW5mbygpO1wieDY0XCIhPT1lPy5hcmNoaXRlY3R1cmUmJmNvbnNvbGUud2FybihgVGhlIGFyY2hpdGVjdHVyZSBvZiB0aGUgY29ubmVjdGVkIE9wZW5GaW4gcnVudGltZSBpcyAnJHtlLmFyY2hpdGVjdHVyZX0nIC0gV2luZG93IHNuYXBwaW5nIGlzIGN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCB3aXRoIDY0LWJpdCBhcHBsaWNhdGlvbnMuIFNuYXBwaW5nIHdpbGwgYmUgZGlzYWJsZWQuYCl9Y2F0Y2goZSl7Y29uc29sZS53YXJuKGBDb3VsZCBub3QgZ2V0IHJ1bnRpbWUgaW5mbzogJHtlfWApfWNvbnN0IHQ9YXdhaXQgZmluLlN5c3RlbS5xdWVyeVBlcm1pc3Npb25Gb3JDdXJyZW50Q29udGV4dChcIlN5c3RlbS5sYXVuY2hFeHRlcm5hbFByb2Nlc3NcIik7aWYoIXQuZ3JhbnRlZCl0aHJvdyBuZXcgRXJyb3IoXCJUaGUgJ1N5c3RlbS5sYXVuY2hFeHRlcm5hbFByb2Nlc3MnIHBlcm1pc3Npb24gaXMgcmVxdWlyZWQgdG8gbGF1bmNoIHRoZSBTbmFwIHNlcnZlclwiKTtpZih0LnJhd1ZhbHVlKXtpZihlPy5leGVjdXRhYmxlUGF0aCYmIXQucmF3VmFsdWU/LmV4ZWN1dGFibGVzPy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIlRoZSAnU3lzdGVtLmxhdW5jaEV4dGVybmFsUHJvY2Vzcy5hc3NldHMnIHBlcm1pc3Npb24gaXMgcmVxdWlyZWQgdG8gbGF1bmNoIHRoZSBTbmFwIHNlcnZlciBmcm9tIGFuIGV4ZWN1dGFibGUgcGF0aFwiKTtpZighZT8uZXhlY3V0YWJsZVBhdGgmJiF0LnJhd1ZhbHVlPy5hc3NldHM/LmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiVGhlICdTeXN0ZW0ubGF1bmNoRXh0ZXJuYWxQcm9jZXNzLmFzc2V0cycgcGVybWlzc2lvbiBpcyByZXF1aXJlZCB0byBsYXVuY2ggdGhlIFNuYXAgc2VydmVyIGZyb20gYSBVUkxcIil9ZT8uZXhlY3V0YWJsZVBhdGh8fGF3YWl0KGFzeW5jIGU9Pntjb25zdCB0PWF3YWl0IGZpbi5BcHBsaWNhdGlvbi5nZXRDdXJyZW50U3luYygpLmdldE1hbmlmZXN0KCksbj10LmFwcEFzc2V0cz8uZmluZCgoZT0+ZS5hbGlhcz09PXIpKTtpZihuKXJldHVybiB2b2lkIGNvbnNvbGUud2FybihcIkRldGVjdGVkIFNuYXAgcGFja2FnZSBpbiBhcHAgbWFuaWZlc3QgYXBwQXNzZXRzXCIsbik7aWYoYXdhaXQgYygpKXJldHVybiB2b2lkIGNvbnNvbGUuaW5mbyhcIlVzaW5nIGV4aXN0aW5nIFNuYXAgcGFja2FnZVwiKTtjb25zdCBpPWU/P2BodHRwczovL2Nkbi5vcGVuZmluLmNvL3JlbGVhc2Uvc25hcC8ke299L3NuYXAuemlwYDtjb25zb2xlLmluZm8oYERvd25sb2FkaW5nIFNuYXAgYXNzZXQgZnJvbTogJyR7aX0nYCk7Y29uc3QgYT17YWxpYXM6cixzcmM6YCR7aX1gLHRhcmdldDpcIk9wZW5GaW5TbmFwLmV4ZVwiLHZlcnNpb246b307Y29uc29sZS5pbmZvKFwiRG93bmxvYWRpbmcgU25hcCBwYWNrYWdlXCIsYSk7dHJ5e2F3YWl0IGZpbi5TeXN0ZW0uZG93bmxvYWRBc3NldChhLCgoKT0+e30pKX1jYXRjaChlKXt0aHJvdyBuZXcgRXJyb3IocyhcIlVuYWJsZSB0byBkb3dubG9hZCBTbmFwIHBhY2thZ2UuXCIsZSkpfX0pKGU/LmN1c3RvbVNuYXBBc3NldFNvdXJjZSk7Y29uc3Qgbj1hd2FpdCB0aGlzLmJ1aWxkX2NvbW1hbmRfbGluZShlKTtsZXQgaT17YWxpYXM6cixhcmd1bWVudHM6bixsaWZldGltZTpcIndpbmRvd1wifTtlPy5leGVjdXRhYmxlUGF0aCYmKGk9e3BhdGg6ZS5leGVjdXRhYmxlUGF0aCxhcmd1bWVudHM6bixsaWZldGltZTpcIndpbmRvd1wifSk7dHJ5e3RoaXMuc25hcF9pZGVudGl0eT1hd2FpdCBmaW4uU3lzdGVtLmxhdW5jaEV4dGVybmFsUHJvY2VzcyhpKX1jYXRjaChlKXt0aHJvdyBuZXcgRXJyb3IocyhcIkZhaWxlZCB0byBsYXVuY2ggdGhlIFNuYXAgc2VydmVyLlwiLGUpKX1yZXR1cm4gdGhpcy5jb25uZWN0KCl9YXN5bmMgY29ubmVjdCgpe3RoaXMuY2xpZW50PWF3YWl0IGZpbi5JbnRlckFwcGxpY2F0aW9uQnVzLkNoYW5uZWwuY29ubmVjdChgc25hcC1zZXJ2ZXItY29yZS0ke3RoaXMuc2VydmVyX2lkfWApLHRoaXMuY2xpZW50LnJlZ2lzdGVyKFwic25hcF9oYW5kc2hha2VcIiwoYXN5bmMoZSx0KT0+e3RyeXthd2FpdCBmaW4uU3lzdGVtLnJlZ2lzdGVyVXNhZ2Uoe3R5cGU6XCJhZGFwdGVyLWZlYXR1cmVcIixkYXRhOnthcGlWZXJzaW9uOmUudmVyc2lvbixjb21wb25lbnROYW1lOlwic25hcC1zZXJ2ZXJcIn19KX1jYXRjaHtjb25zb2xlLndhcm4oXCJTbmFwU0RLOiBGYWlsZWQgdG8gcmVnaXN0ZXIgdXNhZ2UgZm9yIFNuYXAgU2VydmVyXCIpfX0pKTt0cnl7YXdhaXQgZmluLlN5c3RlbS5yZWdpc3RlclVzYWdlKHt0eXBlOlwiYWRhcHRlci1mZWF0dXJlXCIsZGF0YTp7YXBpVmVyc2lvbjpcIjEuMy4wXCIsY29tcG9uZW50TmFtZTpcInNuYXAtY2xpZW50XCJ9fSl9Y2F0Y2h7Y29uc29sZS53YXJuKFwiU25hcFNESzogRmFpbGVkIHRvIHJlZ2lzdGVyIHVzYWdlIGZvciBTbmFwIFNlcnZlclwiKX10aGlzLmNsaWVudC5yZWdpc3RlcihcInNuYXBfdXBkYXRlc1wiLCgoZSx0KT0+dGhpcy5oYW5kbGVTbmFwRXZlbnRzKGUsdCkpKSx0aGlzLl9fZXh0ZW5zaW9ucy5mb3JFYWNoKChlPT5lLm9uQ29ubmVjdGVkKHRoaXMuY2xpZW50KSkpfV9fYWRkRXh0ZW5zaW9uKGUpe3RoaXMuX19leHRlbnNpb25zLnB1c2goZSl9YXN5bmMgc3RvcCgpe2lmKCF0aGlzLmNsaWVudCl0aHJvdyBuZXcgRXJyb3IoXCJTbmFwIHNlcnZlciBpcyBub3QgcnVubmluZ1wiKTthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwic2h1dGRvd25cIn0pKX1hc3luYyBnZXRMYXlvdXQoKXtpZighdGhpcy5jbGllbnQpdGhyb3cgbmV3IEVycm9yKFwiU25hcCBzZXJ2ZXIgaXMgbm90IHJ1bm5pbmdcIik7Y29uc3QgZT1hd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwic2VyaWFsaXNlTGF5b3V0XCJ9KSk7cmV0dXJuIGU/LnBheWxvYWQubGF5b3V0fWFzeW5jIHNldExheW91dChlLHQ9ITApe2lmKCF0aGlzLmNsaWVudCl0aHJvdyBuZXcgRXJyb3IoXCJTbmFwIHNlcnZlciBpcyBub3QgcnVubmluZ1wiKTthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiZGVzZXJpYWxpc2VMYXlvdXRcIixwYXlsb2FkOntsYXlvdXQ6ZSxyZXNldDp0fX0pKX1hc3luYyBwcmVwYXJlVG9BcHBseVNuYXBzaG90KGUsdCl7aWYoIWV8fGUub3B0aW9ucz8uY2xvc2VFeGlzdGluZ1dpbmRvd3N8fGUub3B0aW9ucz8uY2xvc2VTbmFwc2hvdFdpbmRvd3MpcmV0dXJuIHRoaXMubmVlZFRvUmVzZXRMYXlvdXQ9ITAsdm9pZCBhd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwicmVzZXRBbGxcIn0pKTt0aGlzLm5lZWRUb1Jlc2V0TGF5b3V0PSExO2NvbnN0IG49ZS5zbmFwc2hvdCxpPUpTT04uc3RyaW5naWZ5KG4sbnVsbCwyKSxhPW4uc25hcDtpZighYSlyZXR1cm47Y29uc3Qgcj10Pz92LG89KGF3YWl0IHRoaXMuZ2V0TGF5b3V0KCkpPy5jbGllbnRzLm1hcCgoZT0+ZS5pZCkpPz9bXSxzPWYobi53aW5kb3dzKSxjPUFycmF5LmZyb20ocy5rZXlzKCkpLmZpbHRlcigoZT0+by5pbmNsdWRlcyhlKSkpO2EuY2xpZW50cy5maWx0ZXIoKGU9PmMuaW5jbHVkZXMoZS5pZCkpKS5mb3JFYWNoKChlPT57Y29uc3QgdD1lLmlkLG49cih0KTtlLmlkPW4seShhLmNvbm5lY3Rpb25zLHQsbik7Y29uc3QgaT1zLmdldCh0KTtpLmN1c3RvbURhdGEuc25hcENsaWVudElkPW4saS5uYW1lPW59KSk7Y29uc3QgcD1KU09OLnN0cmluZ2lmeShuLG51bGwsMik7Y29uc29sZS5kZWJ1ZyhgU25hcCBTREsgbW9kaWZpZWQgc25hcHNob3QgZGF0YSBiZWZvcmUgYXBwbHlpbmcgaXQuXFxuT3JpZ2luYWwgc25hcHNob3Q6XFxuJHtpfVxcbk1vZGlmaWVkIHNuYXBzaG90OlxcbiR7cH1gKX1hc3luYyBkZWNvcmF0ZVNuYXBzaG90KGUpe3JldHVybnsuLi5lLHNuYXA6YXdhaXQgdGhpcy5nZXRMYXlvdXQoKX19YXN5bmMgYXBwbHlTbmFwc2hvdChlKXtlLnNuYXAmJmF3YWl0IHRoaXMuc2V0TGF5b3V0KGUuc25hcCx0aGlzLm5lZWRUb1Jlc2V0TGF5b3V0KX1hc3luYyBsYXVuY2goZSl7aWYoIXRoaXMuY2xpZW50KXRocm93IG5ldyBFcnJvcihcIk5vdCBjb25uZWN0ZWQgdG8gYW4gU25hcCBzZXJ2ZXJcIik7ZS5hcHBBc3NldEluZm8mJihlLnBhdGg9YXdhaXQgZCh7dGFyZ2V0OmUucGF0aCwuLi5lLmFwcEFzc2V0SW5mb30pKSxjb25zb2xlLmxvZyhcIm9wdGlvbnM6IFwiLGUpO2NvbnN0IHQ9e2FjdGlvbjpcInN0YXJ0UHJvY2Vzc1wiLHBheWxvYWQ6ey4uLmUsYXJnczplLmFyZ3N8fFtdfX07aWYoZS5zdHJhdGVneSl7Y29uc3R7dHlwZTpuLC4uLml9PWUuc3RyYXRlZ3k7dC5wYXlsb2FkLnN0cmF0ZWd5PXt0eXBlOm4scGFyYW1ldGVyczp7Li4uaX19fWNvbnN0IG49YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIsdCkpO2lmKG4/LnBheWxvYWQ/LnN1Y2Nlc3MpcmV0dXJue3Byb2Nlc3NfaWQ6bi5wYXlsb2FkLnByb2Nlc3NfaWR9O3Rocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGxhdW5jaCBwcm9jZXNzOiAke24/LnBheWxvYWQ/LmVycm9yfWApfWFzeW5jIHJlZ2lzdGVyV2luZG93KGUsdCxuKXthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiaG9va0FuZFJlZ2lzdGVyV2luZG93XCIscGF5bG9hZDp7Y2xpZW50SWQ6ZSx3aW5kb3dIYW5kbGU6dCxyZXNpemluZ0JlaGF2aW9yOm59fSkpfWFzeW5jIGVuYWJsZUF1dG9XaW5kb3dSZWdpc3RyYXRpb24oKXtjb25zdCBlPWU9PnRoaXMuaGFuZGxlTmV3V2luZG93KGUpO3JldHVybiBhd2FpdCBmaW4uUGxhdGZvcm0uZ2V0Q3VycmVudFN5bmMoKS5hZGRMaXN0ZW5lcihcIndpbmRvdy1jcmVhdGVkXCIsZSksYXN5bmMoKT0+e2F3YWl0IGZpbi5TeXN0ZW0ucmVtb3ZlTGlzdGVuZXIoXCJ3aW5kb3ctY3JlYXRlZFwiLGUpfX1hc3luYyBhdHRhY2hXaW5kb3dzKGUsdCxuLGkpe2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJhdHRhY2hcIixwYXlsb2FkOnt0YXJnZXRDbGllbnRJZDplLHRvQXR0YWNoQ2xpZW50SWQ6dCx0YXJnZXRTaWRlOm4sb2Zmc2V0Oml9fSkpfWFzeW5jIGRldGFjaEZyb21Hcm91cChlKXthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiZGV0YWNoRnJvbUdyb3VwXCIscGF5bG9hZDp7Y2xpZW50SWQ6ZX19KSl9YXN5bmMgZ2V0QXR0YWNoZWQoZSl7cmV0dXJuKGF3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJnZXRBdHRhY2hlZEluc3RhbmNlc1wiLHBheWxvYWQ6e2NsaWVudElkOmV9fSkpKS5wYXlsb2FkLmF0dGFjaGVkfWFzeW5jIGhhc0F0dGFjaG1lbnRzKGUpe3JldHVybihhd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiaGFzQXR0YWNobWVudHNcIixwYXlsb2FkOntjbGllbnRJZDplfX0pKSkucGF5bG9hZC5oYXNBdHRhY2htZW50c31hZGRFdmVudExpc3RlbmVyKGUsdCl7dGhpcy5lbWl0dGVyLm9uKGUsdCl9cmVtb3ZlRXZlbnRMaXN0ZW5lcihlLHQpe3RoaXMuZW1pdHRlci5vZmYoZSx0KX1vbmNlKGUsdCl7dGhpcy5lbWl0dGVyLm9uY2UoZSx0KX1hc3luYyBnZXRHcm91cElkRm9yV2luZG93KGUpe2NvbnN0IHQ9XCJudW1iZXJcIj09dHlwZW9mIGU/e25hdGl2ZVdpbmRvd0lkOmV9OntjbGllbnRJZDplfSxuPWF3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJnZXRHcm91cElkRm9yV2luZG93XCIscGF5bG9hZDp0fSkpO2lmKCFuLnBheWxvYWQuZ3JvdXBJZCl0aHJvdyBuZXcgRXJyb3IoXCJObyBncm91cCBmb3VuZCBmb3Igd2luZG93XCIpO3JldHVybiBuLnBheWxvYWQuZ3JvdXBJZH1hc3luYyBnZXRXaW5kb3dSZXNpemFibGUoZSl7Y29uc3QgdD1cIm51bWJlclwiPT10eXBlb2YgZT97bmF0aXZlV2luZG93SWQ6ZX06e2NsaWVudElkOmV9LG49YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImdldFJlc2l6YWJsZVwiLHBheWxvYWQ6dH0pKTtpZihudWxsPT09bi5wYXlsb2FkLnJlc2l6YWJsZSl0aHJvdyBuZXcgRXJyb3IoXCJObyB3aW5kb3cgZm91bmQgZm9yIGdpdmVuIElEXCIpO3JldHVybiBuLnBheWxvYWQucmVzaXphYmxlfWFzeW5jIHNldFdpbmRvd1Jlc2l6YWJsZShlLHQpe2NvbnN0IG49XCJudW1iZXJcIj09dHlwZW9mIGU/e25hdGl2ZVdpbmRvd0lkOmUscmVzaXphYmxlOnR9OntjbGllbnRJZDplLHJlc2l6YWJsZTp0fTthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwic2V0UmVzaXphYmxlXCIscGF5bG9hZDpufSkpfWFzeW5jIGdldFdpbmRvd3NJbkdyb3VwKGUpe2NvbnN0IHQ9YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImdldFdpbmRvd3NJbkdyb3VwXCIscGF5bG9hZDp7Z3JvdXBJZDplfX0pKTtyZXR1cm4gdC5wYXlsb2FkLndpbmRvd3M/dC5wYXlsb2FkLndpbmRvd3MubWFwKChlPT4oe25hdGl2ZUlkOmVbMF0sY2xpZW50SWQ6ZVsxXX0pKSk6W119YXN5bmMgZ2V0QWxsR3JvdXBJZHMoKXtyZXR1cm4oYXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImdldEFsbEdyb3VwSWRzXCJ9KSkpLnBheWxvYWQuZ3JvdXBJZHN9YXN5bmMgbWluaW1pemVHcm91cChlKXthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwibWluaW1pemVHcm91cFwiLHBheWxvYWQ6e2dyb3VwSWQ6ZX19KSl9YXN5bmMgcmVzdG9yZUdyb3VwKGUpe2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJyZXN0b3JlR3JvdXBcIixwYXlsb2FkOntncm91cElkOmV9fSkpfWFzeW5jIGhhbmRsZU5ld1dpbmRvdyhlKXtjb25zdCB0PWF3YWl0IGZpbi5XaW5kb3cud3JhcCh7dXVpZDplLnV1aWQsbmFtZTplLm5hbWV9KSxuPWF3YWl0IHQuZ2V0TmF0aXZlSWQoKTtsZXQgaT10LmlkZW50aXR5Lm5hbWU7Y29uc3QgYT1hd2FpdCB0LmdldE9wdGlvbnMoKTtpZih2b2lkIDAhPT1hLmluY2x1ZGVJblNuYXBzaG90cyYmITE9PT1hLmluY2x1ZGVJblNuYXBzaG90cylyZXR1cm4gdm9pZCBjb25zb2xlLmxvZyhgU25hcFNESzogTm90IHJlZ2lzdGVyaW5nICR7ZS51dWlkfToke2UubmFtZX0sIFdpbmRvdyBpcyBleHBsaWNpdGx5IGV4Y2x1ZGVkIC1pbmNsdWRlSW5TbmFwc2hvdHMgPT0gZmFsc2VgKTtjb25zdCByPWEuY3VzdG9tRGF0YXx8e307ci5zbmFwQ2xpZW50SWQ/aT1yLnNuYXBDbGllbnRJZDphd2FpdCB0LnVwZGF0ZU9wdGlvbnMoe2N1c3RvbURhdGE6ey4uLnIsc25hcENsaWVudElkOml9fSksY29uc29sZS5sb2coYFNuYXBTREs6IEF1dG8tcmVnaXN0ZXJpbmcgd2luZG93OiBzbmFwQ2xpZW50SWQ6JHtpfSwgaGFuZGxlICR7bn0sIHV1aWQ6JHtlLnV1aWR9LCBuYW1lOiR7ZS5uYW1lfWApLGF3YWl0IHRoaXMucmVnaXN0ZXJXaW5kb3coaSxuLHIuc25hcFJlc2l6aW5nQmVoYXZpb3IpfWVtaXRfZXZlbnQoZSwuLi50KXt0aGlzLmVtaXR0ZXIuZW1pdChlLC4uLnQpfWhhbmRsZVNuYXBFdmVudHMoZSx0KXtzd2l0Y2godGhpcy5lbWl0X2V2ZW50KFwiYWxsLWV2ZW50c1wiLHt0eXBlOmUuYWN0aW9uLHBheWxvYWQ6ZS5wYXlsb2FkfSksZS5hY3Rpb24pe2Nhc2VcImNsaWVudFJlZ2lzdGVyZWRcIjp0aGlzLmVtaXRfZXZlbnQoXCJjbGllbnQtcmVnaXN0ZXJlZFwiLHtjbGllbnRJZDplLnBheWxvYWQuY2xpZW50SWQsd2luZG93SGFuZGxlOmAjJHtlLnBheWxvYWQud2luZG93SGFuZGxlLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpfWAsb3duaW5nUHJvY2Vzc0lkOmUucGF5bG9hZC5vd25pbmdQcm9jZXNzSWR9KTticmVhaztjYXNlXCJjbGllbnRVblJlZ2lzdGVyZWRcIjp0aGlzLmVtaXRfZXZlbnQoXCJjbGllbnQtdW5yZWdpc3RlcmVkXCIsey4uLmUucGF5bG9hZH0pO2JyZWFrO2Nhc2VcIm1vdmVTaXplQ29tcGxldGVkXCI6dGhpcy5lbWl0X2V2ZW50KFwibW92ZS1zaXplLWNvbXBsZXRlZFwiLHsuLi5lLnBheWxvYWR9KTticmVhaztjYXNlXCJjbGllbnRzQXR0YWNoZWRcIjp0aGlzLmVtaXRfZXZlbnQoXCJjbGllbnRzLWF0dGFjaGVkXCIsey4uLmUucGF5bG9hZH0pO2JyZWFrO2Nhc2VcImNsaWVudERldGFjaGVkXCI6dGhpcy5lbWl0X2V2ZW50KFwiY2xpZW50LWRldGFjaGVkXCIsey4uLmUucGF5bG9hZH0pO2JyZWFrO2Nhc2VcImdyb3Vwc0NoYW5nZWRcIjp0aGlzLmVtaXRfZXZlbnQoXCJncm91cHMtY2hhbmdlZFwiLHsuLi5lLnBheWxvYWR9KTticmVhaztjYXNlXCJjbGllbnRBY3RpdmF0ZWRcIjp0aGlzLmVtaXRfZXZlbnQoXCJjbGllbnQtYWN0aXZhdGVkXCIsey4uLmUucGF5bG9hZH0pO2JyZWFrO2Nhc2VcImNsaWVudERlYWN0aXZhdGVkXCI6dGhpcy5lbWl0X2V2ZW50KFwiY2xpZW50LWRlYWN0aXZhdGVkXCIsey4uLmUucGF5bG9hZH0pfX1hc3luYyBidWlsZF9jb21tYW5kX2xpbmUoZSl7bGV0IHQ9YC0taWQgJHt0aGlzLnNlcnZlcl9pZH0gYDtlPy5zaG93RGVidWcmJih0Kz1cIiAtLXNob3ctZGVidWcgXCIpLGU/LmRpc2FibGVHUFVBY2NlbGVyYXRlZERyYWdnaW5nJiYodCs9XCIgLS1kaXNhYmxlLWdwdS1hY2NlbGVyYXRlZC1kcmFnZ2luZyB0cnVlIFwiKSxlPy5kaXNhYmxlQmx1ckRyb3BQcmV2aWV3JiYodCs9XCIgLS1ibHVyLWRyb3AtcHJldmlldyBmYWxzZSBcIiksdm9pZCAwIT09ZT8uYmx1ckVmZmVjdFBlcmZvcm1hbmNlVGhyZXNob2xkJiYodCs9YCAtLWJsdXItZWZmZWN0LXBlcmZvcm1hbmNlLXRocmVzaG9sZD0ke2U/LmJsdXJFZmZlY3RQZXJmb3JtYW5jZVRocmVzaG9sZH0gYCksZT8uZGlzYWJsZVVzZXJVbnN0aWNrJiYodCs9XCIgLS1kaXNhYmxlLXVzZXItdW5zdGljayBcIiksITAhPT1lPy5rZXlUb1N0aWNrJiZcInN0cmluZ1wiIT10eXBlb2YgZT8ua2V5VG9TdGlja3x8KHQrPWAgLS1rcz0keyEwPT09ZS5rZXlUb1N0aWNrP1wiY3RybFwiOmUua2V5VG9TdGlja30gYCksZT8ua2V5VG9VbnN0aWNrJiYodCs9YCAtLWt1cz0ke2Uua2V5VG9VbnN0aWNrfSBgKSxlPy5oaWRlVGFza2JhckVudHJ5JiYodCs9XCIgLS1uby10YiBcIiksZT8udGFza2Jhckljb25Hcm91cCYmKHQrPWAgLS10Yi1pZD0ke2U/LnRhc2tiYXJJY29uR3JvdXB9IGApLGU/LnRhc2tiYXJJY29uJiYodCs9YCAtLXRiLWljb249JHtlPy50YXNrYmFySWNvbn0gYCksZT8uZGlzYWJsZVJ1bnRpbWVIZWFydGJlYXRpbmcmJih0Kz1cIiAtLW5vLWhiIFwiKSxlPy5hdXRvSGlkZUNsaWVudFRhc2tiYXJJY29ucyYmKHQrPVwiIC0tdGItYXV0by1oaWRlIFwiKSxlPy50aGVtZSYmKHQrPWAgLS10aG09JHtlLnRoZW1lfSBgKSxlPy5kZWZhdWx0UmVzaXppbmdCZWhhdmlvciYmKHQrPWAgLS1yZXM9JHtlPy5kZWZhdWx0UmVzaXppbmdCZWhhdmlvcn0gYCk7Y29uc3Qgbj1hd2FpdCBmaW4uU3lzdGVtLmdldFJ1bnRpbWVJbmZvKCk7cmV0dXJuIHQrPWAtLXJ1bnRpbWUtcG9ydCAke24ucG9ydH0gYCx0Kz1gLS1ydW50aW1lLXZlcnNpb24gJHtuLnZlcnNpb259IGAsdC50cmltKCl9fWNvbnN0IGQ9YXN5bmMgZT0+e2xldCB0PShhd2FpdCBmaW4uU3lzdGVtLmdldFJ1bnRpbWVJbmZvKCkpLmFyZ3NbXCJsb2NhbC1zdGFydHVwLXVybFwiXS5yZXBsYWNlKFwiY29uZmlnLmpzb25cIixcIlwiKTtjb25zdCBuPXQuaW5jbHVkZXMoXCJcXFxcXCIpP1wiXFxcXFwiOlwiL1wiO3JldHVybiB0LmVuZHNXaXRoKG4pJiYodD10LnNsaWNlKDAsLTEpKSxbdCxcImFzc2V0c1wiLGUuYWxpYXMsZS52ZXJzaW9uLGUudGFyZ2V0XS5qb2luKG4pfSx1PSgpPT5cInVuZGVmaW5lZFwiIT10eXBlb2YgY3J5cHRvJiZcInJhbmRvbVVVSURcImluIGNyeXB0byYmXCJmdW5jdGlvblwiPT10eXBlb2YgY3J5cHRvLnJhbmRvbVVVSUQ/Y3J5cHRvLnJhbmRvbVVVSUQoKTpcIjEwMDAwMDAwLTEwMDAtNDAwMC04MDAwLTEwMDAwMDAwMDAwMFwiLnJlcGxhY2UoL1swMThdL2csKGU9PihlXmNyeXB0by5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQ4QXJyYXkoMSkpWzBdJjE1Pj5lLzQpLnRvU3RyaW5nKDE2KSkpLGg9ZT0+L15hcHA6XFwvW14vXStcXC9bXi9dKyQvLnRlc3QoZT8/XCJcIiksZj1lPT57Y29uc3QgdD1uZXcgTWFwO3JldHVybiBlLmZvckVhY2goKGU9Pntjb25zdCBuPSFlLm5hbWUsaT1lLm5hbWU/LnN0YXJ0c1dpdGgocCk/PyExLGE9ZS5jdXN0b21EYXRhPy5zbmFwQ2xpZW50SWQ7KG58fGl8fGgoZS5uYW1lKSkmJmEmJnQuc2V0KGEsZSl9KSksdH0seT0oZSx0LG4pPT57T2JqZWN0LnZhbHVlcyhlKS5mb3JFYWNoKChlPT57ZS5hdHRhY2hlZENsaWVudElkPT09dD9lLmF0dGFjaGVkQ2xpZW50SWQ9bjplLnRhcmdldENsaWVudElkPT09dCYmKGUudGFyZ2V0Q2xpZW50SWQ9bil9KSl9LHY9ZT0+e2lmKCFoKGUpKXJldHVybmAke3B9JHt1KCl9YDtjb25zdCB0PWUuc3BsaXQoXCIvXCIpO3JldHVybiB0W3QubGVuZ3RoLTFdPXUoKSx0LmpvaW4oXCIvXCIpfTt2YXIgdz1pLnE7ZXhwb3J0e3cgYXMgU25hcFNlcnZlcn07IiwiaW1wb3J0IHR5cGUgT3BlbkZpbiBmcm9tIFwiQG9wZW5maW4vY29yZVwiO1xuaW1wb3J0ICogYXMgU25hcCBmcm9tIFwiQG9wZW5maW4vc25hcC1zZGtcIjtcbmltcG9ydCB7IGdldFNldHRpbmdzIH0gZnJvbSBcIi4uL3NldHRpbmdzXCI7XG5pbXBvcnQgdHlwZSB7IFNuYXBQcm92aWRlck9wdGlvbnMgfSBmcm9tIFwiLi4vc2hhcGVzXCI7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSB0aGUgc25hcCBjb21wb25lbnRzLlxuICogQHBhcmFtIG9wdGlvbnMgVGhlIG9wdGlvbnMgZm9yIGluaXRpYWxpemluZyB0aGUgc25hcCBwcm92aWRlci5cbiAqIEBwYXJhbSBjcmVhdGVMYXlvdXRDaGFubmVsIFdoZXRoZXIgdG8gY3JlYXRlIGEgc2ltcGxlIGNoYW5uZWwgYXBpIHNlcnZpY2UgdGhhdCBleHBvc2VzIHRoZSBnZXRMYXlvdXQgYW5kIGFwcGx5TGF5b3V0IGZ1bmN0aW9uYWxpdHkgb2Ygc25hcC5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemUoXG5cdG9wdGlvbnM6IFNuYXBQcm92aWRlck9wdGlvbnMsXG5cdGNyZWF0ZUxheW91dENoYW5uZWw6IGJvb2xlYW4gPSBmYWxzZVxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGNvbnN0IHNldHRpbmdzID0gYXdhaXQgZ2V0U2V0dGluZ3MoKTtcblx0Y29uc3Qgc2V0dGluZ3NTZXJ2ZXJPcHRpb25zID0gc2V0dGluZ3M/LnNlcnZlck9wdGlvbnMgPz8ge307XG5cdGNvbnN0IHBhc3NlZE9wdGlvbnMgPSBvcHRpb25zPy5zZXJ2ZXJPcHRpb25zID8/IHt9O1xuXHRjb25zdCBmaW5hbE9wdGlvbnMgPSB7IC4uLnNldHRpbmdzU2VydmVyT3B0aW9ucywgLi4ucGFzc2VkT3B0aW9ucyB9O1xuXHRjb25zdCBmaW5hbFBsYXRmb3JtSWQgPSBvcHRpb25zPy5wbGF0Zm9ybUlkID8/IHNldHRpbmdzPy5wbGF0Zm9ybUlkO1xuXHR0cnkge1xuXHRcdGlmIChmaW5hbFBsYXRmb3JtSWQpIHtcblx0XHRcdGNvbnNvbGUubG9nKFwiUmVnaXN0ZXJpbmcgU25hcCB3aXRoIHBsYXRmb3JtSWRcIiwgZmluYWxQbGF0Zm9ybUlkKTtcblx0XHRcdGNvbnN0IHNlcnZlciA9IG5ldyBTbmFwLlNuYXBTZXJ2ZXIoZmluYWxQbGF0Zm9ybUlkKTtcblx0XHRcdGNvbnNvbGUubG9nKFwiRW5hYmxpbmcgZGVidWcgd2luZG93OlwiLCBmaW5hbE9wdGlvbnMuc2hvd0RlYnVnID8/IGZhbHNlKTtcblx0XHRcdGF3YWl0IHNlcnZlci5zdGFydChmaW5hbE9wdGlvbnMpO1xuXHRcdFx0aWYgKGNyZWF0ZUxheW91dENoYW5uZWwpIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRjb25zdCBjaGFubmVsTmFtZSA9IGAke2Zpbi5tZS5pZGVudGl0eS51dWlkfS1zbmFwLWxheW91dGA7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coYENoYW5uZWwgU2VydmljZTogQ3JlYXRpbmcgc25hcCBwcmVsb2FkIGxheW91dCBjaGFubmVsOiAke2NoYW5uZWxOYW1lfWApO1xuXHRcdFx0XHRcdGNvbnN0IGNoYW5uZWwgPSBhd2FpdCBmaW4uSW50ZXJBcHBsaWNhdGlvbkJ1cy5DaGFubmVsLmNyZWF0ZShjaGFubmVsTmFtZSk7XG5cdFx0XHRcdFx0Y2hhbm5lbC5yZWdpc3RlcihcImdldExheW91dFwiLCBhc3luYyAoKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgU2VydmljZTogR2V0dGluZyBsYXlvdXQgZnJvbSBTbmFwXCIpO1xuXHRcdFx0XHRcdFx0Y29uc3QgbGF5b3V0ID0gYXdhaXQgc2VydmVyLmdldExheW91dCgpO1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIFNlcnZpY2U6IEdvdCBsYXlvdXQgZnJvbSBTbmFwXCIsIGxheW91dCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gbGF5b3V0O1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGNoYW5uZWwucmVnaXN0ZXIoXCJhcHBseUxheW91dFwiLCBhc3luYyAocGF5bG9hZDogdW5rbm93bikgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIFNlcnZpY2U6IEFwcGx5aW5nIGxheW91dCB0byBTbmFwXCIsIHBheWxvYWQpO1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIFNlcnZpY2U6IFByZXBhcmluZyB0byBhcHBseSBzbmFwc2hvdFwiKTtcblx0XHRcdFx0XHRcdGF3YWl0IHNlcnZlci5wcmVwYXJlVG9BcHBseVNuYXBzaG90KCk7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgU2VydmljZTogQXBwbHlpbmcgc25hcHNob3RcIik7XG5cdFx0XHRcdFx0XHRhd2FpdCBzZXJ2ZXIuYXBwbHlTbmFwc2hvdChwYXlsb2FkIGFzIFNuYXAuU25hcFNuYXBzaG90KTtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBTZXJ2aWNlOiBBcHBsaWVkIHNuYXBzaG90XCIpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGNoYW5uZWwub25Db25uZWN0aW9uKGFzeW5jIChpZGVudGl0eSkgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIFNlcnZpY2U6IENvbm5lY3Rpb24gcmVxdWVzdCBmcm9tOlwiLCBpZGVudGl0eSk7XG5cdFx0XHRcdFx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLXRlbXBsYXRlXG5cdFx0XHRcdFx0XHRpZiAoaWRlbnRpdHkudXVpZCAhPT0gZmluLm1lLmlkZW50aXR5LnV1aWQpIHtcblx0XHRcdFx0XHRcdFx0Y29uc3QgbWVzc2FnZSA9IGBDaGFubmVsIFNlcnZpY2U6IFJlamVjdGluZyBjb25uZWN0aW9uIHJlcXVlc3QgYXMgaXQgaXMgbm90IGNvbWluZyBmcm9tIHdpdGhpbiB0aGUgYXBwbGljYXRpb24uIElkZW50aXR5IHNob3VsZCBiZTogJHtmaW4ubWUuaWRlbnRpdHkudXVpZH0gYW5kIGNvbm5lY3Rpb24gcmVxdWVzdCBpcyBjb21pbmcgZnJvbTogJHtpZGVudGl0eS51dWlkfWA7XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7XG5cdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRjaGFubmVsLm9uRGlzY29ubmVjdGlvbihhc3luYyAoaWRlbnRpdHkpID0+IHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBTZXJ2aWNlOiBEaXNjb25uZWN0aW9uIHJlcXVlc3QgZnJvbTpcIiwgaWRlbnRpdHkpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0c2V0VGltZW91dChhc3luYyAoKSA9PiB7XG5cdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcblx0XHRcdFx0XHRcdFx0XHRcIkNoYW5uZWwgQ2xpZW50OiBDb25uZWN0aW5nIHRvIHNuYXAgcHJlbG9hZCBsYXlvdXQgY2hhbm5lbCB0byB2YWxpZGF0ZSBjb25uZWN0aW9uLlwiXG5cdFx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHRcdGNvbnN0IGNsaWVudENoYW5uZWxOYW1lID0gYCR7ZmluLm1lLmlkZW50aXR5LnV1aWR9LXNuYXAtbGF5b3V0YDtcblx0XHRcdFx0XHRcdFx0Y29uc3Qgc25hcFByZWxvYWRDbGllbnQgPSBhd2FpdCBmaW4uSW50ZXJBcHBsaWNhdGlvbkJ1cy5DaGFubmVsLmNvbm5lY3QoY2xpZW50Q2hhbm5lbE5hbWUpO1xuXG5cdFx0XHRcdFx0XHRcdC8vIGZldGNoIHRoZSBjdXJyZW50IHNuYXAgbGF5b3V0XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBDbGllbnQ6IFJlcXVlc3RpbmcgbGF5b3V0IGZyb20gU25hcFwiKTtcblx0XHRcdFx0XHRcdFx0Y29uc3QgbGF5b3V0ID0gKGF3YWl0IHNuYXBQcmVsb2FkQ2xpZW50LmRpc3BhdGNoKFwiZ2V0TGF5b3V0XCIpKSBhcyBTbmFwLlNuYXBMYXlvdXQ7XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBDbGllbnQ6IEdvdCBsYXlvdXQgZnJvbSBTbmFwXCIsIGxheW91dCk7XG5cblx0XHRcdFx0XHRcdFx0Ly8gYXBwbHkgdGhlIGxheW91dFxuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgQ2xpZW50OiBBcHBseWluZyBsYXlvdXQgdG8gU25hcFwiKTtcblx0XHRcdFx0XHRcdFx0YXdhaXQgc25hcFByZWxvYWRDbGllbnQuZGlzcGF0Y2goXCJhcHBseUxheW91dFwiLCBsYXlvdXQpO1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgQ2xpZW50OiBBcHBsaWVkIGxheW91dCB0byBTbmFwXCIpO1xuXG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBDbGllbnQ6IEludGVudGlvbmFsbHkgZGlzY29ubmVjdGluZyBmcm9tIHNuYXAgcHJlbG9hZCBDaGFubmVsIFNlcnZpY2VcIik7XG5cdFx0XHRcdFx0XHRcdGF3YWl0IHNuYXBQcmVsb2FkQ2xpZW50LmRpc2Nvbm5lY3QoKTtcblx0XHRcdFx0XHRcdH0gY2F0Y2ggKGNsaWVudEVycm9yKSB7XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdFx0XHRcdFx0XCJDaGFubmVsIENsaWVudDogRXJyb3IgY29ubmVjdGluZyB0byBzbmFwIHByZWxvYWQgbGF5b3V0IENoYW5uZWwgU2VydmljZVwiLFxuXHRcdFx0XHRcdFx0XHRcdGNsaWVudEVycm9yXG5cdFx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSwgMTAwMCk7XG5cdFx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDaGFubmVsIFNlcnZpY2U6IEVycm9yIGNyZWF0aW5nIHNuYXAgbGF5b3V0IGNoYW5uZWxcIiwgZXJyKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Y29uc3QgYXBwID0gZmluLkFwcGxpY2F0aW9uLmdldEN1cnJlbnRTeW5jKCk7XG5cdFx0XHRhd2FpdCBhcHAub24oXCJ3aW5kb3ctY3JlYXRlZFwiLCBhc3luYyAoZSkgPT4ge1xuXHRcdFx0XHRjb25zdCB3aW4gPSBmaW4uV2luZG93LndyYXBTeW5jKGUpO1xuXHRcdFx0XHRjb25zdCB3aW5PcHRpb25zID0gYXdhaXQgd2luLmdldE9wdGlvbnMoKTtcblx0XHRcdFx0aWYgKCF3aW5PcHRpb25zLmluY2x1ZGVJblNuYXBzaG90cykge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiV2luZG93IGlzIG5vdCByZWdpc3RlcmVkIHdpdGggU25hcCBiZWNhdXNlIGluY2x1ZGVJblNuYXBzaG90cyBpcyBkaXNhYmxlZC5cIik7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc3QgbmF0aXZlSWQgPSBhd2FpdCB3aW4uZ2V0TmF0aXZlSWQoKTtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIlJlZ2lzdGVyaW5nIHdpbmRvdyB3aXRoIE5hdGl2ZUlEIHdpdGggU25hcFwiLCBuYXRpdmVJZCk7XG5cdFx0XHRcdFx0YXdhaXQgc2VydmVyLnJlZ2lzdGVyV2luZG93KHdpbi5pZGVudGl0eS5uYW1lLCBuYXRpdmVJZCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0Y29uc3QgaG9zdE9wdGlvbnMgPSAoYXdhaXQgZmluLm1lLmdldE9wdGlvbnMoKSkgYXMgT3BlbkZpbi5XaW5kb3dPcHRpb25zO1xuXHRcdFx0aWYgKGhvc3RPcHRpb25zLmF1dG9TaG93KSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKFwiUmVnaXN0ZXJpbmcgY3VycmVudCB3aW5kb3cgd2l0aCBzbmFwXCIpO1xuXHRcdFx0XHRhd2FpdCBzZXJ2ZXIucmVnaXN0ZXJXaW5kb3coZmluLm1lLmlkZW50aXR5Lm5hbWUsIGF3YWl0IGZpbi5XaW5kb3cuZ2V0Q3VycmVudFN5bmMoKS5nZXROYXRpdmVJZCgpKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKFwiQ3VycmVudCB3aW5kb3cgaXMgbm90IHJlZ2lzdGVyZWQgd2l0aCBTbmFwIGJlY2F1c2UgYXV0b1Nob3cgaXMgZGlzYWJsZWQuXCIpO1xuXHRcdFx0fVxuXHRcdH1cblx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0Y29uc29sZS5lcnJvcihcIkVycm9yIGluaXRpYWxpemluZyBTbmFwXCIsIGVycik7XG5cdH1cbn1cbiIsImltcG9ydCB0eXBlIHsgT3BlbkZpbiB9IGZyb20gXCJAb3BlbmZpbi9jb3JlXCI7XG5pbXBvcnQgdHlwZSB7IEN1c3RvbVNldHRpbmdzLCBTbmFwUHJvdmlkZXJPcHRpb25zIH0gZnJvbSBcIi4vc2hhcGVzXCI7XG5cbi8qKlxuICogR2V0cyBzZXR0aW5ncyBmcm9tIHRoZSBtYW5pZmVzdC5cbiAqIEBwYXJhbSBzaG93RGVidWdXaW5kb3cgV2hldGhlciB0byBlbmFibGUgdGhlIGRlYnVnIHdpbmRvdyByZWdhcmRsZXNzIG9mIG1hbmlmZXN0IHNldHRpbmdzLlxuICogQHJldHVybnMgVGhlIHNuYXAgcHJvdmlkZXIgb3B0aW9ucyBmcm9tIHRoZSBtYW5pZmVzdC5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNldHRpbmdzKHNob3dEZWJ1Z1dpbmRvdz86IGJvb2xlYW4pOiBQcm9taXNlPFNuYXBQcm92aWRlck9wdGlvbnM+IHtcblx0Y29uc3QgYXBwID0gYXdhaXQgZmluLkFwcGxpY2F0aW9uLmdldEN1cnJlbnQoKTtcblx0Y29uc3QgbWFuaWZlc3QgPSBhd2FpdCBhcHAuZ2V0TWFuaWZlc3QoKTtcblx0aWYgKG1hbmlmZXN0LmFwcEFzc2V0cz8uWzBdPy5zcmMgPT09IFwiU05BUF9BU1NFVF9VUkxcIikge1xuXHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcIlBsZWFzZSByZXF1ZXN0IHRoZSBTTkFQX0FTU0VUX1VSTCBmcm9tIE9wZW5GaW4gYW5kIHVwZGF0ZSBtYW5pZmVzdC5maW4uanNvbiBiZWZvcmUgcnVubmluZyB0aGUgc2FtcGxlXCJcblx0XHQpO1xuXHR9XG5cdGNvbnN0IHNldHRpbmdzID0gYXdhaXQgZ2V0TWFuaWZlc3RDdXN0b21TZXR0aW5ncyhtYW5pZmVzdCk7XG5cdHNldHRpbmdzLnNuYXBQcm92aWRlciA/Pz0ge307XG5cdGlmIChzZXR0aW5ncy5zbmFwUHJvdmlkZXIuc2VydmVyT3B0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0c2V0dGluZ3Muc25hcFByb3ZpZGVyLnNlcnZlck9wdGlvbnMgPSB7XG5cdFx0XHRzaG93RGVidWc6IHNob3dEZWJ1Z1dpbmRvd1xuXHRcdH07XG5cdH1cblx0cmV0dXJuIHNldHRpbmdzLnNuYXBQcm92aWRlcjtcbn1cblxuLyoqXG4gKiBSZWFkIHRoZSBjdXN0b20gc2V0dGluZ3MgZnJvbSB0aGUgbWFuaWZlc3QuZmluLmpzb24uXG4gKiBAcGFyYW0gbWFuaWZlc3QgVGhlIG1hbmlmZXN0IHRvIGxvYWQgdGhlIGN1c3RvbSBzZXR0aW5ncyBmcm9tLlxuICogQHJldHVybnMgVGhlIGN1c3RvbSBzZXR0aW5ncyBmcm9tIHRoZSBtYW5pZmVzdC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TWFuaWZlc3RDdXN0b21TZXR0aW5ncyhtYW5pZmVzdDogT3BlbkZpbi5NYW5pZmVzdCk6IFByb21pc2U8Q3VzdG9tU2V0dGluZ3M+IHtcblx0cmV0dXJuIChtYW5pZmVzdCBhcyBPcGVuRmluLk1hbmlmZXN0ICYgeyBjdXN0b21TZXR0aW5ncz86IEN1c3RvbVNldHRpbmdzIH0pLmN1c3RvbVNldHRpbmdzID8/IHt9O1xufVxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJpbXBvcnQgdHlwZSB7IFNuYXBQcm92aWRlck9wdGlvbnMgfSBmcm9tIFwiLi4vc2hhcGVzXCI7XG5pbXBvcnQgeyBpbml0aWFsaXplIH0gZnJvbSBcIi4vcHJlbG9hZC5jb21tb25cIjtcblxuaWYgKHdpbmRvdyA9PT0gd2luZG93LnRvcCkge1xuXHRjb25zb2xlLmxvZyhcIkFkZGluZyBzbmFwIHN1cHBvcnQgdGhyb3VnaCBhIHByZWxvYWQgd2l0aCBsYXlvdXQgc3VwcG9ydC5cIik7XG5cblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzbmFwT3B0aW9uczogU25hcFByb3ZpZGVyT3B0aW9ucyA9IHtcblx0XHRcdHBsYXRmb3JtSWQ6IGZpbi5tZS5pZGVudGl0eS51dWlkXG5cdFx0fTtcblx0XHRhd2FpdCBpbml0aWFsaXplKHNuYXBPcHRpb25zLCB0cnVlKTtcblx0fSk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=