{"version":3,"file":"get-user-decision-for-beforeunload.bundle.js","mappings":"AAMO,MAAMA,EAAgE,CAC5EC,iBAAkB,ICQZ,MA4BC,gBAAMC,CACZC,EACAC,EACAC,GAEAC,KAAKC,YAAcJ,EACnBG,KAAKE,QAAUJ,EAAc,kCAC7BE,KAAKG,SAAWJ,EAEhBC,KAAKE,QAAQE,KAAK,eACnB,CAMO,eAAMC,GACZL,KAAKE,SAASE,KAAK,YACpB,CAOO,4BAAME,CACZC,GAEA,OAAQC,IAGP,MAAMC,EAAaT,KAAKC,aAAaS,MAAQ,CAAC,EACxCC,EAASX,KAAKE,QACdH,EAAUC,KAAKG,SAIrB,OAAO,cAAqCK,EAI3C,WAAAI,GACCC,QAEAF,GAAQP,KACP,mBAAmBU,KAAKC,UAAUR,uBAA6BO,KAAKC,UAAUN,uBAAgCV,GAASiB,YAEzH,CAcO,oCAAMC,CACZC,GAGA,GADAP,GAAQP,KAAK,yCAA0Cc,GACnDA,EAAQC,sBAAsBC,OAAS,GAAKrB,GAASsB,gBAAiB,CACzE,MAAMC,QAAqBvB,GAASsB,mBACpC,IAAIE,EAAQ,0BACRC,EAAU,4DACVC,EAAoB,SACpBC,EAAmB,QAEnBjB,GAAYc,OAASd,EAAWc,MAAMI,OAAOP,OAAS,IACzDG,EAAQd,EAAWc,OAEhBd,GAAYe,SAAWf,EAAWe,QAAQG,OAAOP,OAAS,EAC7DI,EAAUf,EAAWe,QAAQI,QAAQ,eAAgBV,EAAQW,WAC7B,WAAtBX,EAAQW,UAClBL,EACC,wFAC+B,SAAtBN,EAAQW,UAClBL,EAAU,sFACsB,SAAtBN,EAAQW,YAClBL,EAAU,uEAGPf,GAAYgB,mBAAqBhB,EAAWgB,kBAAkBE,OAAOP,OAAS,IACjFK,EAAoBhB,EAAWgB,mBAG5BhB,GAAYiB,kBAAoBjB,EAAWiB,iBAAiBC,OAAOP,OAAS,IAC/EM,EAAmBjB,EAAWiB,kBAG/B,MAAMI,QAAeR,GAAcS,iBAClC,CACCR,QACAC,UACAQ,QAAS,CACR,CACCC,MAAOR,EACPS,GAAI,UAEL,CACCD,MAAOP,EACPQ,GAAI,WAIPhB,EAAQiB,WAET,GAAIL,EACH,MAAkB,UAAdA,EAAOI,GAEH,CACNE,mBAAmB,EACnBC,aAHa,IAAInB,EAAQoB,4BAA6BpB,EAAQC,wBAMzD,CAAEiB,mBAAmB,EAAOC,aAAc,GAEnD,CACA,OAAOxB,MAAMI,+BAA+BC,EAC7C,EACA,CAEH,W","sources":["webpack://openfin-workspace--workspace-platform-starter/./client/src/modules/platform-override/get-user-decision-for-beforeunload/index.ts","webpack://openfin-workspace--workspace-platform-starter/./client/src/modules/platform-override/get-user-decision-for-beforeunload/platform-override.ts"],"sourcesContent":["import type { ModuleImplementation, ModuleTypes } from \"workspace-platform-starter/shapes/module-shapes\";\nimport { GetUserDecisionForBeforeunload } from \"./platform-override\";\n\n/**\n * Define the entry points for the module.\n */\nexport const entryPoints: { [type in ModuleTypes]?: ModuleImplementation } = {\n\tplatformOverride: new GetUserDecisionForBeforeunload()\n};\n","// eslint-disable-next-line max-classes-per-file\nimport type OpenFin from \"@openfin/core\";\nimport type { ViewsPreventingUnloadPayload, WorkspacePlatformProvider } from \"@openfin/workspace-platform\";\nimport type { Logger, LoggerCreator } from \"workspace-platform-starter/shapes/logger-shapes\";\nimport type { ModuleDefinition } from \"workspace-platform-starter/shapes/module-shapes\";\nimport type {\n\tPlatformOverride,\n\tPlatformOverrideHelpers,\n\tPlatformOverrideOptions\n} from \"workspace-platform-starter/shapes/platform-shapes\";\nimport type { GetUserDecisionForBeforeunloadOptions } from \"./shapes\";\n\n/**\n * Implementation for the get user decision for beforeunload platform override.\n */\nexport class GetUserDecisionForBeforeunload\n\timplements PlatformOverride<GetUserDecisionForBeforeunloadOptions>\n{\n\t/**\n\t * The module definition including settings.\n\t * @internal\n\t */\n\tprivate _definition: ModuleDefinition<GetUserDecisionForBeforeunloadOptions> | undefined;\n\n\t/**\n\t * The logger for displaying information from the module.\n\t * @internal\n\t */\n\tprivate _logger?: Logger;\n\n\t/**\n\t * Helper methods for the module.\n\t * @internal\n\t */\n\tprivate _helpers: PlatformOverrideHelpers | undefined;\n\n\t/**\n\t * Initialize the module.\n\t * @param definition The definition of the module from configuration include custom options.\n\t * @param loggerCreator For logging entries.\n\t * @param helpers Helper methods for the module to interact with the application core.\n\t * @returns Nothing.\n\t */\n\tpublic async initialize(\n\t\tdefinition: ModuleDefinition<GetUserDecisionForBeforeunloadOptions>,\n\t\tloggerCreator: LoggerCreator,\n\t\thelpers: PlatformOverrideHelpers\n\t): Promise<void> {\n\t\tthis._definition = definition;\n\t\tthis._logger = loggerCreator(\"GetUserDecisionForBeforeunload\");\n\t\tthis._helpers = helpers;\n\n\t\tthis._logger.info(\"Initializing\");\n\t}\n\n\t/**\n\t * Close down any resources being used by the module.\n\t * @returns Nothing.\n\t */\n\tpublic async closedown(): Promise<void> {\n\t\tthis._logger?.info(\"Closedown\");\n\t}\n\n\t/**\n\t * Get the override constructor for the platform override (useful if you wish this implementation to be layered with other implementations and passed to the platform's initialization object as part of an array).\n\t * @param options The options for the platform override defined as part of the platform.\n\t * @returns The override constructor to be used in an array.\n\t */\n\tpublic async getConstructorOverride(\n\t\toptions: PlatformOverrideOptions\n\t): Promise<OpenFin.ConstructorOverride<WorkspacePlatformProvider>> {\n\t\treturn (Base: OpenFin.Constructor<WorkspacePlatformProvider>) => {\n\t\t\t// use settings passed through the module definition in your override or the default options passed with the function call\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\t\t\tconst moduleData = this._definition?.data ?? {};\n\t\t\tconst logger = this._logger;\n\t\t\tconst helpers = this._helpers;\n\t\t\t/**\n\t\t\t * Extend the Platform Override.\n\t\t\t */\n\t\t\treturn class CustomPlatformOverride extends Base {\n\t\t\t\t/**\n\t\t\t\t * Constructor for the interop override.\n\t\t\t\t */\n\t\t\t\tconstructor() {\n\t\t\t\t\tsuper();\n\t\t\t\t\t// this is just an example to show a reference to the options, module data and local reference to the passed helpers.\n\t\t\t\t\tlogger?.info(\n\t\t\t\t\t\t`Options passed: ${JSON.stringify(options)} and module data: ${JSON.stringify(moduleData)} with session id: ${helpers?.sessionId}`\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Handle the decision of whether a Window, Page or specific View should close when trying to prevent an unload. This is meant to be overridden.\n\t\t\t\t * Called in {@link WorkspacePlatformProvider.closeWindow} and {@link WorkspacePlatformProvider.closeView}.\n\t\t\t\t *\n\t\t\t\t * When closing a Page, this override is called by {@link WorkspacePlatformProvider.shouldPageClose}\n\t\t\t\t * and page proceeds to close if all views passed in are determined to close. In this case, the `closeType` property will have `'page'` value.\n\t\t\t\t *\n\t\t\t\t * Normally you would use this method to show a dialog indicating that there are Views that are trying to prevent an unload.\n\t\t\t\t * By default it will always return all Views passed into it as meaning to close.\n\t\t\t\t * @param payload payload containing the views that are preventing an unload, views that are not, and the type of close operation\n\t\t\t\t * @returns `Promise<{windowShouldClose: boolean, viewsToClose: OpenFin.Identity[]}>`\n\t\t\t\t */\n\t\t\t\tpublic async getUserDecisionForBeforeUnload(\n\t\t\t\t\tpayload: ViewsPreventingUnloadPayload\n\t\t\t\t): Promise<OpenFin.BeforeUnloadUserDecision> {\n\t\t\t\t\tlogger?.info(\"getUserDecisionForBeforeUnload called:\", payload);\n\t\t\t\t\tif (payload.viewsPreventingUnload.length > 0 && helpers?.getDialogClient) {\n\t\t\t\t\t\tconst dialogClient = await helpers?.getDialogClient();\n\t\t\t\t\t\tlet title = \"Unsaved content changes\";\n\t\t\t\t\t\tlet message = \"You have unsaved changes. Are you sure you want to close?\";\n\t\t\t\t\t\tlet cancelButtonLabel = \"Cancel\";\n\t\t\t\t\t\tlet closeButtonLabel = \"Close\";\n\n\t\t\t\t\t\tif (moduleData?.title && moduleData.title.trim().length > 0) {\n\t\t\t\t\t\t\ttitle = moduleData.title;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (moduleData?.message && moduleData.message.trim().length > 0) {\n\t\t\t\t\t\t\tmessage = moduleData.message.replace(\"{CLOSE_TYPE}\", payload.closeType);\n\t\t\t\t\t\t} else if (payload.closeType === \"window\") {\n\t\t\t\t\t\t\tmessage =\n\t\t\t\t\t\t\t\t\"You have unsaved changes in your content. Are you sure you want to close this window?\";\n\t\t\t\t\t\t} else if (payload.closeType === \"page\") {\n\t\t\t\t\t\t\tmessage = \"You have unsaved changes in your content. Are you sure you want to close this page?\";\n\t\t\t\t\t\t} else if (payload.closeType === \"view\") {\n\t\t\t\t\t\t\tmessage = \"You have unsaved changes. Are you sure you want to close this view?\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (moduleData?.cancelButtonLabel && moduleData.cancelButtonLabel.trim().length > 0) {\n\t\t\t\t\t\t\tcancelButtonLabel = moduleData.cancelButtonLabel;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (moduleData?.closeButtonLabel && moduleData.closeButtonLabel.trim().length > 0) {\n\t\t\t\t\t\t\tcloseButtonLabel = moduleData.closeButtonLabel;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst result = await dialogClient?.showConfirmation(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlabel: cancelButtonLabel,\n\t\t\t\t\t\t\t\t\t\tid: \"cancel\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlabel: closeButtonLabel,\n\t\t\t\t\t\t\t\t\t\tid: \"close\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpayload.windowId\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\tif (result.id === \"close\") {\n\t\t\t\t\t\t\t\tconst views = [...payload.viewsNotPreventingUnload, ...payload.viewsPreventingUnload];\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\twindowShouldClose: true,\n\t\t\t\t\t\t\t\t\tviewsToClose: views\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn { windowShouldClose: false, viewsToClose: [] };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn super.getUserDecisionForBeforeUnload(payload);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t}\n}\n"],"names":["entryPoints","platformOverride","initialize","definition","loggerCreator","helpers","this","_definition","_logger","_helpers","info","closedown","getConstructorOverride","options","Base","moduleData","data","logger","constructor","super","JSON","stringify","sessionId","getUserDecisionForBeforeUnload","payload","viewsPreventingUnload","length","getDialogClient","dialogClient","title","message","cancelButtonLabel","closeButtonLabel","trim","replace","closeType","result","showConfirmation","buttons","label","id","windowId","windowShouldClose","viewsToClose","viewsNotPreventingUnload"],"sourceRoot":""}