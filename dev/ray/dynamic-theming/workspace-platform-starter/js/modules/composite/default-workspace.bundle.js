var e;function t(e){return null==e}function a(e){return function(e){return null!=e&&"string"==typeof e}(e)&&e.trim().length>0}!function(e){e.CustomButton="CustomButton",e.StoreCustomButton="StoreCustomButton",e.CustomDropdownItem="CustomDropdownItem",e.GlobalContextMenu="GlobalContextMenu",e.ViewTabContextMenu="ViewTabContextMenu",e.PageTabContextMenu="PageTabContextMenu",e.SaveButtonContextMenu="SaveButtonContextMenu",e.API="API"}(e||(e={}));class s{async initialize(e,t,a){this._logger=a,this._helpers=t,this._settings=e,await this.setupEndpointClient(),await this.setVersionInfo()}async setDefaultWorkspace(e){const a=this._settings?.payloadId??"default-workspace",s=this._settings?.endpointIds?.setDefaultWorkspace??"set-default-workspace";return t(this._endpointClient)||t(this._versionInfo)||!this._endpointClient.hasEndpoint(s)?(this._logger?.warn("Unable to set the default workspace as the access to the endpoint client, version info or the endpoint is not available."),!1):await this._endpointClient.action(s,{id:a,platform:fin.me.identity.uuid,metaData:{version:{workspacePlatformClient:this._versionInfo.workspacePlatformClient,platformClient:this._versionInfo.platformClient}},payload:e})}async getDefaultWorkspace(){const e=this._settings?.payloadId??"default-workspace",a=this._settings?.endpointIds?.getDefaultWorkspace??"get-default-workspace",s={useLastActiveWorkspace:!1,workspaceId:""};if(!t(this._endpointClient)&&this._endpointClient.hasEndpoint(a)){const t=await this._endpointClient.requestResponse(a,{platform:fin.me.identity.uuid,id:e});return t?.payload??s}return this._logger?.warn("Unable to get the default workspace as the access to the endpoint client or the endpoint is not available."),s}async setupEndpointClient(){return!t(this._helpers?.getEndpointClient)&&(this._endpointClient=await(this._helpers?.getEndpointClient()),!0)}async setVersionInfo(){return!t(this._helpers?.getVersionInfo)&&(this._versionInfo=await(this._helpers?.getVersionInfo()),!0)}}const o={menus:new class{async initialize(e,t,a){this._logger=t("SetDefaultWorkspaceProvider"),this._settings=e.data,this._logger.info("Initializing"),this._defaultWorkspaceStorage=new s,await this._defaultWorkspaceStorage.initialize(e?.data,a,this._logger)}async closedown(){this._logger?.info("Closedown")}async get(e,s,o){if("global"===e&&!t(o?.windowIdentity)&&!t(this._defaultWorkspaceStorage)){const e=await this._defaultWorkspaceStorage.getDefaultWorkspace(),t=e.useLastActiveWorkspace,o=e.workspaceId,i=await s.Storage.getWorkspaces(),n=await s.getCurrentWorkspace();i.sort(((e,t)=>e.title.localeCompare(t.title)));const r={include:!0,label:this._settings?.defaultWorkspace?.menuLabel??"Default Workspace",icon:this._settings?.defaultWorkspace?.menuIcon,enabled:i.length>0,submenu:[],position:{type:"Downloads",operation:"before",customId:"DefaultWorkspace",...this._settings?.defaultWorkspace?.menuPosition}},c=this._settings?.reset?.include??!0;r.submenu?.push({label:this._settings?.reset?.menuLabel??"None",icon:this._settings?.reset?.menuIcon,visible:c,enabled:t||a(o),checked:!t&&!a(o),type:"checkbox",data:{type:"Custom",action:{id:"set-default-workspace",customData:{workspaceId:"",useLastActiveWorkspace:!1}}}});const l=this._settings?.lastActive?.include??!0;if(r.submenu?.push({label:this._settings?.lastActive?.menuLabel??"Last Active Workspace",icon:this._settings?.lastActive?.menuIcon,visible:l,checked:t,enabled:!t,type:"checkbox",data:{type:"Custom",action:{id:"set-default-workspace",customData:{workspaceId:n?.workspaceId??"",useLastActiveWorkspace:!0}}}}),i.length>0){const e=this._settings?.lastActive?.lastActiveWorkspaceLabel??" [Active Workspace]";for(const a of i)r.submenu?.push({label:t&&a.workspaceId===o?`${a.title} ${e}`:a.title,enabled:a.workspaceId!==o||t,checked:!t&&a.workspaceId===o,type:"checkbox",data:{type:"Custom",action:{id:"set-default-workspace",customData:{workspaceId:a.workspaceId,useLastActiveWorkspace:!1}}}})}const p=[];return p.push(r),p}}},lifecycle:new class{async initialize(e,t,a){this._logger=t("ApplyDefaultWorkspaceProvider"),this._helpers=a,this._defaultWorkspaceStorage=new s,await this._defaultWorkspaceStorage.initialize(e?.data,a,this._logger),this._logger.info("Initializing")}async closedown(){this._logger?.info("Closedown")}async get(){const e={};return e["after-bootstrap"]=async(e,s)=>{try{const e=await(this._defaultWorkspaceStorage?.getDefaultWorkspace()),s=e?.workspaceId;if(a(s)&&!t(this._helpers?.launchWorkspace)){this._logger?.info(`Retrieved workspace id: ${e?.workspaceId} and we have the ability to launch a workspace. Applying the workspace.`);const t=await(this._helpers?.launchWorkspace(s,this._logger));this._logger?.info(`Workspace Id ${s} applied: ${t}`)}}catch(e){this._logger?.error("There was an error trying to apply to get or apply the default workspace.",e)}},e["workspace-changed"]=async(e,a)=>{if(!t(a)){const e=a;if(("update"===e.action||"create"===e.action||"apply"===e.action)&&!t(this._defaultWorkspaceStorage))try{if((await this._defaultWorkspaceStorage.getDefaultWorkspace()).useLastActiveWorkspace){const t=await this._defaultWorkspaceStorage.setDefaultWorkspace({workspaceId:e.id,useLastActiveWorkspace:!0});this._logger?.info(`Default workspace updated to workspace: ${e.id} through last active workspace: ${t}`)}}catch(t){this._logger?.error(`Unable to update default workspace to workspace id: ${e.id} because an error occurred.`,t)}}},e}},actions:new class{async initialize(e,t,a){this._logger=t("DefaultWorkspaceAction"),this._defaultWorkspaceStorage=new s,await this._defaultWorkspaceStorage.initialize(e?.data,a,this._logger)}async get(a){const s={};return s["set-default-workspace"]=async a=>{if(a.callerType===e.GlobalContextMenu)try{if(t(a.customData)||t(this._defaultWorkspaceStorage))this._logger?.warn("An action for setting the default workspace was not passed a payload and cannot be processed.");else{const e=await this._defaultWorkspaceStorage.setDefaultWorkspace(a.customData);this._logger?.info(`The default workspace state has been updated: ${e}`,a.customData)}}catch{this._logger?.info("Cannot set the default workspace with the information provided.")}},s}}};export{o as entryPoints};
//# sourceMappingURL=default-workspace.bundle.js.map