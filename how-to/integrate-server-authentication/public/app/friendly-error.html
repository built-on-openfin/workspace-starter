<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<title>Friendly Error Page</title>
		<link rel="icon" type="image/x-icon" href="../favicon.ico" />
		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="../common/style/app.css" />
	</head>

	<body class="col fill gap20">
		<header class="row spread middle">
			<div class="col">
				<h1>Friendly Error Page</h1>
				<h1 class="tag">We are on the unhappy path.</h1>
			</div>
			<div class="row middle gap20">
				<image src="../common/images/icon-blue.png" alt="OpenFin" height="40px"></image>
			</div>
		</header>
		<main class="col fill gap10">
			<p>
				The provider has not been loaded due to an error so the platform cannot perform the necessary
				bootstrapping steps to launch the platform.
			</p>
			<p>If you logout and exit you will be presented with the login screen again.</p>
			<p>If you just exit you will be presented with this screen again.</p>
		</main>
		<footer class="row right gap20">
			<button id="btnLogout">Logout and Exit</button>
			<button id="btnExit">Exit</button>
		</footer>

		<script>
			const btnLogout = document.querySelector('#btnLogout');
			btnLogout.addEventListener('click', async () => {
				try {
					// Get CSRF token first
					const tokenResponse = await fetch('http://localhost:8080/api/csrf-token');
					const { csrfToken } = await tokenResponse.json();
					
					// On logout the session cookies are cleared and close the app
					await fetch('http://localhost:8080/app/logout', {
						method: 'post',
						headers: {
							'X-CSRF-Token': csrfToken
						}
					});
					await fin.Application.getCurrentSync().quit();
				} catch (error) {
					console.error('Logout failed:', error);
				}
			});
			const btnExit = document.querySelector('#btnExit');
			btnExit.addEventListener('click', async () => {
				await fin.Application.getCurrentSync().quit();
			});
		</script>
	</body>
</html>
