/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "../../node_modules/@openfin/snap-sdk/openfin.snap.mjs":
/*!*************************************************************!*\
  !*** ../../node_modules/@openfin/snap-sdk/openfin.snap.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   SnapServer: () => (/* binding */ w)
/* harmony export */ });
var e={827:e=>{var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,i){function a(n){e.removeListener(t,r),i(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",a),n([].slice.call(arguments))}y(e,t,r,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}(e,a,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function p(e,t,n,i){var a,r,o,p;if(s(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),o=r[t]),void 0===o)o=r[t]=n,++e._eventsCount;else if("function"==typeof o?o=r[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(a=c(e))>0&&o.length>a&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,p=l,console&&console.warn&&console.warn(p)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},a=l.bind(i);return a.listener=n,i.wrapFn=a,a}function u(e,t,n){var i=e._events;if(void 0===i)return[];var a=i[t];return void 0===a?[]:"function"==typeof a?n?[a.listener||a]:[a]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(a):f(a,a.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function y(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function a(r){i.once&&e.removeEventListener(t,a),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var a="error"===e,r=this._events;if(void 0!==r)a=a&&void 0===r.error;else if(!a)return!1;if(a){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var p=c.length,l=f(c,p);for(n=0;n<p;++n)i(l[n],this,t)}return!0},r.prototype.addListener=function(e,t){return p(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return p(this,e,t,!0)},r.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,a,r,o;if(s(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(a=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){o=n[r].listener,a=r;break}if(a<0)return this;0===a?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,a),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var a,r=Object.keys(n);for(i=0;i<r.length;++i)"removeListener"!==(a=r[i])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};n.d(i,{q:()=>l});var a=n(827);const r="openfin-snap",o="1.3.2",s=(e,t)=>`${e} ${t instanceof Error?t.message:"string"==typeof t?t:JSON.stringify(t)}`,c=async()=>{try{return(await fin.System.getAppAssetInfo({alias:r})).version===o}catch(e){return!1}},p="internal-generated-window-";class l{constructor(e){if(this.server_id=e,this.emitter=new a.EventEmitter,this.__extensions=[],!fin)throw new Error("OpenFin is not available")}async start(e){try{const e=await fin.System.getRuntimeInfo();"x64"!==e?.architecture&&console.warn(`The architecture of the connected OpenFin runtime is '${e.architecture}' - Window snapping is currently only supported with 64-bit applications. Snapping will be disabled.`)}catch(e){console.warn(`Could not get runtime info: ${e}`)}const t=await fin.System.queryPermissionForCurrentContext("System.launchExternalProcess");if(!t.granted)throw new Error("The 'System.launchExternalProcess' permission is required to launch the Snap server");if(t.rawValue){if(e?.executablePath&&!t.rawValue?.executables?.enabled)throw new Error("The 'System.launchExternalProcess.assets' permission is required to launch the Snap server from an executable path");if(!e?.executablePath&&!t.rawValue?.assets?.enabled)throw new Error("The 'System.launchExternalProcess.assets' permission is required to launch the Snap server from a URL")}e?.executablePath||await(async e=>{const t=await fin.Application.getCurrentSync().getManifest(),n=t.appAssets?.find((e=>e.alias===r));if(n)return void console.warn("Detected Snap package in app manifest appAssets",n);if(await c())return void console.info("Using existing Snap package");const i=e??`https://cdn.openfin.co/release/snap/${o}/snap.zip`;console.info(`Downloading Snap asset from: '${i}'`);const a={alias:r,src:`${i}`,target:"OpenFinSnap.exe",version:o};console.info("Downloading Snap package",a);try{await fin.System.downloadAsset(a,(()=>{}))}catch(e){throw new Error(s("Unable to download Snap package.",e))}})(e?.customSnapAssetSource);const n=await this.build_command_line(e);let i={alias:r,arguments:n,lifetime:"window"};e?.executablePath&&(i={path:e.executablePath,arguments:n,lifetime:"window"});try{this.snap_identity=await fin.System.launchExternalProcess(i)}catch(e){throw new Error(s("Failed to launch the Snap server.",e))}return this.connect()}async connect(){this.client=await fin.InterApplicationBus.Channel.connect(`snap-server-core-${this.server_id}`),this.client.register("snap_handshake",(async(e,t)=>{try{await fin.System.registerUsage({type:"adapter-feature",data:{apiVersion:e.version,componentName:"snap-server"}})}catch{console.warn("SnapSDK: Failed to register usage for Snap Server")}}));try{await fin.System.registerUsage({type:"adapter-feature",data:{apiVersion:"1.3.2",componentName:"snap-client"}})}catch{console.warn("SnapSDK: Failed to register usage for Snap Server")}this.client.register("snap_updates",((e,t)=>this.handleSnapEvents(e,t))),this.__extensions.forEach((e=>e.onConnected(this.client)))}__addExtension(e){this.__extensions.push(e)}async stop(){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"shutdown"}))}async getLayout(){if(!this.client)throw new Error("Snap server is not running");const e=await(this.client?.dispatch("snap_api_invoke",{action:"serialiseLayout"}));return e?.payload.layout}async setLayout(e,t=!0){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"deserialiseLayout",payload:{layout:e,reset:t}}))}async enterDeferredLayout(){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"enterBatchMode"}))}async exitDeferredLayout(){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"exitBatchMode"}))}async prepareToApplySnapshot(e,t){if(!e||e.options?.closeExistingWindows||e.options?.closeSnapshotWindows)return this.needToResetLayout=!0,void await(this.client?.dispatch("snap_api_invoke",{action:"resetAll"}));this.needToResetLayout=!1;const n=e.snapshot,i=JSON.stringify(n,null,2),a=n.snap;if(!a)return;await(this.client?.dispatch("snap_api_invoke",{action:"prepareToApplyLayout"}));const r=t??v,o=(await this.getLayout())?.clients.map((e=>e.id))??[],s=f(n.windows),c=Array.from(s.keys()).filter((e=>o.includes(e)));a.clients.filter((e=>c.includes(e.id))).forEach((e=>{const t=e.id,n=r(t);e.id=n,y(a.connections,t,n);const i=s.get(t);i.customData.snapClientId=n,i.name=n}));const p=JSON.stringify(n,null,2);console.debug(`Snap SDK modified snapshot data before applying it.\nOriginal snapshot:\n${i}\nModified snapshot:\n${p}`)}async decorateSnapshot(e){return{...e,snap:await this.getLayout()}}async applySnapshot(e){e.snap&&await this.setLayout(e.snap,this.needToResetLayout)}async launch(e){if(!this.client)throw new Error("Not connected to an Snap server");e.appAssetInfo&&(e.path=await d({target:e.path,...e.appAssetInfo})),console.log("options: ",e);const t={action:"startProcess",payload:{...e,args:e.args||[]}};if(e.strategy){const{type:n,...i}=e.strategy;t.payload.strategy={type:n,parameters:{...i}}}const n=await(this.client?.dispatch("snap_api_invoke",t));if(n?.payload?.success)return{process_id:n.payload.process_id};throw new Error(`Failed to launch process: ${n?.payload?.error}`)}async registerWindow(e,t,n){await(this.client?.dispatch("snap_api_invoke",{action:"hookAndRegisterWindow",payload:{clientId:e,windowHandle:t,resizingBehavior:n}}))}async enableAutoWindowRegistration(){const e=e=>this.handleNewWindow(e);return await fin.Platform.getCurrentSync().addListener("window-created",e),async()=>{await fin.System.removeListener("window-created",e)}}async attachWindows(e,t,n,i){await(this.client?.dispatch("snap_api_invoke",{action:"attach",payload:{targetClientId:e,toAttachClientId:t,targetSide:n,offset:i}}))}async detachFromGroup(e){await(this.client?.dispatch("snap_api_invoke",{action:"detachFromGroup",payload:{clientId:e}}))}async getAttached(e){return(await(this.client?.dispatch("snap_api_invoke",{action:"getAttachedInstances",payload:{clientId:e}}))).payload.attached}async hasAttachments(e){return(await(this.client?.dispatch("snap_api_invoke",{action:"hasAttachments",payload:{clientId:e}}))).payload.hasAttachments}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}once(e,t){this.emitter.once(e,t)}async getGroupIdForWindow(e){const t="number"==typeof e?{nativeWindowId:e}:{clientId:e},n=await(this.client?.dispatch("snap_api_invoke",{action:"getGroupIdForWindow",payload:t}));if(!n.payload.groupId)throw new Error("No group found for window");return n.payload.groupId}async getWindowResizable(e){const t="number"==typeof e?{nativeWindowId:e}:{clientId:e},n=await(this.client?.dispatch("snap_api_invoke",{action:"getResizable",payload:t}));if(null===n.payload.resizable)throw new Error("No window found for given ID");return n.payload.resizable}async setWindowResizable(e,t){const n="number"==typeof e?{nativeWindowId:e,resizable:t}:{clientId:e,resizable:t};await(this.client?.dispatch("snap_api_invoke",{action:"setResizable",payload:n}))}async getWindowsInGroup(e){const t=await(this.client?.dispatch("snap_api_invoke",{action:"getWindowsInGroup",payload:{groupId:e}}));return t.payload.windows?t.payload.windows.map((e=>({nativeId:e[0],clientId:e[1]}))):[]}async getAllGroupIds(){return(await(this.client?.dispatch("snap_api_invoke",{action:"getAllGroupIds"}))).payload.groupIds}async minimizeGroup(e){await(this.client?.dispatch("snap_api_invoke",{action:"minimizeGroup",payload:{groupId:e}}))}async restoreGroup(e){await(this.client?.dispatch("snap_api_invoke",{action:"restoreGroup",payload:{groupId:e}}))}async handleNewWindow(e){const t=await fin.Window.wrap({uuid:e.uuid,name:e.name}),n=await t.getNativeId();let i=t.identity.name;const a=await t.getOptions();if(void 0!==a.includeInSnapshots&&!1===a.includeInSnapshots)return void console.log(`SnapSDK: Not registering ${e.uuid}:${e.name}, Window is explicitly excluded -includeInSnapshots == false`);const r=a.customData||{};r.snapClientId?i=r.snapClientId:await t.updateOptions({customData:{...r,snapClientId:i}}),console.log(`SnapSDK: Auto-registering window: snapClientId:${i}, handle ${n}, uuid:${e.uuid}, name:${e.name}`),await this.registerWindow(i,n,r.snapResizingBehavior)}emit_event(e,...t){this.emitter.emit(e,...t)}handleSnapEvents(e,t){switch(this.emit_event("all-events",{type:e.action,payload:e.payload}),e.action){case"clientRegistered":this.emit_event("client-registered",{clientId:e.payload.clientId,windowHandle:`#${e.payload.windowHandle.toString(16).toUpperCase()}`,owningProcessId:e.payload.owningProcessId});break;case"clientUnRegistered":this.emit_event("client-unregistered",{...e.payload});break;case"moveSizeCompleted":this.emit_event("move-size-completed",{...e.payload});break;case"clientsAttached":this.emit_event("clients-attached",{...e.payload});break;case"clientDetached":this.emit_event("client-detached",{...e.payload});break;case"groupsChanged":this.emit_event("groups-changed",{...e.payload});break;case"clientActivated":this.emit_event("client-activated",{...e.payload});break;case"clientDeactivated":this.emit_event("client-deactivated",{...e.payload})}}async build_command_line(e){let t=`--id ${this.server_id} `;e?.showDebug&&(t+=" --show-debug "),e?.disableGPUAcceleratedDragging&&(t+=" --disable-gpu-accelerated-dragging true "),e?.disableBlurDropPreview&&(t+=" --blur-drop-preview false "),void 0!==e?.blurEffectPerformanceThreshold&&(t+=` --blur-effect-performance-threshold=${e?.blurEffectPerformanceThreshold} `),e?.disableUserUnstick&&(t+=" --disable-user-unstick "),!0!==e?.keyToStick&&"string"!=typeof e?.keyToStick||(t+=` --ks=${!0===e.keyToStick?"ctrl":e.keyToStick} `),e?.keyToUnstick&&(t+=` --kus=${e.keyToUnstick} `),e?.hideTaskbarEntry&&(t+=" --no-tb "),e?.taskbarIconGroup&&(t+=` --tb-id=${e?.taskbarIconGroup} `),e?.taskbarIcon&&(t+=` --tb-icon=${e?.taskbarIcon} `),e?.disableRuntimeHeartbeating&&(t+=" --no-hb "),e?.autoHideClientTaskbarIcons&&(t+=" --tb-auto-hide "),e?.theme&&(t+=` --thm=${e.theme} `),e?.defaultResizingBehavior&&(t+=` --res=${e?.defaultResizingBehavior} `);const n=await fin.System.getRuntimeInfo();return t+=`--runtime-port ${n.port} `,t+=`--runtime-version ${n.version} `,t.trim()}}const d=async e=>{let t=(await fin.System.getRuntimeInfo()).args["local-startup-url"].replace("config.json","");const n=t.includes("\\")?"\\":"/";return t.endsWith(n)&&(t=t.slice(0,-1)),[t,"assets",e.alias,e.version,e.target].join(n)},u=()=>"undefined"!=typeof crypto&&"randomUUID"in crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),h=e=>/^app:\/[^/]+\/[^/]+$/.test(e??""),f=e=>{const t=new Map;return e.forEach((e=>{const n=!e.name,i=e.name?.startsWith(p)??!1,a=e.customData?.snapClientId;(n||i||h(e.name))&&a&&t.set(a,e)})),t},y=(e,t,n)=>{Object.values(e).forEach((e=>{e.attachedClientId===t?e.attachedClientId=n:e.targetClientId===t&&(e.targetClientId=n)}))},v=e=>{if(!h(e))return`${p}${u()}`;const t=e.split("/");return t[t.length-1]=u(),t.join("/")};var w=i.q;

/***/ }),

/***/ "./client/src/preload/preload.common.ts":
/*!**********************************************!*\
  !*** ./client/src/preload/preload.common.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   initialize: () => (/* binding */ initialize)
/* harmony export */ });
/* harmony import */ var _openfin_snap_sdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @openfin/snap-sdk */ "../../node_modules/@openfin/snap-sdk/openfin.snap.mjs");
/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../settings */ "./client/src/settings.ts");


/**
 * Initialize the snap components.
 * @param options The options for initializing the snap provider.
 * @param createLayoutChannel Whether to create a simple channel api service that exposes the getLayout and applyLayout functionality of snap.
 */
async function initialize(options, createLayoutChannel = false) {
    const settings = await (0,_settings__WEBPACK_IMPORTED_MODULE_1__.getSettings)();
    const settingsServerOptions = settings?.serverOptions ?? {};
    const passedOptions = options?.serverOptions ?? {};
    const finalOptions = { ...settingsServerOptions, ...passedOptions };
    const finalPlatformId = options?.platformId ?? settings?.platformId;
    try {
        if (finalPlatformId) {
            console.log("Registering Snap with platformId", finalPlatformId);
            const server = new _openfin_snap_sdk__WEBPACK_IMPORTED_MODULE_0__.SnapServer(finalPlatformId);
            console.log("Enabling debug window:", finalOptions.showDebug ?? false);
            await server.start(finalOptions);
            if (createLayoutChannel) {
                try {
                    const channelName = `${fin.me.identity.uuid}-snap-layout`;
                    console.log(`Channel Service: Creating snap preload layout channel: ${channelName}`);
                    const channel = await fin.InterApplicationBus.Channel.create(channelName);
                    channel.register("getLayout", async () => {
                        console.log("Channel Service: Getting layout from Snap");
                        const layout = await server.getLayout();
                        console.log("Channel Service: Got layout from Snap", layout);
                        return layout;
                    });
                    channel.register("applyLayout", async (payload) => {
                        console.log("Channel Service: Applying layout to Snap", payload);
                        console.log("Channel Service: Preparing to apply snapshot");
                        await server.prepareToApplySnapshot();
                        console.log("Channel Service: Applying snapshot");
                        await server.applySnapshot(payload);
                        console.log("Channel Service: Applied snapshot");
                    });
                    channel.onConnection(async (identity) => {
                        console.log("Channel Service: Connection request from:", identity);
                        // eslint-disable-next-line prefer-template
                        if (identity.uuid !== fin.me.identity.uuid) {
                            const message = `Channel Service: Rejecting connection request as it is not coming from within the application. Identity should be: ${fin.me.identity.uuid} and connection request is coming from: ${identity.uuid}`;
                            console.error(message);
                            throw new Error(message);
                        }
                    });
                    channel.onDisconnection(async (identity) => {
                        console.log("Channel Service: Disconnection request from:", identity);
                    });
                    setTimeout(async () => {
                        try {
                            console.log("Channel Client: Connecting to snap preload layout channel to validate connection.");
                            const clientChannelName = `${fin.me.identity.uuid}-snap-layout`;
                            const snapPreloadClient = await fin.InterApplicationBus.Channel.connect(clientChannelName);
                            // fetch the current snap layout
                            console.log("Channel Client: Requesting layout from Snap");
                            const layout = (await snapPreloadClient.dispatch("getLayout"));
                            console.log("Channel Client: Got layout from Snap", layout);
                            // apply the layout
                            console.log("Channel Client: Applying layout to Snap");
                            await snapPreloadClient.dispatch("applyLayout", layout);
                            console.log("Channel Client: Applied layout to Snap");
                            console.log("Channel Client: Intentionally disconnecting from snap preload Channel Service");
                            await snapPreloadClient.disconnect();
                        }
                        catch (clientError) {
                            console.error("Channel Client: Error connecting to snap preload layout Channel Service", clientError);
                        }
                    }, 1000);
                }
                catch (err) {
                    console.error("Channel Service: Error creating snap layout channel", err);
                }
            }
            const app = fin.Application.getCurrentSync();
            await app.on("window-created", async (e) => {
                const win = fin.Window.wrapSync(e);
                const winOptions = await win.getOptions();
                if (!winOptions.includeInSnapshots) {
                    console.log("Window is not registered with Snap because includeInSnapshots is disabled.");
                }
                else {
                    const nativeId = await win.getNativeId();
                    console.log("Registering window with NativeID with Snap", nativeId);
                    await server.registerWindow(win.identity.name, nativeId);
                }
            });
            const hostOptions = (await fin.me.getOptions());
            if (hostOptions.autoShow) {
                console.log("Registering current window with snap");
                await server.registerWindow(fin.me.identity.name, await fin.Window.getCurrentSync().getNativeId());
            }
            else {
                console.log("Current window is not registered with Snap because autoShow is disabled.");
            }
        }
    }
    catch (err) {
        console.error("Error initializing Snap", err);
    }
}


/***/ }),

/***/ "./client/src/settings.ts":
/*!********************************!*\
  !*** ./client/src/settings.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getSettings: () => (/* binding */ getSettings)
/* harmony export */ });
/**
 * Gets settings from the manifest.
 * @param showDebugWindow Whether to enable the debug window regardless of manifest settings.
 * @returns The snap provider options from the manifest.
 */
async function getSettings(showDebugWindow) {
    const app = await fin.Application.getCurrent();
    const manifest = await app.getManifest();
    if (manifest.appAssets?.[0]?.src === "SNAP_ASSET_URL") {
        console.error("Please request the SNAP_ASSET_URL from OpenFin and update manifest.fin.json before running the sample");
    }
    const settings = await getManifestCustomSettings(manifest);
    settings.snapProvider ??= {};
    if (settings.snapProvider.serverOptions === undefined) {
        settings.snapProvider.serverOptions = {
            showDebug: showDebugWindow
        };
    }
    return settings.snapProvider;
}
/**
 * Read the custom settings from the manifest.fin.json.
 * @param manifest The manifest to load the custom settings from.
 * @returns The custom settings from the manifest.
 */
async function getManifestCustomSettings(manifest) {
    return manifest.customSettings ?? {};
}


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it needs to be isolated against other modules in the chunk.
(() => {
/*!***************************************!*\
  !*** ./client/src/preload/preload.ts ***!
  \***************************************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _preload_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./preload.common */ "./client/src/preload/preload.common.ts");

if (window === window.top) {
    console.log("Adding snap support through a preload.");
    window.addEventListener("DOMContentLoaded", async () => {
        await (0,_preload_common__WEBPACK_IMPORTED_MODULE_0__.initialize)({ platformId: fin.me.identity.uuid });
    });
}

})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBOztVQUVBO1VBQ0E7O1VBRUE7VUFDQTtVQUNBOzs7OztXQ3RCQTtXQUNBO1dBQ0E7V0FDQTtXQUNBLHlDQUF5Qyx3Q0FBd0M7V0FDakY7V0FDQTtXQUNBLEU7Ozs7O1dDUEEsd0Y7Ozs7O1dDQUE7V0FDQTtXQUNBO1dBQ0EsdURBQXVELGlCQUFpQjtXQUN4RTtXQUNBLGdEQUFnRCxhQUFhO1dBQzdELEU7Ozs7Ozs7Ozs7OztBQ044QztBQUU5QyxJQUFJLE1BQU0sS0FBSyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO0lBRXRELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLElBQUksRUFBRTtRQUN0RCxNQUFNLDJEQUFVLENBQUMsRUFBRSxVQUFVLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUN4RCxDQUFDLENBQUMsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC8uLi8uLi9ub2RlX21vZHVsZXMvQG9wZW5maW4vc25hcC1zZGsvb3BlbmZpbi5zbmFwLm1qcyIsIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC8uL2NsaWVudC9zcmMvcHJlbG9hZC9wcmVsb2FkLmNvbW1vbi50cyIsIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC8uL2NsaWVudC9zcmMvc2V0dGluZ3MudHMiLCJ3ZWJwYWNrOi8vb3BlbmZpbi13b3Jrc3BhY2UtLWludGVncmF0ZS13aXRoLXNuYXAvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vb3BlbmZpbi13b3Jrc3BhY2UtLWludGVncmF0ZS13aXRoLXNuYXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL29wZW5maW4td29ya3NwYWNlLS1pbnRlZ3JhdGUtd2l0aC1zbmFwL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vb3BlbmZpbi13b3Jrc3BhY2UtLWludGVncmF0ZS13aXRoLXNuYXAvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC8uL2NsaWVudC9zcmMvcHJlbG9hZC9wcmVsb2FkLnRzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBlPXs4Mjc6ZT0+e3ZhciB0LG49XCJvYmplY3RcIj09dHlwZW9mIFJlZmxlY3Q/UmVmbGVjdDpudWxsLGk9biYmXCJmdW5jdGlvblwiPT10eXBlb2Ygbi5hcHBseT9uLmFwcGx5OmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5LmNhbGwoZSx0LG4pfTt0PW4mJlwiZnVuY3Rpb25cIj09dHlwZW9mIG4ub3duS2V5cz9uLm93bktleXM6T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scz9mdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZSkuY29uY2F0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSkpfTpmdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZSl9O3ZhciBhPU51bWJlci5pc05hTnx8ZnVuY3Rpb24oZSl7cmV0dXJuIGUhPWV9O2Z1bmN0aW9uIHIoKXtyLmluaXQuY2FsbCh0aGlzKX1lLmV4cG9ydHM9cixlLmV4cG9ydHMub25jZT1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24obixpKXtmdW5jdGlvbiBhKG4pe2UucmVtb3ZlTGlzdGVuZXIodCxyKSxpKG4pfWZ1bmN0aW9uIHIoKXtcImZ1bmN0aW9uXCI9PXR5cGVvZiBlLnJlbW92ZUxpc3RlbmVyJiZlLnJlbW92ZUxpc3RlbmVyKFwiZXJyb3JcIixhKSxuKFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKSl9eShlLHQscix7b25jZTohMH0pLFwiZXJyb3JcIiE9PXQmJmZ1bmN0aW9uKGUsdCxuKXtcImZ1bmN0aW9uXCI9PXR5cGVvZiBlLm9uJiZ5KGUsXCJlcnJvclwiLHQsbil9KGUsYSx7b25jZTohMH0pfSkpfSxyLkV2ZW50RW1pdHRlcj1yLHIucHJvdG90eXBlLl9ldmVudHM9dm9pZCAwLHIucHJvdG90eXBlLl9ldmVudHNDb3VudD0wLHIucHJvdG90eXBlLl9tYXhMaXN0ZW5lcnM9dm9pZCAwO3ZhciBvPTEwO2Z1bmN0aW9uIHMoZSl7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgXCJsaXN0ZW5lclwiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBGdW5jdGlvbi4gUmVjZWl2ZWQgdHlwZSAnK3R5cGVvZiBlKX1mdW5jdGlvbiBjKGUpe3JldHVybiB2b2lkIDA9PT1lLl9tYXhMaXN0ZW5lcnM/ci5kZWZhdWx0TWF4TGlzdGVuZXJzOmUuX21heExpc3RlbmVyc31mdW5jdGlvbiBwKGUsdCxuLGkpe3ZhciBhLHIsbyxwO2lmKHMobiksdm9pZCAwPT09KHI9ZS5fZXZlbnRzKT8ocj1lLl9ldmVudHM9T2JqZWN0LmNyZWF0ZShudWxsKSxlLl9ldmVudHNDb3VudD0wKToodm9pZCAwIT09ci5uZXdMaXN0ZW5lciYmKGUuZW1pdChcIm5ld0xpc3RlbmVyXCIsdCxuLmxpc3RlbmVyP24ubGlzdGVuZXI6bikscj1lLl9ldmVudHMpLG89clt0XSksdm9pZCAwPT09bylvPXJbdF09biwrK2UuX2V2ZW50c0NvdW50O2Vsc2UgaWYoXCJmdW5jdGlvblwiPT10eXBlb2Ygbz9vPXJbdF09aT9bbixvXTpbbyxuXTppP28udW5zaGlmdChuKTpvLnB1c2gobiksKGE9YyhlKSk+MCYmby5sZW5ndGg+YSYmIW8ud2FybmVkKXtvLndhcm5lZD0hMDt2YXIgbD1uZXcgRXJyb3IoXCJQb3NzaWJsZSBFdmVudEVtaXR0ZXIgbWVtb3J5IGxlYWsgZGV0ZWN0ZWQuIFwiK28ubGVuZ3RoK1wiIFwiK1N0cmluZyh0KStcIiBsaXN0ZW5lcnMgYWRkZWQuIFVzZSBlbWl0dGVyLnNldE1heExpc3RlbmVycygpIHRvIGluY3JlYXNlIGxpbWl0XCIpO2wubmFtZT1cIk1heExpc3RlbmVyc0V4Y2VlZGVkV2FybmluZ1wiLGwuZW1pdHRlcj1lLGwudHlwZT10LGwuY291bnQ9by5sZW5ndGgscD1sLGNvbnNvbGUmJmNvbnNvbGUud2FybiYmY29uc29sZS53YXJuKHApfXJldHVybiBlfWZ1bmN0aW9uIGwoKXtpZighdGhpcy5maXJlZClyZXR1cm4gdGhpcy50YXJnZXQucmVtb3ZlTGlzdGVuZXIodGhpcy50eXBlLHRoaXMud3JhcEZuKSx0aGlzLmZpcmVkPSEwLDA9PT1hcmd1bWVudHMubGVuZ3RoP3RoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCk6dGhpcy5saXN0ZW5lci5hcHBseSh0aGlzLnRhcmdldCxhcmd1bWVudHMpfWZ1bmN0aW9uIGQoZSx0LG4pe3ZhciBpPXtmaXJlZDohMSx3cmFwRm46dm9pZCAwLHRhcmdldDplLHR5cGU6dCxsaXN0ZW5lcjpufSxhPWwuYmluZChpKTtyZXR1cm4gYS5saXN0ZW5lcj1uLGkud3JhcEZuPWEsYX1mdW5jdGlvbiB1KGUsdCxuKXt2YXIgaT1lLl9ldmVudHM7aWYodm9pZCAwPT09aSlyZXR1cm5bXTt2YXIgYT1pW3RdO3JldHVybiB2b2lkIDA9PT1hP1tdOlwiZnVuY3Rpb25cIj09dHlwZW9mIGE/bj9bYS5saXN0ZW5lcnx8YV06W2FdOm4/ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PW5ldyBBcnJheShlLmxlbmd0aCksbj0wO248dC5sZW5ndGg7KytuKXRbbl09ZVtuXS5saXN0ZW5lcnx8ZVtuXTtyZXR1cm4gdH0oYSk6ZihhLGEubGVuZ3RoKX1mdW5jdGlvbiBoKGUpe3ZhciB0PXRoaXMuX2V2ZW50cztpZih2b2lkIDAhPT10KXt2YXIgbj10W2VdO2lmKFwiZnVuY3Rpb25cIj09dHlwZW9mIG4pcmV0dXJuIDE7aWYodm9pZCAwIT09bilyZXR1cm4gbi5sZW5ndGh9cmV0dXJuIDB9ZnVuY3Rpb24gZihlLHQpe2Zvcih2YXIgbj1uZXcgQXJyYXkodCksaT0wO2k8dDsrK2kpbltpXT1lW2ldO3JldHVybiBufWZ1bmN0aW9uIHkoZSx0LG4saSl7aWYoXCJmdW5jdGlvblwiPT10eXBlb2YgZS5vbilpLm9uY2U/ZS5vbmNlKHQsbik6ZS5vbih0LG4pO2Vsc2V7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgZS5hZGRFdmVudExpc3RlbmVyKXRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSBcImVtaXR0ZXJcIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgRXZlbnRFbWl0dGVyLiBSZWNlaXZlZCB0eXBlICcrdHlwZW9mIGUpO2UuYWRkRXZlbnRMaXN0ZW5lcih0LChmdW5jdGlvbiBhKHIpe2kub25jZSYmZS5yZW1vdmVFdmVudExpc3RlbmVyKHQsYSksbihyKX0pKX19T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsXCJkZWZhdWx0TWF4TGlzdGVuZXJzXCIse2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99LHNldDpmdW5jdGlvbihlKXtpZihcIm51bWJlclwiIT10eXBlb2YgZXx8ZTwwfHxhKGUpKXRocm93IG5ldyBSYW5nZUVycm9yKCdUaGUgdmFsdWUgb2YgXCJkZWZhdWx0TWF4TGlzdGVuZXJzXCIgaXMgb3V0IG9mIHJhbmdlLiBJdCBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIG51bWJlci4gUmVjZWl2ZWQgJytlK1wiLlwiKTtvPWV9fSksci5pbml0PWZ1bmN0aW9uKCl7dm9pZCAwIT09dGhpcy5fZXZlbnRzJiZ0aGlzLl9ldmVudHMhPT1PYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykuX2V2ZW50c3x8KHRoaXMuX2V2ZW50cz1PYmplY3QuY3JlYXRlKG51bGwpLHRoaXMuX2V2ZW50c0NvdW50PTApLHRoaXMuX21heExpc3RlbmVycz10aGlzLl9tYXhMaXN0ZW5lcnN8fHZvaWQgMH0sci5wcm90b3R5cGUuc2V0TWF4TGlzdGVuZXJzPWZ1bmN0aW9uKGUpe2lmKFwibnVtYmVyXCIhPXR5cGVvZiBlfHxlPDB8fGEoZSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSBvZiBcIm5cIiBpcyBvdXQgb2YgcmFuZ2UuIEl0IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyLiBSZWNlaXZlZCAnK2UrXCIuXCIpO3JldHVybiB0aGlzLl9tYXhMaXN0ZW5lcnM9ZSx0aGlzfSxyLnByb3RvdHlwZS5nZXRNYXhMaXN0ZW5lcnM9ZnVuY3Rpb24oKXtyZXR1cm4gYyh0aGlzKX0sci5wcm90b3R5cGUuZW1pdD1mdW5jdGlvbihlKXtmb3IodmFyIHQ9W10sbj0xO248YXJndW1lbnRzLmxlbmd0aDtuKyspdC5wdXNoKGFyZ3VtZW50c1tuXSk7dmFyIGE9XCJlcnJvclwiPT09ZSxyPXRoaXMuX2V2ZW50cztpZih2b2lkIDAhPT1yKWE9YSYmdm9pZCAwPT09ci5lcnJvcjtlbHNlIGlmKCFhKXJldHVybiExO2lmKGEpe3ZhciBvO2lmKHQubGVuZ3RoPjAmJihvPXRbMF0pLG8gaW5zdGFuY2VvZiBFcnJvcil0aHJvdyBvO3ZhciBzPW5ldyBFcnJvcihcIlVuaGFuZGxlZCBlcnJvci5cIisobz9cIiAoXCIrby5tZXNzYWdlK1wiKVwiOlwiXCIpKTt0aHJvdyBzLmNvbnRleHQ9byxzfXZhciBjPXJbZV07aWYodm9pZCAwPT09YylyZXR1cm4hMTtpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBjKWkoYyx0aGlzLHQpO2Vsc2V7dmFyIHA9Yy5sZW5ndGgsbD1mKGMscCk7Zm9yKG49MDtuPHA7KytuKWkobFtuXSx0aGlzLHQpfXJldHVybiEwfSxyLnByb3RvdHlwZS5hZGRMaXN0ZW5lcj1mdW5jdGlvbihlLHQpe3JldHVybiBwKHRoaXMsZSx0LCExKX0sci5wcm90b3R5cGUub249ci5wcm90b3R5cGUuYWRkTGlzdGVuZXIsci5wcm90b3R5cGUucHJlcGVuZExpc3RlbmVyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHAodGhpcyxlLHQsITApfSxyLnByb3RvdHlwZS5vbmNlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHModCksdGhpcy5vbihlLGQodGhpcyxlLHQpKSx0aGlzfSxyLnByb3RvdHlwZS5wcmVwZW5kT25jZUxpc3RlbmVyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHModCksdGhpcy5wcmVwZW5kTGlzdGVuZXIoZSxkKHRoaXMsZSx0KSksdGhpc30sci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI9ZnVuY3Rpb24oZSx0KXt2YXIgbixpLGEscixvO2lmKHModCksdm9pZCAwPT09KGk9dGhpcy5fZXZlbnRzKSlyZXR1cm4gdGhpcztpZih2b2lkIDA9PT0obj1pW2VdKSlyZXR1cm4gdGhpcztpZihuPT09dHx8bi5saXN0ZW5lcj09PXQpMD09LS10aGlzLl9ldmVudHNDb3VudD90aGlzLl9ldmVudHM9T2JqZWN0LmNyZWF0ZShudWxsKTooZGVsZXRlIGlbZV0saS5yZW1vdmVMaXN0ZW5lciYmdGhpcy5lbWl0KFwicmVtb3ZlTGlzdGVuZXJcIixlLG4ubGlzdGVuZXJ8fHQpKTtlbHNlIGlmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIG4pe2ZvcihhPS0xLHI9bi5sZW5ndGgtMTtyPj0wO3ItLSlpZihuW3JdPT09dHx8bltyXS5saXN0ZW5lcj09PXQpe289bltyXS5saXN0ZW5lcixhPXI7YnJlYWt9aWYoYTwwKXJldHVybiB0aGlzOzA9PT1hP24uc2hpZnQoKTpmdW5jdGlvbihlLHQpe2Zvcig7dCsxPGUubGVuZ3RoO3QrKyllW3RdPWVbdCsxXTtlLnBvcCgpfShuLGEpLDE9PT1uLmxlbmd0aCYmKGlbZV09blswXSksdm9pZCAwIT09aS5yZW1vdmVMaXN0ZW5lciYmdGhpcy5lbWl0KFwicmVtb3ZlTGlzdGVuZXJcIixlLG98fHQpfXJldHVybiB0aGlzfSxyLnByb3RvdHlwZS5vZmY9ci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIsci5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzPWZ1bmN0aW9uKGUpe3ZhciB0LG4saTtpZih2b2lkIDA9PT0obj10aGlzLl9ldmVudHMpKXJldHVybiB0aGlzO2lmKHZvaWQgMD09PW4ucmVtb3ZlTGlzdGVuZXIpcmV0dXJuIDA9PT1hcmd1bWVudHMubGVuZ3RoPyh0aGlzLl9ldmVudHM9T2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLl9ldmVudHNDb3VudD0wKTp2b2lkIDAhPT1uW2VdJiYoMD09LS10aGlzLl9ldmVudHNDb3VudD90aGlzLl9ldmVudHM9T2JqZWN0LmNyZWF0ZShudWxsKTpkZWxldGUgbltlXSksdGhpcztpZigwPT09YXJndW1lbnRzLmxlbmd0aCl7dmFyIGEscj1PYmplY3Qua2V5cyhuKTtmb3IoaT0wO2k8ci5sZW5ndGg7KytpKVwicmVtb3ZlTGlzdGVuZXJcIiE9PShhPXJbaV0pJiZ0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhhKTtyZXR1cm4gdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoXCJyZW1vdmVMaXN0ZW5lclwiKSx0aGlzLl9ldmVudHM9T2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLl9ldmVudHNDb3VudD0wLHRoaXN9aWYoXCJmdW5jdGlvblwiPT10eXBlb2YodD1uW2VdKSl0aGlzLnJlbW92ZUxpc3RlbmVyKGUsdCk7ZWxzZSBpZih2b2lkIDAhPT10KWZvcihpPXQubGVuZ3RoLTE7aT49MDtpLS0pdGhpcy5yZW1vdmVMaXN0ZW5lcihlLHRbaV0pO3JldHVybiB0aGlzfSxyLnByb3RvdHlwZS5saXN0ZW5lcnM9ZnVuY3Rpb24oZSl7cmV0dXJuIHUodGhpcyxlLCEwKX0sci5wcm90b3R5cGUucmF3TGlzdGVuZXJzPWZ1bmN0aW9uKGUpe3JldHVybiB1KHRoaXMsZSwhMSl9LHIubGlzdGVuZXJDb3VudD1mdW5jdGlvbihlLHQpe3JldHVyblwiZnVuY3Rpb25cIj09dHlwZW9mIGUubGlzdGVuZXJDb3VudD9lLmxpc3RlbmVyQ291bnQodCk6aC5jYWxsKGUsdCl9LHIucHJvdG90eXBlLmxpc3RlbmVyQ291bnQ9aCxyLnByb3RvdHlwZS5ldmVudE5hbWVzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2V2ZW50c0NvdW50PjA/dCh0aGlzLl9ldmVudHMpOltdfX19LHQ9e307ZnVuY3Rpb24gbihpKXt2YXIgYT10W2ldO2lmKHZvaWQgMCE9PWEpcmV0dXJuIGEuZXhwb3J0czt2YXIgcj10W2ldPXtleHBvcnRzOnt9fTtyZXR1cm4gZVtpXShyLHIuZXhwb3J0cyxuKSxyLmV4cG9ydHN9bi5kPShlLHQpPT57Zm9yKHZhciBpIGluIHQpbi5vKHQsaSkmJiFuLm8oZSxpKSYmT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsaSx7ZW51bWVyYWJsZTohMCxnZXQ6dFtpXX0pfSxuLm89KGUsdCk9Pk9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLHQpO3ZhciBpPXt9O24uZChpLHtxOigpPT5sfSk7dmFyIGE9big4MjcpO2NvbnN0IHI9XCJvcGVuZmluLXNuYXBcIixvPVwiMS4zLjJcIixzPShlLHQpPT5gJHtlfSAke3QgaW5zdGFuY2VvZiBFcnJvcj90Lm1lc3NhZ2U6XCJzdHJpbmdcIj09dHlwZW9mIHQ/dDpKU09OLnN0cmluZ2lmeSh0KX1gLGM9YXN5bmMoKT0+e3RyeXtyZXR1cm4oYXdhaXQgZmluLlN5c3RlbS5nZXRBcHBBc3NldEluZm8oe2FsaWFzOnJ9KSkudmVyc2lvbj09PW99Y2F0Y2goZSl7cmV0dXJuITF9fSxwPVwiaW50ZXJuYWwtZ2VuZXJhdGVkLXdpbmRvdy1cIjtjbGFzcyBse2NvbnN0cnVjdG9yKGUpe2lmKHRoaXMuc2VydmVyX2lkPWUsdGhpcy5lbWl0dGVyPW5ldyBhLkV2ZW50RW1pdHRlcix0aGlzLl9fZXh0ZW5zaW9ucz1bXSwhZmluKXRocm93IG5ldyBFcnJvcihcIk9wZW5GaW4gaXMgbm90IGF2YWlsYWJsZVwiKX1hc3luYyBzdGFydChlKXt0cnl7Y29uc3QgZT1hd2FpdCBmaW4uU3lzdGVtLmdldFJ1bnRpbWVJbmZvKCk7XCJ4NjRcIiE9PWU/LmFyY2hpdGVjdHVyZSYmY29uc29sZS53YXJuKGBUaGUgYXJjaGl0ZWN0dXJlIG9mIHRoZSBjb25uZWN0ZWQgT3BlbkZpbiBydW50aW1lIGlzICcke2UuYXJjaGl0ZWN0dXJlfScgLSBXaW5kb3cgc25hcHBpbmcgaXMgY3VycmVudGx5IG9ubHkgc3VwcG9ydGVkIHdpdGggNjQtYml0IGFwcGxpY2F0aW9ucy4gU25hcHBpbmcgd2lsbCBiZSBkaXNhYmxlZC5gKX1jYXRjaChlKXtjb25zb2xlLndhcm4oYENvdWxkIG5vdCBnZXQgcnVudGltZSBpbmZvOiAke2V9YCl9Y29uc3QgdD1hd2FpdCBmaW4uU3lzdGVtLnF1ZXJ5UGVybWlzc2lvbkZvckN1cnJlbnRDb250ZXh0KFwiU3lzdGVtLmxhdW5jaEV4dGVybmFsUHJvY2Vzc1wiKTtpZighdC5ncmFudGVkKXRocm93IG5ldyBFcnJvcihcIlRoZSAnU3lzdGVtLmxhdW5jaEV4dGVybmFsUHJvY2VzcycgcGVybWlzc2lvbiBpcyByZXF1aXJlZCB0byBsYXVuY2ggdGhlIFNuYXAgc2VydmVyXCIpO2lmKHQucmF3VmFsdWUpe2lmKGU/LmV4ZWN1dGFibGVQYXRoJiYhdC5yYXdWYWx1ZT8uZXhlY3V0YWJsZXM/LmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiVGhlICdTeXN0ZW0ubGF1bmNoRXh0ZXJuYWxQcm9jZXNzLmFzc2V0cycgcGVybWlzc2lvbiBpcyByZXF1aXJlZCB0byBsYXVuY2ggdGhlIFNuYXAgc2VydmVyIGZyb20gYW4gZXhlY3V0YWJsZSBwYXRoXCIpO2lmKCFlPy5leGVjdXRhYmxlUGF0aCYmIXQucmF3VmFsdWU/LmFzc2V0cz8uZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJUaGUgJ1N5c3RlbS5sYXVuY2hFeHRlcm5hbFByb2Nlc3MuYXNzZXRzJyBwZXJtaXNzaW9uIGlzIHJlcXVpcmVkIHRvIGxhdW5jaCB0aGUgU25hcCBzZXJ2ZXIgZnJvbSBhIFVSTFwiKX1lPy5leGVjdXRhYmxlUGF0aHx8YXdhaXQoYXN5bmMgZT0+e2NvbnN0IHQ9YXdhaXQgZmluLkFwcGxpY2F0aW9uLmdldEN1cnJlbnRTeW5jKCkuZ2V0TWFuaWZlc3QoKSxuPXQuYXBwQXNzZXRzPy5maW5kKChlPT5lLmFsaWFzPT09cikpO2lmKG4pcmV0dXJuIHZvaWQgY29uc29sZS53YXJuKFwiRGV0ZWN0ZWQgU25hcCBwYWNrYWdlIGluIGFwcCBtYW5pZmVzdCBhcHBBc3NldHNcIixuKTtpZihhd2FpdCBjKCkpcmV0dXJuIHZvaWQgY29uc29sZS5pbmZvKFwiVXNpbmcgZXhpc3RpbmcgU25hcCBwYWNrYWdlXCIpO2NvbnN0IGk9ZT8/YGh0dHBzOi8vY2RuLm9wZW5maW4uY28vcmVsZWFzZS9zbmFwLyR7b30vc25hcC56aXBgO2NvbnNvbGUuaW5mbyhgRG93bmxvYWRpbmcgU25hcCBhc3NldCBmcm9tOiAnJHtpfSdgKTtjb25zdCBhPXthbGlhczpyLHNyYzpgJHtpfWAsdGFyZ2V0OlwiT3BlbkZpblNuYXAuZXhlXCIsdmVyc2lvbjpvfTtjb25zb2xlLmluZm8oXCJEb3dubG9hZGluZyBTbmFwIHBhY2thZ2VcIixhKTt0cnl7YXdhaXQgZmluLlN5c3RlbS5kb3dubG9hZEFzc2V0KGEsKCgpPT57fSkpfWNhdGNoKGUpe3Rocm93IG5ldyBFcnJvcihzKFwiVW5hYmxlIHRvIGRvd25sb2FkIFNuYXAgcGFja2FnZS5cIixlKSl9fSkoZT8uY3VzdG9tU25hcEFzc2V0U291cmNlKTtjb25zdCBuPWF3YWl0IHRoaXMuYnVpbGRfY29tbWFuZF9saW5lKGUpO2xldCBpPXthbGlhczpyLGFyZ3VtZW50czpuLGxpZmV0aW1lOlwid2luZG93XCJ9O2U/LmV4ZWN1dGFibGVQYXRoJiYoaT17cGF0aDplLmV4ZWN1dGFibGVQYXRoLGFyZ3VtZW50czpuLGxpZmV0aW1lOlwid2luZG93XCJ9KTt0cnl7dGhpcy5zbmFwX2lkZW50aXR5PWF3YWl0IGZpbi5TeXN0ZW0ubGF1bmNoRXh0ZXJuYWxQcm9jZXNzKGkpfWNhdGNoKGUpe3Rocm93IG5ldyBFcnJvcihzKFwiRmFpbGVkIHRvIGxhdW5jaCB0aGUgU25hcCBzZXJ2ZXIuXCIsZSkpfXJldHVybiB0aGlzLmNvbm5lY3QoKX1hc3luYyBjb25uZWN0KCl7dGhpcy5jbGllbnQ9YXdhaXQgZmluLkludGVyQXBwbGljYXRpb25CdXMuQ2hhbm5lbC5jb25uZWN0KGBzbmFwLXNlcnZlci1jb3JlLSR7dGhpcy5zZXJ2ZXJfaWR9YCksdGhpcy5jbGllbnQucmVnaXN0ZXIoXCJzbmFwX2hhbmRzaGFrZVwiLChhc3luYyhlLHQpPT57dHJ5e2F3YWl0IGZpbi5TeXN0ZW0ucmVnaXN0ZXJVc2FnZSh7dHlwZTpcImFkYXB0ZXItZmVhdHVyZVwiLGRhdGE6e2FwaVZlcnNpb246ZS52ZXJzaW9uLGNvbXBvbmVudE5hbWU6XCJzbmFwLXNlcnZlclwifX0pfWNhdGNoe2NvbnNvbGUud2FybihcIlNuYXBTREs6IEZhaWxlZCB0byByZWdpc3RlciB1c2FnZSBmb3IgU25hcCBTZXJ2ZXJcIil9fSkpO3RyeXthd2FpdCBmaW4uU3lzdGVtLnJlZ2lzdGVyVXNhZ2Uoe3R5cGU6XCJhZGFwdGVyLWZlYXR1cmVcIixkYXRhOnthcGlWZXJzaW9uOlwiMS4zLjJcIixjb21wb25lbnROYW1lOlwic25hcC1jbGllbnRcIn19KX1jYXRjaHtjb25zb2xlLndhcm4oXCJTbmFwU0RLOiBGYWlsZWQgdG8gcmVnaXN0ZXIgdXNhZ2UgZm9yIFNuYXAgU2VydmVyXCIpfXRoaXMuY2xpZW50LnJlZ2lzdGVyKFwic25hcF91cGRhdGVzXCIsKChlLHQpPT50aGlzLmhhbmRsZVNuYXBFdmVudHMoZSx0KSkpLHRoaXMuX19leHRlbnNpb25zLmZvckVhY2goKGU9PmUub25Db25uZWN0ZWQodGhpcy5jbGllbnQpKSl9X19hZGRFeHRlbnNpb24oZSl7dGhpcy5fX2V4dGVuc2lvbnMucHVzaChlKX1hc3luYyBzdG9wKCl7aWYoIXRoaXMuY2xpZW50KXRocm93IG5ldyBFcnJvcihcIlNuYXAgc2VydmVyIGlzIG5vdCBydW5uaW5nXCIpO2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJzaHV0ZG93blwifSkpfWFzeW5jIGdldExheW91dCgpe2lmKCF0aGlzLmNsaWVudCl0aHJvdyBuZXcgRXJyb3IoXCJTbmFwIHNlcnZlciBpcyBub3QgcnVubmluZ1wiKTtjb25zdCBlPWF3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJzZXJpYWxpc2VMYXlvdXRcIn0pKTtyZXR1cm4gZT8ucGF5bG9hZC5sYXlvdXR9YXN5bmMgc2V0TGF5b3V0KGUsdD0hMCl7aWYoIXRoaXMuY2xpZW50KXRocm93IG5ldyBFcnJvcihcIlNuYXAgc2VydmVyIGlzIG5vdCBydW5uaW5nXCIpO2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJkZXNlcmlhbGlzZUxheW91dFwiLHBheWxvYWQ6e2xheW91dDplLHJlc2V0OnR9fSkpfWFzeW5jIGVudGVyRGVmZXJyZWRMYXlvdXQoKXtpZighdGhpcy5jbGllbnQpdGhyb3cgbmV3IEVycm9yKFwiU25hcCBzZXJ2ZXIgaXMgbm90IHJ1bm5pbmdcIik7YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImVudGVyQmF0Y2hNb2RlXCJ9KSl9YXN5bmMgZXhpdERlZmVycmVkTGF5b3V0KCl7aWYoIXRoaXMuY2xpZW50KXRocm93IG5ldyBFcnJvcihcIlNuYXAgc2VydmVyIGlzIG5vdCBydW5uaW5nXCIpO2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJleGl0QmF0Y2hNb2RlXCJ9KSl9YXN5bmMgcHJlcGFyZVRvQXBwbHlTbmFwc2hvdChlLHQpe2lmKCFlfHxlLm9wdGlvbnM/LmNsb3NlRXhpc3RpbmdXaW5kb3dzfHxlLm9wdGlvbnM/LmNsb3NlU25hcHNob3RXaW5kb3dzKXJldHVybiB0aGlzLm5lZWRUb1Jlc2V0TGF5b3V0PSEwLHZvaWQgYXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcInJlc2V0QWxsXCJ9KSk7dGhpcy5uZWVkVG9SZXNldExheW91dD0hMTtjb25zdCBuPWUuc25hcHNob3QsaT1KU09OLnN0cmluZ2lmeShuLG51bGwsMiksYT1uLnNuYXA7aWYoIWEpcmV0dXJuO2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJwcmVwYXJlVG9BcHBseUxheW91dFwifSkpO2NvbnN0IHI9dD8/dixvPShhd2FpdCB0aGlzLmdldExheW91dCgpKT8uY2xpZW50cy5tYXAoKGU9PmUuaWQpKT8/W10scz1mKG4ud2luZG93cyksYz1BcnJheS5mcm9tKHMua2V5cygpKS5maWx0ZXIoKGU9Pm8uaW5jbHVkZXMoZSkpKTthLmNsaWVudHMuZmlsdGVyKChlPT5jLmluY2x1ZGVzKGUuaWQpKSkuZm9yRWFjaCgoZT0+e2NvbnN0IHQ9ZS5pZCxuPXIodCk7ZS5pZD1uLHkoYS5jb25uZWN0aW9ucyx0LG4pO2NvbnN0IGk9cy5nZXQodCk7aS5jdXN0b21EYXRhLnNuYXBDbGllbnRJZD1uLGkubmFtZT1ufSkpO2NvbnN0IHA9SlNPTi5zdHJpbmdpZnkobixudWxsLDIpO2NvbnNvbGUuZGVidWcoYFNuYXAgU0RLIG1vZGlmaWVkIHNuYXBzaG90IGRhdGEgYmVmb3JlIGFwcGx5aW5nIGl0Llxcbk9yaWdpbmFsIHNuYXBzaG90OlxcbiR7aX1cXG5Nb2RpZmllZCBzbmFwc2hvdDpcXG4ke3B9YCl9YXN5bmMgZGVjb3JhdGVTbmFwc2hvdChlKXtyZXR1cm57Li4uZSxzbmFwOmF3YWl0IHRoaXMuZ2V0TGF5b3V0KCl9fWFzeW5jIGFwcGx5U25hcHNob3QoZSl7ZS5zbmFwJiZhd2FpdCB0aGlzLnNldExheW91dChlLnNuYXAsdGhpcy5uZWVkVG9SZXNldExheW91dCl9YXN5bmMgbGF1bmNoKGUpe2lmKCF0aGlzLmNsaWVudCl0aHJvdyBuZXcgRXJyb3IoXCJOb3QgY29ubmVjdGVkIHRvIGFuIFNuYXAgc2VydmVyXCIpO2UuYXBwQXNzZXRJbmZvJiYoZS5wYXRoPWF3YWl0IGQoe3RhcmdldDplLnBhdGgsLi4uZS5hcHBBc3NldEluZm99KSksY29uc29sZS5sb2coXCJvcHRpb25zOiBcIixlKTtjb25zdCB0PXthY3Rpb246XCJzdGFydFByb2Nlc3NcIixwYXlsb2FkOnsuLi5lLGFyZ3M6ZS5hcmdzfHxbXX19O2lmKGUuc3RyYXRlZ3kpe2NvbnN0e3R5cGU6biwuLi5pfT1lLnN0cmF0ZWd5O3QucGF5bG9hZC5zdHJhdGVneT17dHlwZTpuLHBhcmFtZXRlcnM6ey4uLml9fX1jb25zdCBuPWF3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHQpKTtpZihuPy5wYXlsb2FkPy5zdWNjZXNzKXJldHVybntwcm9jZXNzX2lkOm4ucGF5bG9hZC5wcm9jZXNzX2lkfTt0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBsYXVuY2ggcHJvY2VzczogJHtuPy5wYXlsb2FkPy5lcnJvcn1gKX1hc3luYyByZWdpc3RlcldpbmRvdyhlLHQsbil7YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImhvb2tBbmRSZWdpc3RlcldpbmRvd1wiLHBheWxvYWQ6e2NsaWVudElkOmUsd2luZG93SGFuZGxlOnQscmVzaXppbmdCZWhhdmlvcjpufX0pKX1hc3luYyBlbmFibGVBdXRvV2luZG93UmVnaXN0cmF0aW9uKCl7Y29uc3QgZT1lPT50aGlzLmhhbmRsZU5ld1dpbmRvdyhlKTtyZXR1cm4gYXdhaXQgZmluLlBsYXRmb3JtLmdldEN1cnJlbnRTeW5jKCkuYWRkTGlzdGVuZXIoXCJ3aW5kb3ctY3JlYXRlZFwiLGUpLGFzeW5jKCk9Pnthd2FpdCBmaW4uU3lzdGVtLnJlbW92ZUxpc3RlbmVyKFwid2luZG93LWNyZWF0ZWRcIixlKX19YXN5bmMgYXR0YWNoV2luZG93cyhlLHQsbixpKXthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiYXR0YWNoXCIscGF5bG9hZDp7dGFyZ2V0Q2xpZW50SWQ6ZSx0b0F0dGFjaENsaWVudElkOnQsdGFyZ2V0U2lkZTpuLG9mZnNldDppfX0pKX1hc3luYyBkZXRhY2hGcm9tR3JvdXAoZSl7YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImRldGFjaEZyb21Hcm91cFwiLHBheWxvYWQ6e2NsaWVudElkOmV9fSkpfWFzeW5jIGdldEF0dGFjaGVkKGUpe3JldHVybihhd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiZ2V0QXR0YWNoZWRJbnN0YW5jZXNcIixwYXlsb2FkOntjbGllbnRJZDplfX0pKSkucGF5bG9hZC5hdHRhY2hlZH1hc3luYyBoYXNBdHRhY2htZW50cyhlKXtyZXR1cm4oYXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImhhc0F0dGFjaG1lbnRzXCIscGF5bG9hZDp7Y2xpZW50SWQ6ZX19KSkpLnBheWxvYWQuaGFzQXR0YWNobWVudHN9YWRkRXZlbnRMaXN0ZW5lcihlLHQpe3RoaXMuZW1pdHRlci5vbihlLHQpfXJlbW92ZUV2ZW50TGlzdGVuZXIoZSx0KXt0aGlzLmVtaXR0ZXIub2ZmKGUsdCl9b25jZShlLHQpe3RoaXMuZW1pdHRlci5vbmNlKGUsdCl9YXN5bmMgZ2V0R3JvdXBJZEZvcldpbmRvdyhlKXtjb25zdCB0PVwibnVtYmVyXCI9PXR5cGVvZiBlP3tuYXRpdmVXaW5kb3dJZDplfTp7Y2xpZW50SWQ6ZX0sbj1hd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiZ2V0R3JvdXBJZEZvcldpbmRvd1wiLHBheWxvYWQ6dH0pKTtpZighbi5wYXlsb2FkLmdyb3VwSWQpdGhyb3cgbmV3IEVycm9yKFwiTm8gZ3JvdXAgZm91bmQgZm9yIHdpbmRvd1wiKTtyZXR1cm4gbi5wYXlsb2FkLmdyb3VwSWR9YXN5bmMgZ2V0V2luZG93UmVzaXphYmxlKGUpe2NvbnN0IHQ9XCJudW1iZXJcIj09dHlwZW9mIGU/e25hdGl2ZVdpbmRvd0lkOmV9OntjbGllbnRJZDplfSxuPWF3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJnZXRSZXNpemFibGVcIixwYXlsb2FkOnR9KSk7aWYobnVsbD09PW4ucGF5bG9hZC5yZXNpemFibGUpdGhyb3cgbmV3IEVycm9yKFwiTm8gd2luZG93IGZvdW5kIGZvciBnaXZlbiBJRFwiKTtyZXR1cm4gbi5wYXlsb2FkLnJlc2l6YWJsZX1hc3luYyBzZXRXaW5kb3dSZXNpemFibGUoZSx0KXtjb25zdCBuPVwibnVtYmVyXCI9PXR5cGVvZiBlP3tuYXRpdmVXaW5kb3dJZDplLHJlc2l6YWJsZTp0fTp7Y2xpZW50SWQ6ZSxyZXNpemFibGU6dH07YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcInNldFJlc2l6YWJsZVwiLHBheWxvYWQ6bn0pKX1hc3luYyBnZXRXaW5kb3dzSW5Hcm91cChlKXtjb25zdCB0PWF3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJnZXRXaW5kb3dzSW5Hcm91cFwiLHBheWxvYWQ6e2dyb3VwSWQ6ZX19KSk7cmV0dXJuIHQucGF5bG9hZC53aW5kb3dzP3QucGF5bG9hZC53aW5kb3dzLm1hcCgoZT0+KHtuYXRpdmVJZDplWzBdLGNsaWVudElkOmVbMV19KSkpOltdfWFzeW5jIGdldEFsbEdyb3VwSWRzKCl7cmV0dXJuKGF3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJnZXRBbGxHcm91cElkc1wifSkpKS5wYXlsb2FkLmdyb3VwSWRzfWFzeW5jIG1pbmltaXplR3JvdXAoZSl7YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcIm1pbmltaXplR3JvdXBcIixwYXlsb2FkOntncm91cElkOmV9fSkpfWFzeW5jIHJlc3RvcmVHcm91cChlKXthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwicmVzdG9yZUdyb3VwXCIscGF5bG9hZDp7Z3JvdXBJZDplfX0pKX1hc3luYyBoYW5kbGVOZXdXaW5kb3coZSl7Y29uc3QgdD1hd2FpdCBmaW4uV2luZG93LndyYXAoe3V1aWQ6ZS51dWlkLG5hbWU6ZS5uYW1lfSksbj1hd2FpdCB0LmdldE5hdGl2ZUlkKCk7bGV0IGk9dC5pZGVudGl0eS5uYW1lO2NvbnN0IGE9YXdhaXQgdC5nZXRPcHRpb25zKCk7aWYodm9pZCAwIT09YS5pbmNsdWRlSW5TbmFwc2hvdHMmJiExPT09YS5pbmNsdWRlSW5TbmFwc2hvdHMpcmV0dXJuIHZvaWQgY29uc29sZS5sb2coYFNuYXBTREs6IE5vdCByZWdpc3RlcmluZyAke2UudXVpZH06JHtlLm5hbWV9LCBXaW5kb3cgaXMgZXhwbGljaXRseSBleGNsdWRlZCAtaW5jbHVkZUluU25hcHNob3RzID09IGZhbHNlYCk7Y29uc3Qgcj1hLmN1c3RvbURhdGF8fHt9O3Iuc25hcENsaWVudElkP2k9ci5zbmFwQ2xpZW50SWQ6YXdhaXQgdC51cGRhdGVPcHRpb25zKHtjdXN0b21EYXRhOnsuLi5yLHNuYXBDbGllbnRJZDppfX0pLGNvbnNvbGUubG9nKGBTbmFwU0RLOiBBdXRvLXJlZ2lzdGVyaW5nIHdpbmRvdzogc25hcENsaWVudElkOiR7aX0sIGhhbmRsZSAke259LCB1dWlkOiR7ZS51dWlkfSwgbmFtZToke2UubmFtZX1gKSxhd2FpdCB0aGlzLnJlZ2lzdGVyV2luZG93KGksbixyLnNuYXBSZXNpemluZ0JlaGF2aW9yKX1lbWl0X2V2ZW50KGUsLi4udCl7dGhpcy5lbWl0dGVyLmVtaXQoZSwuLi50KX1oYW5kbGVTbmFwRXZlbnRzKGUsdCl7c3dpdGNoKHRoaXMuZW1pdF9ldmVudChcImFsbC1ldmVudHNcIix7dHlwZTplLmFjdGlvbixwYXlsb2FkOmUucGF5bG9hZH0pLGUuYWN0aW9uKXtjYXNlXCJjbGllbnRSZWdpc3RlcmVkXCI6dGhpcy5lbWl0X2V2ZW50KFwiY2xpZW50LXJlZ2lzdGVyZWRcIix7Y2xpZW50SWQ6ZS5wYXlsb2FkLmNsaWVudElkLHdpbmRvd0hhbmRsZTpgIyR7ZS5wYXlsb2FkLndpbmRvd0hhbmRsZS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX1gLG93bmluZ1Byb2Nlc3NJZDplLnBheWxvYWQub3duaW5nUHJvY2Vzc0lkfSk7YnJlYWs7Y2FzZVwiY2xpZW50VW5SZWdpc3RlcmVkXCI6dGhpcy5lbWl0X2V2ZW50KFwiY2xpZW50LXVucmVnaXN0ZXJlZFwiLHsuLi5lLnBheWxvYWR9KTticmVhaztjYXNlXCJtb3ZlU2l6ZUNvbXBsZXRlZFwiOnRoaXMuZW1pdF9ldmVudChcIm1vdmUtc2l6ZS1jb21wbGV0ZWRcIix7Li4uZS5wYXlsb2FkfSk7YnJlYWs7Y2FzZVwiY2xpZW50c0F0dGFjaGVkXCI6dGhpcy5lbWl0X2V2ZW50KFwiY2xpZW50cy1hdHRhY2hlZFwiLHsuLi5lLnBheWxvYWR9KTticmVhaztjYXNlXCJjbGllbnREZXRhY2hlZFwiOnRoaXMuZW1pdF9ldmVudChcImNsaWVudC1kZXRhY2hlZFwiLHsuLi5lLnBheWxvYWR9KTticmVhaztjYXNlXCJncm91cHNDaGFuZ2VkXCI6dGhpcy5lbWl0X2V2ZW50KFwiZ3JvdXBzLWNoYW5nZWRcIix7Li4uZS5wYXlsb2FkfSk7YnJlYWs7Y2FzZVwiY2xpZW50QWN0aXZhdGVkXCI6dGhpcy5lbWl0X2V2ZW50KFwiY2xpZW50LWFjdGl2YXRlZFwiLHsuLi5lLnBheWxvYWR9KTticmVhaztjYXNlXCJjbGllbnREZWFjdGl2YXRlZFwiOnRoaXMuZW1pdF9ldmVudChcImNsaWVudC1kZWFjdGl2YXRlZFwiLHsuLi5lLnBheWxvYWR9KX19YXN5bmMgYnVpbGRfY29tbWFuZF9saW5lKGUpe2xldCB0PWAtLWlkICR7dGhpcy5zZXJ2ZXJfaWR9IGA7ZT8uc2hvd0RlYnVnJiYodCs9XCIgLS1zaG93LWRlYnVnIFwiKSxlPy5kaXNhYmxlR1BVQWNjZWxlcmF0ZWREcmFnZ2luZyYmKHQrPVwiIC0tZGlzYWJsZS1ncHUtYWNjZWxlcmF0ZWQtZHJhZ2dpbmcgdHJ1ZSBcIiksZT8uZGlzYWJsZUJsdXJEcm9wUHJldmlldyYmKHQrPVwiIC0tYmx1ci1kcm9wLXByZXZpZXcgZmFsc2UgXCIpLHZvaWQgMCE9PWU/LmJsdXJFZmZlY3RQZXJmb3JtYW5jZVRocmVzaG9sZCYmKHQrPWAgLS1ibHVyLWVmZmVjdC1wZXJmb3JtYW5jZS10aHJlc2hvbGQ9JHtlPy5ibHVyRWZmZWN0UGVyZm9ybWFuY2VUaHJlc2hvbGR9IGApLGU/LmRpc2FibGVVc2VyVW5zdGljayYmKHQrPVwiIC0tZGlzYWJsZS11c2VyLXVuc3RpY2sgXCIpLCEwIT09ZT8ua2V5VG9TdGljayYmXCJzdHJpbmdcIiE9dHlwZW9mIGU/LmtleVRvU3RpY2t8fCh0Kz1gIC0ta3M9JHshMD09PWUua2V5VG9TdGljaz9cImN0cmxcIjplLmtleVRvU3RpY2t9IGApLGU/LmtleVRvVW5zdGljayYmKHQrPWAgLS1rdXM9JHtlLmtleVRvVW5zdGlja30gYCksZT8uaGlkZVRhc2tiYXJFbnRyeSYmKHQrPVwiIC0tbm8tdGIgXCIpLGU/LnRhc2tiYXJJY29uR3JvdXAmJih0Kz1gIC0tdGItaWQ9JHtlPy50YXNrYmFySWNvbkdyb3VwfSBgKSxlPy50YXNrYmFySWNvbiYmKHQrPWAgLS10Yi1pY29uPSR7ZT8udGFza2Jhckljb259IGApLGU/LmRpc2FibGVSdW50aW1lSGVhcnRiZWF0aW5nJiYodCs9XCIgLS1uby1oYiBcIiksZT8uYXV0b0hpZGVDbGllbnRUYXNrYmFySWNvbnMmJih0Kz1cIiAtLXRiLWF1dG8taGlkZSBcIiksZT8udGhlbWUmJih0Kz1gIC0tdGhtPSR7ZS50aGVtZX0gYCksZT8uZGVmYXVsdFJlc2l6aW5nQmVoYXZpb3ImJih0Kz1gIC0tcmVzPSR7ZT8uZGVmYXVsdFJlc2l6aW5nQmVoYXZpb3J9IGApO2NvbnN0IG49YXdhaXQgZmluLlN5c3RlbS5nZXRSdW50aW1lSW5mbygpO3JldHVybiB0Kz1gLS1ydW50aW1lLXBvcnQgJHtuLnBvcnR9IGAsdCs9YC0tcnVudGltZS12ZXJzaW9uICR7bi52ZXJzaW9ufSBgLHQudHJpbSgpfX1jb25zdCBkPWFzeW5jIGU9PntsZXQgdD0oYXdhaXQgZmluLlN5c3RlbS5nZXRSdW50aW1lSW5mbygpKS5hcmdzW1wibG9jYWwtc3RhcnR1cC11cmxcIl0ucmVwbGFjZShcImNvbmZpZy5qc29uXCIsXCJcIik7Y29uc3Qgbj10LmluY2x1ZGVzKFwiXFxcXFwiKT9cIlxcXFxcIjpcIi9cIjtyZXR1cm4gdC5lbmRzV2l0aChuKSYmKHQ9dC5zbGljZSgwLC0xKSksW3QsXCJhc3NldHNcIixlLmFsaWFzLGUudmVyc2lvbixlLnRhcmdldF0uam9pbihuKX0sdT0oKT0+XCJ1bmRlZmluZWRcIiE9dHlwZW9mIGNyeXB0byYmXCJyYW5kb21VVUlEXCJpbiBjcnlwdG8mJlwiZnVuY3Rpb25cIj09dHlwZW9mIGNyeXB0by5yYW5kb21VVUlEP2NyeXB0by5yYW5kb21VVUlEKCk6XCIxMDAwMDAwMC0xMDAwLTQwMDAtODAwMC0xMDAwMDAwMDAwMDBcIi5yZXBsYWNlKC9bMDE4XS9nLChlPT4oZV5jcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50OEFycmF5KDEpKVswXSYxNT4+ZS80KS50b1N0cmluZygxNikpKSxoPWU9Pi9eYXBwOlxcL1teL10rXFwvW14vXSskLy50ZXN0KGU/P1wiXCIpLGY9ZT0+e2NvbnN0IHQ9bmV3IE1hcDtyZXR1cm4gZS5mb3JFYWNoKChlPT57Y29uc3Qgbj0hZS5uYW1lLGk9ZS5uYW1lPy5zdGFydHNXaXRoKHApPz8hMSxhPWUuY3VzdG9tRGF0YT8uc25hcENsaWVudElkOyhufHxpfHxoKGUubmFtZSkpJiZhJiZ0LnNldChhLGUpfSkpLHR9LHk9KGUsdCxuKT0+e09iamVjdC52YWx1ZXMoZSkuZm9yRWFjaCgoZT0+e2UuYXR0YWNoZWRDbGllbnRJZD09PXQ/ZS5hdHRhY2hlZENsaWVudElkPW46ZS50YXJnZXRDbGllbnRJZD09PXQmJihlLnRhcmdldENsaWVudElkPW4pfSkpfSx2PWU9PntpZighaChlKSlyZXR1cm5gJHtwfSR7dSgpfWA7Y29uc3QgdD1lLnNwbGl0KFwiL1wiKTtyZXR1cm4gdFt0Lmxlbmd0aC0xXT11KCksdC5qb2luKFwiL1wiKX07dmFyIHc9aS5xO2V4cG9ydHt3IGFzIFNuYXBTZXJ2ZXJ9OyIsImltcG9ydCB0eXBlIE9wZW5GaW4gZnJvbSBcIkBvcGVuZmluL2NvcmVcIjtcbmltcG9ydCAqIGFzIFNuYXAgZnJvbSBcIkBvcGVuZmluL3NuYXAtc2RrXCI7XG5pbXBvcnQgeyBnZXRTZXR0aW5ncyB9IGZyb20gXCIuLi9zZXR0aW5nc1wiO1xuaW1wb3J0IHR5cGUgeyBTbmFwUHJvdmlkZXJPcHRpb25zIH0gZnJvbSBcIi4uL3NoYXBlc1wiO1xuXG4vKipcbiAqIEluaXRpYWxpemUgdGhlIHNuYXAgY29tcG9uZW50cy5cbiAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIGZvciBpbml0aWFsaXppbmcgdGhlIHNuYXAgcHJvdmlkZXIuXG4gKiBAcGFyYW0gY3JlYXRlTGF5b3V0Q2hhbm5lbCBXaGV0aGVyIHRvIGNyZWF0ZSBhIHNpbXBsZSBjaGFubmVsIGFwaSBzZXJ2aWNlIHRoYXQgZXhwb3NlcyB0aGUgZ2V0TGF5b3V0IGFuZCBhcHBseUxheW91dCBmdW5jdGlvbmFsaXR5IG9mIHNuYXAuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbml0aWFsaXplKFxuXHRvcHRpb25zOiBTbmFwUHJvdmlkZXJPcHRpb25zLFxuXHRjcmVhdGVMYXlvdXRDaGFubmVsOiBib29sZWFuID0gZmFsc2Vcbik6IFByb21pc2U8dm9pZD4ge1xuXHRjb25zdCBzZXR0aW5ncyA9IGF3YWl0IGdldFNldHRpbmdzKCk7XG5cdGNvbnN0IHNldHRpbmdzU2VydmVyT3B0aW9ucyA9IHNldHRpbmdzPy5zZXJ2ZXJPcHRpb25zID8/IHt9O1xuXHRjb25zdCBwYXNzZWRPcHRpb25zID0gb3B0aW9ucz8uc2VydmVyT3B0aW9ucyA/PyB7fTtcblx0Y29uc3QgZmluYWxPcHRpb25zID0geyAuLi5zZXR0aW5nc1NlcnZlck9wdGlvbnMsIC4uLnBhc3NlZE9wdGlvbnMgfTtcblx0Y29uc3QgZmluYWxQbGF0Zm9ybUlkID0gb3B0aW9ucz8ucGxhdGZvcm1JZCA/PyBzZXR0aW5ncz8ucGxhdGZvcm1JZDtcblx0dHJ5IHtcblx0XHRpZiAoZmluYWxQbGF0Zm9ybUlkKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhcIlJlZ2lzdGVyaW5nIFNuYXAgd2l0aCBwbGF0Zm9ybUlkXCIsIGZpbmFsUGxhdGZvcm1JZCk7XG5cdFx0XHRjb25zdCBzZXJ2ZXIgPSBuZXcgU25hcC5TbmFwU2VydmVyKGZpbmFsUGxhdGZvcm1JZCk7XG5cdFx0XHRjb25zb2xlLmxvZyhcIkVuYWJsaW5nIGRlYnVnIHdpbmRvdzpcIiwgZmluYWxPcHRpb25zLnNob3dEZWJ1ZyA/PyBmYWxzZSk7XG5cdFx0XHRhd2FpdCBzZXJ2ZXIuc3RhcnQoZmluYWxPcHRpb25zKTtcblx0XHRcdGlmIChjcmVhdGVMYXlvdXRDaGFubmVsKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0Y29uc3QgY2hhbm5lbE5hbWUgPSBgJHtmaW4ubWUuaWRlbnRpdHkudXVpZH0tc25hcC1sYXlvdXRgO1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGBDaGFubmVsIFNlcnZpY2U6IENyZWF0aW5nIHNuYXAgcHJlbG9hZCBsYXlvdXQgY2hhbm5lbDogJHtjaGFubmVsTmFtZX1gKTtcblx0XHRcdFx0XHRjb25zdCBjaGFubmVsID0gYXdhaXQgZmluLkludGVyQXBwbGljYXRpb25CdXMuQ2hhbm5lbC5jcmVhdGUoY2hhbm5lbE5hbWUpO1xuXHRcdFx0XHRcdGNoYW5uZWwucmVnaXN0ZXIoXCJnZXRMYXlvdXRcIiwgYXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIFNlcnZpY2U6IEdldHRpbmcgbGF5b3V0IGZyb20gU25hcFwiKTtcblx0XHRcdFx0XHRcdGNvbnN0IGxheW91dCA9IGF3YWl0IHNlcnZlci5nZXRMYXlvdXQoKTtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBTZXJ2aWNlOiBHb3QgbGF5b3V0IGZyb20gU25hcFwiLCBsYXlvdXQpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIGxheW91dDtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRjaGFubmVsLnJlZ2lzdGVyKFwiYXBwbHlMYXlvdXRcIiwgYXN5bmMgKHBheWxvYWQ6IHVua25vd24pID0+IHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBTZXJ2aWNlOiBBcHBseWluZyBsYXlvdXQgdG8gU25hcFwiLCBwYXlsb2FkKTtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBTZXJ2aWNlOiBQcmVwYXJpbmcgdG8gYXBwbHkgc25hcHNob3RcIik7XG5cdFx0XHRcdFx0XHRhd2FpdCBzZXJ2ZXIucHJlcGFyZVRvQXBwbHlTbmFwc2hvdCgpO1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIFNlcnZpY2U6IEFwcGx5aW5nIHNuYXBzaG90XCIpO1xuXHRcdFx0XHRcdFx0YXdhaXQgc2VydmVyLmFwcGx5U25hcHNob3QocGF5bG9hZCBhcyBTbmFwLlNuYXBTbmFwc2hvdCk7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgU2VydmljZTogQXBwbGllZCBzbmFwc2hvdFwiKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRjaGFubmVsLm9uQ29ubmVjdGlvbihhc3luYyAoaWRlbnRpdHkpID0+IHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBTZXJ2aWNlOiBDb25uZWN0aW9uIHJlcXVlc3QgZnJvbTpcIiwgaWRlbnRpdHkpO1xuXHRcdFx0XHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZWZlci10ZW1wbGF0ZVxuXHRcdFx0XHRcdFx0aWYgKGlkZW50aXR5LnV1aWQgIT09IGZpbi5tZS5pZGVudGl0eS51dWlkKSB7XG5cdFx0XHRcdFx0XHRcdGNvbnN0IG1lc3NhZ2UgPSBgQ2hhbm5lbCBTZXJ2aWNlOiBSZWplY3RpbmcgY29ubmVjdGlvbiByZXF1ZXN0IGFzIGl0IGlzIG5vdCBjb21pbmcgZnJvbSB3aXRoaW4gdGhlIGFwcGxpY2F0aW9uLiBJZGVudGl0eSBzaG91bGQgYmU6ICR7ZmluLm1lLmlkZW50aXR5LnV1aWR9IGFuZCBjb25uZWN0aW9uIHJlcXVlc3QgaXMgY29taW5nIGZyb206ICR7aWRlbnRpdHkudXVpZH1gO1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKG1lc3NhZ2UpO1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0Y2hhbm5lbC5vbkRpc2Nvbm5lY3Rpb24oYXN5bmMgKGlkZW50aXR5KSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgU2VydmljZTogRGlzY29ubmVjdGlvbiByZXF1ZXN0IGZyb206XCIsIGlkZW50aXR5KTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXG5cdFx0XHRcdFx0XHRcdFx0XCJDaGFubmVsIENsaWVudDogQ29ubmVjdGluZyB0byBzbmFwIHByZWxvYWQgbGF5b3V0IGNoYW5uZWwgdG8gdmFsaWRhdGUgY29ubmVjdGlvbi5cIlxuXHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0XHRjb25zdCBjbGllbnRDaGFubmVsTmFtZSA9IGAke2Zpbi5tZS5pZGVudGl0eS51dWlkfS1zbmFwLWxheW91dGA7XG5cdFx0XHRcdFx0XHRcdGNvbnN0IHNuYXBQcmVsb2FkQ2xpZW50ID0gYXdhaXQgZmluLkludGVyQXBwbGljYXRpb25CdXMuQ2hhbm5lbC5jb25uZWN0KGNsaWVudENoYW5uZWxOYW1lKTtcblxuXHRcdFx0XHRcdFx0XHQvLyBmZXRjaCB0aGUgY3VycmVudCBzbmFwIGxheW91dFxuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgQ2xpZW50OiBSZXF1ZXN0aW5nIGxheW91dCBmcm9tIFNuYXBcIik7XG5cdFx0XHRcdFx0XHRcdGNvbnN0IGxheW91dCA9IChhd2FpdCBzbmFwUHJlbG9hZENsaWVudC5kaXNwYXRjaChcImdldExheW91dFwiKSkgYXMgU25hcC5TbmFwTGF5b3V0O1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgQ2xpZW50OiBHb3QgbGF5b3V0IGZyb20gU25hcFwiLCBsYXlvdXQpO1xuXG5cdFx0XHRcdFx0XHRcdC8vIGFwcGx5IHRoZSBsYXlvdXRcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIENsaWVudDogQXBwbHlpbmcgbGF5b3V0IHRvIFNuYXBcIik7XG5cdFx0XHRcdFx0XHRcdGF3YWl0IHNuYXBQcmVsb2FkQ2xpZW50LmRpc3BhdGNoKFwiYXBwbHlMYXlvdXRcIiwgbGF5b3V0KTtcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIENsaWVudDogQXBwbGllZCBsYXlvdXQgdG8gU25hcFwiKTtcblxuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgQ2xpZW50OiBJbnRlbnRpb25hbGx5IGRpc2Nvbm5lY3RpbmcgZnJvbSBzbmFwIHByZWxvYWQgQ2hhbm5lbCBTZXJ2aWNlXCIpO1xuXHRcdFx0XHRcdFx0XHRhd2FpdCBzbmFwUHJlbG9hZENsaWVudC5kaXNjb25uZWN0KCk7XG5cdFx0XHRcdFx0XHR9IGNhdGNoIChjbGllbnRFcnJvcikge1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0XHRcdFx0XHRcdFwiQ2hhbm5lbCBDbGllbnQ6IEVycm9yIGNvbm5lY3RpbmcgdG8gc25hcCBwcmVsb2FkIGxheW91dCBDaGFubmVsIFNlcnZpY2VcIixcblx0XHRcdFx0XHRcdFx0XHRjbGllbnRFcnJvclxuXHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0sIDEwMDApO1xuXHRcdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiQ2hhbm5lbCBTZXJ2aWNlOiBFcnJvciBjcmVhdGluZyBzbmFwIGxheW91dCBjaGFubmVsXCIsIGVycik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGNvbnN0IGFwcCA9IGZpbi5BcHBsaWNhdGlvbi5nZXRDdXJyZW50U3luYygpO1xuXHRcdFx0YXdhaXQgYXBwLm9uKFwid2luZG93LWNyZWF0ZWRcIiwgYXN5bmMgKGUpID0+IHtcblx0XHRcdFx0Y29uc3Qgd2luID0gZmluLldpbmRvdy53cmFwU3luYyhlKTtcblx0XHRcdFx0Y29uc3Qgd2luT3B0aW9ucyA9IGF3YWl0IHdpbi5nZXRPcHRpb25zKCk7XG5cdFx0XHRcdGlmICghd2luT3B0aW9ucy5pbmNsdWRlSW5TbmFwc2hvdHMpIHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIldpbmRvdyBpcyBub3QgcmVnaXN0ZXJlZCB3aXRoIFNuYXAgYmVjYXVzZSBpbmNsdWRlSW5TbmFwc2hvdHMgaXMgZGlzYWJsZWQuXCIpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnN0IG5hdGl2ZUlkID0gYXdhaXQgd2luLmdldE5hdGl2ZUlkKCk7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJSZWdpc3RlcmluZyB3aW5kb3cgd2l0aCBOYXRpdmVJRCB3aXRoIFNuYXBcIiwgbmF0aXZlSWQpO1xuXHRcdFx0XHRcdGF3YWl0IHNlcnZlci5yZWdpc3RlcldpbmRvdyh3aW4uaWRlbnRpdHkubmFtZSwgbmF0aXZlSWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdGNvbnN0IGhvc3RPcHRpb25zID0gKGF3YWl0IGZpbi5tZS5nZXRPcHRpb25zKCkpIGFzIE9wZW5GaW4uV2luZG93T3B0aW9ucztcblx0XHRcdGlmIChob3N0T3B0aW9ucy5hdXRvU2hvdykge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhcIlJlZ2lzdGVyaW5nIGN1cnJlbnQgd2luZG93IHdpdGggc25hcFwiKTtcblx0XHRcdFx0YXdhaXQgc2VydmVyLnJlZ2lzdGVyV2luZG93KGZpbi5tZS5pZGVudGl0eS5uYW1lLCBhd2FpdCBmaW4uV2luZG93LmdldEN1cnJlbnRTeW5jKCkuZ2V0TmF0aXZlSWQoKSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhcIkN1cnJlbnQgd2luZG93IGlzIG5vdCByZWdpc3RlcmVkIHdpdGggU25hcCBiZWNhdXNlIGF1dG9TaG93IGlzIGRpc2FibGVkLlwiKTtcblx0XHRcdH1cblx0XHR9XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbml0aWFsaXppbmcgU25hcFwiLCBlcnIpO1xuXHR9XG59XG4iLCJpbXBvcnQgdHlwZSB7IE9wZW5GaW4gfSBmcm9tIFwiQG9wZW5maW4vY29yZVwiO1xuaW1wb3J0IHR5cGUgeyBDdXN0b21TZXR0aW5ncywgU25hcFByb3ZpZGVyT3B0aW9ucyB9IGZyb20gXCIuL3NoYXBlc1wiO1xuXG4vKipcbiAqIEdldHMgc2V0dGluZ3MgZnJvbSB0aGUgbWFuaWZlc3QuXG4gKiBAcGFyYW0gc2hvd0RlYnVnV2luZG93IFdoZXRoZXIgdG8gZW5hYmxlIHRoZSBkZWJ1ZyB3aW5kb3cgcmVnYXJkbGVzcyBvZiBtYW5pZmVzdCBzZXR0aW5ncy5cbiAqIEByZXR1cm5zIFRoZSBzbmFwIHByb3ZpZGVyIG9wdGlvbnMgZnJvbSB0aGUgbWFuaWZlc3QuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZXR0aW5ncyhzaG93RGVidWdXaW5kb3c/OiBib29sZWFuKTogUHJvbWlzZTxTbmFwUHJvdmlkZXJPcHRpb25zPiB7XG5cdGNvbnN0IGFwcCA9IGF3YWl0IGZpbi5BcHBsaWNhdGlvbi5nZXRDdXJyZW50KCk7XG5cdGNvbnN0IG1hbmlmZXN0ID0gYXdhaXQgYXBwLmdldE1hbmlmZXN0KCk7XG5cdGlmIChtYW5pZmVzdC5hcHBBc3NldHM/LlswXT8uc3JjID09PSBcIlNOQVBfQVNTRVRfVVJMXCIpIHtcblx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0XCJQbGVhc2UgcmVxdWVzdCB0aGUgU05BUF9BU1NFVF9VUkwgZnJvbSBPcGVuRmluIGFuZCB1cGRhdGUgbWFuaWZlc3QuZmluLmpzb24gYmVmb3JlIHJ1bm5pbmcgdGhlIHNhbXBsZVwiXG5cdFx0KTtcblx0fVxuXHRjb25zdCBzZXR0aW5ncyA9IGF3YWl0IGdldE1hbmlmZXN0Q3VzdG9tU2V0dGluZ3MobWFuaWZlc3QpO1xuXHRzZXR0aW5ncy5zbmFwUHJvdmlkZXIgPz89IHt9O1xuXHRpZiAoc2V0dGluZ3Muc25hcFByb3ZpZGVyLnNlcnZlck9wdGlvbnMgPT09IHVuZGVmaW5lZCkge1xuXHRcdHNldHRpbmdzLnNuYXBQcm92aWRlci5zZXJ2ZXJPcHRpb25zID0ge1xuXHRcdFx0c2hvd0RlYnVnOiBzaG93RGVidWdXaW5kb3dcblx0XHR9O1xuXHR9XG5cdHJldHVybiBzZXR0aW5ncy5zbmFwUHJvdmlkZXI7XG59XG5cbi8qKlxuICogUmVhZCB0aGUgY3VzdG9tIHNldHRpbmdzIGZyb20gdGhlIG1hbmlmZXN0LmZpbi5qc29uLlxuICogQHBhcmFtIG1hbmlmZXN0IFRoZSBtYW5pZmVzdCB0byBsb2FkIHRoZSBjdXN0b20gc2V0dGluZ3MgZnJvbS5cbiAqIEByZXR1cm5zIFRoZSBjdXN0b20gc2V0dGluZ3MgZnJvbSB0aGUgbWFuaWZlc3QuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldE1hbmlmZXN0Q3VzdG9tU2V0dGluZ3MobWFuaWZlc3Q6IE9wZW5GaW4uTWFuaWZlc3QpOiBQcm9taXNlPEN1c3RvbVNldHRpbmdzPiB7XG5cdHJldHVybiAobWFuaWZlc3QgYXMgT3BlbkZpbi5NYW5pZmVzdCAmIHsgY3VzdG9tU2V0dGluZ3M/OiBDdXN0b21TZXR0aW5ncyB9KS5jdXN0b21TZXR0aW5ncyA/PyB7fTtcbn1cbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgaW5pdGlhbGl6ZSB9IGZyb20gXCIuL3ByZWxvYWQuY29tbW9uXCI7XG5cbmlmICh3aW5kb3cgPT09IHdpbmRvdy50b3ApIHtcblx0Y29uc29sZS5sb2coXCJBZGRpbmcgc25hcCBzdXBwb3J0IHRocm91Z2ggYSBwcmVsb2FkLlwiKTtcblxuXHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgYXN5bmMgKCkgPT4ge1xuXHRcdGF3YWl0IGluaXRpYWxpemUoeyBwbGF0Zm9ybUlkOiBmaW4ubWUuaWRlbnRpdHkudXVpZCB9KTtcblx0fSk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=