var e,t={};function n(e){return null==e}function o(e){return function(e){return null!=e&&"string"==typeof e}(e)&&e.trim().length>0}function i(){return"randomUUID"in globalThis.crypto?globalThis.crypto.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(e){const t=globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>Number(e)/4;return(Number(e)^t).toString(16)})}t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),function(e){e.CustomButton="CustomButton",e.StoreCustomButton="StoreCustomButton",e.CustomDropdownItem="CustomDropdownItem",e.GlobalContextMenu="GlobalContextMenu",e.ViewTabContextMenu="ViewTabContextMenu",e.PageTabContextMenu="PageTabContextMenu",e.SaveButtonContextMenu="SaveButtonContextMenu",e.API="API"}(e||(e={}));const a="view",s="inline-view";function r(e,t){return o(t?.name)&&!n(t.url)&&(/\/[\d,a-z-]{36}$/.test(t.name)&&(t.name=t.name.replace(/([\d,a-z-]{36}$)/,i())),/-[\d,a-z-]{36}$/.test(t.name)&&(t.name=t.name.replace(/(-[\d,a-z-]{36}$)/,i()))),t}const l={actions:new class{async initialize(e,t,n){this._logger=t("DeveloperActions"),this._helpers=n}async get(t){const n={"developer-inspect":async t=>{if(t.callerType===e.ViewTabContextMenu)for(let e=0;e<t.selectedViews.length;e++){const n=t.selectedViews[e],o=fin.View.wrapSync(n);await o.showDeveloperTools()}else if(t.callerType===e.PageTabContextMenu){const e=t.windowIdentity,n=fin.Window.wrapSync(e);await n.showDeveloperTools()}else if(t.callerType===e.GlobalContextMenu){const e="window"==("platform"===t?.customData?.target?"platform":"window")?t.windowIdentity:{uuid:t.windowIdentity.uuid,name:t.windowIdentity.uuid},n=fin.Window.wrapSync(e);await n.showDeveloperTools()}}};return n["developer-get-snapshot"]=async t=>{if(t.callerType===e.PageTabContextMenu){const e=t.windowIdentity,n=fin.Window.wrapSync(e),o=await n.getOptions();let a=o.workspacePlatform.pages[0];if(o.workspacePlatform.pages.length>1&&(a=o.workspacePlatform.pages.find(e=>e.pageId===t.pageId)),a){const e=i();o.workspacePlatform.pages=[a],o.layout=a.layout;const t=a.layoutContainerKey;o.layoutSnapshot.layouts[t]=a.layout,o.layoutSnapshot.pages=o.workspacePlatform.pages;let n=JSON.stringify(o,r,2);n=n.replaceAll(a.pageId,e),n=n.replaceAll(t,i()),await fin.Clipboard.writeText({data:n}),this._logger?.info(`Copied page snapshot for page ${a.pageId} with new pageId ${e} to clipboard`,JSON.parse(n))}else this._logger?.warn(`No page found with id ${t.pageId} in window ${n.identity.name}`)}else if(t.callerType===e.GlobalContextMenu){const e=t.windowIdentity,n=fin.Window.wrapSync(e),o=await n.getOptions(),a={},s={};for(let e=0;e<o.workspacePlatform.pages.length;e++){const t=i(),n=i(),r=o.workspacePlatform.pages[e].layoutContainerKey;a[o.workspacePlatform.pages[e].pageId]=t,s[r]=n}let l=JSON.stringify(o,r,2);const p=Object.keys(a);for(let e=0;e<p.length;e++)l=l.replaceAll(p[e],a[p[e]]);const c=Object.keys(s);for(let e=0;e<c.length;e++)l=l.replaceAll(c[e],s[c[e]]);await fin.Clipboard.writeText({data:l}),this._logger?.info(`Copied page snapshot for window ${n.identity.name} to clipboard`,JSON.parse(l))}},n["raise-create-app-definition-intent"]=async t=>{if(t.callerType===e.ViewTabContextMenu){const e=fin.Interop.connectSync(fin.me.identity.uuid,{});for(let n=0;n<t.selectedViews.length;n++){const i=t.selectedViews[n],r="CreateAppDefinition";try{const t=fin.View.wrapSync(i),n=await t.getOptions(),l=await t.getInfo(),p=n.name,c=o(n.fdc3InteropApi)?n.fdc3InteropApi:"2.0",d=Array.isArray(n.preloadScripts)&&n.preloadScripts.length>0?n.preloadScripts:void 0,u={url:l.url,fdc3InteropApi:c,interop:n.interop,customData:n.customData,preloadScripts:d},y=[],f=l.favicons||[];for(let e=0;e<f.length;e++)y.push({src:f[e]});const g={name:r,context:{type:"openfin.app",app:{appId:p,name:p,title:l.title,description:l.title,manifestType:s,manifest:u,tags:[a],icons:y,images:[],publisher:"",contactEmail:"",supportEmail:"",intents:[]}}};await e.fireIntent(g)}catch(e){this._logger?.error(`Error while trying to raise intent ${r} for view ${i.name}`,e)}}}},n["copy-url"]=async t=>{if(t.callerType===e.ViewTabContextMenu){const e=[];for(let n=0;n<t.selectedViews.length;n++){const o=t.selectedViews[n];try{const t=fin.View.wrapSync(o),n=await t.getInfo();e.push(n.url)}catch(e){this._logger?.error(`Error while trying to capture view url for view ${o.name}`,e)}}if(e.length>0){const t=e.join("\n");await fin.Clipboard.writeText({data:t})}}},n}},analytics:new class{constructor(){this._cachedAnalyticEvents=[]}async initialize(e,t,o){this._logger=t("DeveloperAnalyticsModule"),this._logger.info("Initialized"),this._logger.info("Session Id: ",o.sessionId),this._helpers=o,this._contextType=e.data?.contextType??"fin.dev.platform.analytics";const i=e.data?.sessionContextGroupName??"dev/platform/analytics";if(this._logger.info(`Using channel name: ${i} and contextType: ${this._contextType}. These can be customized by passing data settings: sessionContextGroupName and contextType in the module settings.`),n(o.subscribeLifecycleEvent))this._logger.warn("This analytics module requires a session context group name, a context type, the ability to create an interop client and the ability to listen for lifecycle events. Unfortunately this criteria has not been met.");else{this._logger.info("Subscribing to the after bootstrap event.");const e=o.subscribeLifecycleEvent("after-bootstrap",async t=>{n(o.getInteropClient)||(this._logger?.info("After bootstrap lifecycle event received. Getting interop client."),this._interopClient=await o.getInteropClient(),this._interopClient&&(this._channel=await this._interopClient.joinSessionContextGroup(i),n(this._helpers?.unsubscribeLifecycleEvent)||this._helpers?.unsubscribeLifecycleEvent(e,"after-bootstrap")))})}}async handleAnalytics(e){if(Array.isArray(e))if(n(this._channel))this._cachedAnalyticEvents.push(...e);else{let t=[];this._cachedAnalyticEvents.length>0&&(this._logger?.info(`Adding ${this._cachedAnalyticEvents.length} analytic events.`),t.push(...this._cachedAnalyticEvents),this._cachedAnalyticEvents=[]),t.push(...e);const n=t.length;t=t.filter(e=>!("interop"===e.type.toLowerCase()&&"browser"!==e.source.toLowerCase()));const o=t.length;n!==o&&this._logger?.info(`Filtered out ${n-o} events as they were of type interop and not from the browser and we send events out over interop`);const i={type:this._contextType,name:"Analytic Events",events:t};await this._channel.setContext(i)}else this._logger?.warn("We were not passed an array of analytical events.")}async closedown(){this._logger?.info("closing down")}},menus:new class{async initialize(e,t,n){this._logger=t("DeveloperMenus")}async get(e,t){return"global"===e?[{include:!0,label:"Inspect Window",data:{type:"Custom",action:{id:"developer-inspect"}},position:{operation:"after",type:"Custom",customId:"notification-toggle"},separator:"before"},{include:!0,label:"Inspect Platform",data:{type:"Custom",action:{id:"developer-inspect",customData:{target:"platform"}}},position:{operation:"after",type:"Custom",customId:"developer-inspect"}},{include:!0,label:"Copy Window Snapshot",data:{type:"Custom",action:{id:"developer-get-snapshot"}},position:{operation:"after",type:"Custom",customId:"developer-inspect"}}]:"page"===e?[{include:!0,label:"Inspect Window",data:{type:"Custom",action:{id:"developer-inspect"}},position:{operation:"before",type:"Close"},separator:"after"},{include:!0,label:"Copy Page Snapshot",data:{type:"Custom",action:{id:"developer-get-snapshot"}},position:{operation:"before",type:"Close"},separator:"after"}]:"view"===e?[{include:!0,label:"Inspect View",data:{type:"Custom",action:{id:"developer-inspect"}},position:{operation:"before",type:"CloseTab"},separator:"before"},{include:!0,label:"Create App Definition",data:{type:"Custom",action:{id:"raise-create-app-definition-intent"}},position:{operation:"after",type:"Custom",customId:"developer-inspect"}},{include:!0,label:"Copy Url",data:{type:"Custom",action:{id:"copy-url"}},position:{operation:"after",type:"Custom",customId:"raise-create-app-definition-intent"},separator:"after"}]:void 0}}};export{l as entryPoints};
//# sourceMappingURL=developer.bundle.js.map