/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "../../node_modules/@openfin/snap-sdk/openfin.snap.mjs":
/*!*************************************************************!*\
  !*** ../../node_modules/@openfin/snap-sdk/openfin.snap.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   SnapServer: () => (/* binding */ w)
/* harmony export */ });
var e={827:e=>{var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,i){function a(n){e.removeListener(t,r),i(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",a),n([].slice.call(arguments))}y(e,t,r,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}(e,a,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function p(e,t,n,i){var a,r,o,p;if(s(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),o=r[t]),void 0===o)o=r[t]=n,++e._eventsCount;else if("function"==typeof o?o=r[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(a=c(e))>0&&o.length>a&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,p=l,console&&console.warn&&console.warn(p)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},a=l.bind(i);return a.listener=n,i.wrapFn=a,a}function u(e,t,n){var i=e._events;if(void 0===i)return[];var a=i[t];return void 0===a?[]:"function"==typeof a?n?[a.listener||a]:[a]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(a):f(a,a.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function y(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function a(r){i.once&&e.removeEventListener(t,a),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var a="error"===e,r=this._events;if(void 0!==r)a=a&&void 0===r.error;else if(!a)return!1;if(a){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var p=c.length,l=f(c,p);for(n=0;n<p;++n)i(l[n],this,t)}return!0},r.prototype.addListener=function(e,t){return p(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return p(this,e,t,!0)},r.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,a,r,o;if(s(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(a=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){o=n[r].listener,a=r;break}if(a<0)return this;0===a?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,a),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var a,r=Object.keys(n);for(i=0;i<r.length;++i)"removeListener"!==(a=r[i])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};n.d(i,{q:()=>l});var a=n(827);const r="openfin-snap",o="1.3.3",s=(e,t)=>`${e} ${t instanceof Error?t.message:"string"==typeof t?t:JSON.stringify(t)}`,c=async()=>{try{return(await fin.System.getAppAssetInfo({alias:r})).version===o}catch(e){return!1}},p="internal-generated-window-";class l{constructor(e){if(this.server_id=e,this.emitter=new a.EventEmitter,this.__extensions=[],!fin)throw new Error("OpenFin is not available")}async start(e){try{const e=await fin.System.getRuntimeInfo();"x64"!==e?.architecture&&console.warn(`The architecture of the connected OpenFin runtime is '${e.architecture}' - Window snapping is currently only supported with 64-bit applications. Snapping will be disabled.`)}catch(e){console.warn(`Could not get runtime info: ${e}`)}const t=await fin.System.queryPermissionForCurrentContext("System.launchExternalProcess");if(!t.granted)throw new Error("The 'System.launchExternalProcess' permission is required to launch the Snap server");if(t.rawValue){if(e?.executablePath&&!t.rawValue?.executables?.enabled)throw new Error("The 'System.launchExternalProcess.assets' permission is required to launch the Snap server from an executable path");if(!e?.executablePath&&!t.rawValue?.assets?.enabled)throw new Error("The 'System.launchExternalProcess.assets' permission is required to launch the Snap server from a URL")}e?.executablePath||await(async e=>{const t=await fin.Application.getCurrentSync().getManifest(),n=t.appAssets?.find((e=>e.alias===r));if(n)return void console.warn("Detected Snap package in app manifest appAssets",n);if(await c())return void console.info("Using existing Snap package");const i=e??`https://cdn.openfin.co/release/snap/${o}/snap.zip`;console.info(`Downloading Snap asset from: '${i}'`);const a={alias:r,src:`${i}`,target:"OpenFinSnap.exe",version:o};console.info("Downloading Snap package",a);try{await fin.System.downloadAsset(a,(()=>{}))}catch(e){throw new Error(s("Unable to download Snap package.",e))}})(e?.customSnapAssetSource);const n=await this.build_command_line(e);let i={alias:r,arguments:n,lifetime:"window"};e?.executablePath&&(i={path:e.executablePath,arguments:n,lifetime:"window"});try{this.snap_identity=await fin.System.launchExternalProcess(i)}catch(e){throw new Error(s("Failed to launch the Snap server.",e))}return this.connect()}async connect(){this.client=await fin.InterApplicationBus.Channel.connect(`snap-server-core-${this.server_id}`),this.client.register("snap_handshake",(async(e,t)=>{try{await fin.System.registerUsage({type:"adapter-feature",data:{apiVersion:e.version,componentName:"snap-server"}})}catch{console.warn("SnapSDK: Failed to register usage for Snap Server")}}));try{await fin.System.registerUsage({type:"adapter-feature",data:{apiVersion:"1.3.3",componentName:"snap-client"}})}catch{console.warn("SnapSDK: Failed to register usage for Snap Server")}this.client.register("snap_updates",((e,t)=>this.handleSnapEvents(e,t))),this.__extensions.forEach((e=>e.onConnected(this.client)))}__addExtension(e){this.__extensions.push(e)}async stop(){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"shutdown"}))}async showDebugWindow(e){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"showDebugWindow",payload:{show:e}}))}async getLayout(){if(!this.client)throw new Error("Snap server is not running");const e=await(this.client?.dispatch("snap_api_invoke",{action:"serialiseLayout"}));return e?.payload.layout}async setLayout(e,t=!0){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"deserialiseLayout",payload:{layout:e,reset:t}}))}async enterDeferredLayout(){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"enterBatchMode"}))}async exitDeferredLayout(){if(!this.client)throw new Error("Snap server is not running");await(this.client?.dispatch("snap_api_invoke",{action:"exitBatchMode"}))}async prepareToApplySnapshot(e,t){if(!e||e.options?.closeExistingWindows||e.options?.closeSnapshotWindows)return this.needToResetLayout=!0,void await(this.client?.dispatch("snap_api_invoke",{action:"resetAll"}));this.needToResetLayout=!1;const n=e.snapshot,i=JSON.stringify(n,null,2),a=n.snap;if(!a)return;await(this.client?.dispatch("snap_api_invoke",{action:"prepareToApplyLayout"}));const r=t??v,o=(await this.getLayout())?.clients.map((e=>e.id))??[],s=f(n.windows),c=Array.from(s.keys()).filter((e=>o.includes(e)));a.clients.filter((e=>c.includes(e.id))).forEach((e=>{const t=e.id,n=r(t);e.id=n,y(a.connections,t,n);const i=s.get(t);i.customData.snapClientId=n,i.name=n}));const p=JSON.stringify(n,null,2);console.debug(`Snap SDK modified snapshot data before applying it.\nOriginal snapshot:\n${i}\nModified snapshot:\n${p}`)}async decorateSnapshot(e){return{...e,snap:await this.getLayout()}}async applySnapshot(e){e.snap&&await this.setLayout(e.snap,this.needToResetLayout)}async launch(e){if(!this.client)throw new Error("Not connected to an Snap server");e.appAssetInfo&&(e.path=await d({target:e.path,...e.appAssetInfo})),console.log("options: ",e);const t={action:"startProcess",payload:{...e,args:e.args||[]}};if(e.strategy){const{type:n,...i}=e.strategy;t.payload.strategy={type:n,parameters:{...i}}}const n=await(this.client?.dispatch("snap_api_invoke",t));if(n?.payload?.success)return{process_id:n.payload.process_id};throw new Error(`Failed to launch process: ${n?.payload?.error}`)}async registerWindow(e,t,n){await(this.client?.dispatch("snap_api_invoke",{action:"hookAndRegisterWindow",payload:{clientId:e,windowHandle:t,resizingBehavior:n}}))}async enableAutoWindowRegistration(){const e=e=>this.handleNewWindow(e);return await fin.Platform.getCurrentSync().addListener("window-created",e),async()=>{await fin.System.removeListener("window-created",e)}}async attachWindows(e,t,n,i){await(this.client?.dispatch("snap_api_invoke",{action:"attach",payload:{targetClientId:e,toAttachClientId:t,targetSide:n,offset:i}}))}async detachFromGroup(e){await(this.client?.dispatch("snap_api_invoke",{action:"detachFromGroup",payload:{clientId:e}}))}async getAttached(e){return(await(this.client?.dispatch("snap_api_invoke",{action:"getAttachedInstances",payload:{clientId:e}}))).payload.attached}async hasAttachments(e){return(await(this.client?.dispatch("snap_api_invoke",{action:"hasAttachments",payload:{clientId:e}}))).payload.hasAttachments}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}once(e,t){this.emitter.once(e,t)}async getGroupIdForWindow(e){const t="number"==typeof e?{nativeWindowId:e}:{clientId:e},n=await(this.client?.dispatch("snap_api_invoke",{action:"getGroupIdForWindow",payload:t}));if(!n.payload.groupId)throw new Error("No group found for window");return n.payload.groupId}async getWindowResizable(e){const t="number"==typeof e?{nativeWindowId:e}:{clientId:e},n=await(this.client?.dispatch("snap_api_invoke",{action:"getResizable",payload:t}));if(null===n.payload.resizable)throw new Error("No window found for given ID");return n.payload.resizable}async setWindowResizable(e,t){const n="number"==typeof e?{nativeWindowId:e,resizable:t}:{clientId:e,resizable:t};await(this.client?.dispatch("snap_api_invoke",{action:"setResizable",payload:n}))}async getWindowsInGroup(e){const t=await(this.client?.dispatch("snap_api_invoke",{action:"getWindowsInGroup",payload:{groupId:e}}));return t.payload.windows?t.payload.windows.map((e=>({nativeId:e[0],clientId:e[1]}))):[]}async getAllGroupIds(){return(await(this.client?.dispatch("snap_api_invoke",{action:"getAllGroupIds"}))).payload.groupIds}async minimizeGroup(e){await(this.client?.dispatch("snap_api_invoke",{action:"minimizeGroup",payload:{groupId:e}}))}async restoreGroup(e){await(this.client?.dispatch("snap_api_invoke",{action:"restoreGroup",payload:{groupId:e}}))}async handleNewWindow(e){const t=await fin.Window.wrap({uuid:e.uuid,name:e.name}),n=await t.getNativeId();let i=t.identity.name;const a=await t.getOptions();if(void 0!==a.includeInSnapshots&&!1===a.includeInSnapshots)return void console.log(`SnapSDK: Not registering ${e.uuid}:${e.name}, Window is explicitly excluded -includeInSnapshots == false`);const r=a.customData||{};r.snapClientId?i=r.snapClientId:await t.updateOptions({customData:{...r,snapClientId:i}}),console.log(`SnapSDK: Auto-registering window: snapClientId:${i}, handle ${n}, uuid:${e.uuid}, name:${e.name}`),await this.registerWindow(i,n,r.snapResizingBehavior)}emit_event(e,...t){this.emitter.emit(e,...t)}handleSnapEvents(e,t){switch(this.emit_event("all-events",{type:e.action,payload:e.payload}),e.action){case"clientRegistered":this.emit_event("client-registered",{clientId:e.payload.clientId,windowHandle:`#${e.payload.windowHandle.toString(16).toUpperCase()}`,owningProcessId:e.payload.owningProcessId});break;case"clientUnRegistered":this.emit_event("client-unregistered",{...e.payload});break;case"moveSizeCompleted":this.emit_event("move-size-completed",{...e.payload});break;case"clientsAttached":this.emit_event("clients-attached",{...e.payload});break;case"clientDetached":this.emit_event("client-detached",{...e.payload});break;case"groupsChanged":this.emit_event("groups-changed",{...e.payload});break;case"clientActivated":this.emit_event("client-activated",{...e.payload});break;case"clientDeactivated":this.emit_event("client-deactivated",{...e.payload})}}async build_command_line(e){let t=`--id ${this.server_id} `;e?.showDebug&&(t+=" --show-debug "),e?.disableGPUAcceleratedDragging&&(t+=" --disable-gpu-accelerated-dragging true "),e?.disableBlurDropPreview&&(t+=" --blur-drop-preview false "),void 0!==e?.blurEffectPerformanceThreshold&&(t+=` --blur-effect-performance-threshold=${e?.blurEffectPerformanceThreshold} `),e?.disableUserUnstick&&(t+=" --disable-user-unstick "),!0!==e?.keyToStick&&"string"!=typeof e?.keyToStick||(t+=` --ks=${!0===e.keyToStick?"ctrl":e.keyToStick} `),e?.keyToUnstick&&(t+=` --kus=${e.keyToUnstick} `),e?.hideTaskbarEntry&&(t+=" --no-tb "),e?.taskbarIconGroup&&(t+=` --tb-id=${e?.taskbarIconGroup} `),e?.taskbarIcon&&(t+=` --tb-icon=${e?.taskbarIcon} `),e?.disableRuntimeHeartbeating&&(t+=" --no-hb "),e?.autoHideClientTaskbarIcons&&(t+=" --tb-auto-hide "),e?.theme&&(t+=` --thm=${e.theme} `),e?.defaultResizingBehavior&&(t+=` --res=${e?.defaultResizingBehavior} `);const n=await fin.System.getRuntimeInfo();return t+=`--runtime-port ${n.port} `,t+=`--runtime-version ${n.version} `,t.trim()}}const d=async e=>{let t=(await fin.System.getRuntimeInfo()).args["local-startup-url"].replace("config.json","");const n=t.includes("\\")?"\\":"/";return t.endsWith(n)&&(t=t.slice(0,-1)),[t,"assets",e.alias,e.version,e.target].join(n)},u=()=>"undefined"!=typeof crypto&&"randomUUID"in crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),h=e=>/^app:\/[^/]+\/[^/]+$/.test(e??""),f=e=>{const t=new Map;return e.forEach((e=>{const n=!e.name,i=e.name?.startsWith(p)??!1,a=e.customData?.snapClientId;(n||i||h(e.name))&&a&&t.set(a,e)})),t},y=(e,t,n)=>{Object.values(e).forEach((e=>{e.attachedClientId===t?e.attachedClientId=n:e.targetClientId===t&&(e.targetClientId=n)}))},v=e=>{if(!h(e))return`${p}${u()}`;const t=e.split("/");return t[t.length-1]=u(),t.join("/")};var w=i.q;

/***/ }),

/***/ "./client/src/preload/preload.common.ts":
/*!**********************************************!*\
  !*** ./client/src/preload/preload.common.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   initialize: () => (/* binding */ initialize)
/* harmony export */ });
/* harmony import */ var _openfin_snap_sdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @openfin/snap-sdk */ "../../node_modules/@openfin/snap-sdk/openfin.snap.mjs");
/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../settings */ "./client/src/settings.ts");


/**
 * Initialize the snap components.
 * @param options The options for initializing the snap provider.
 * @param createLayoutChannel Whether to create a simple channel api service that exposes the getLayout and applyLayout functionality of snap.
 */
async function initialize(options, createLayoutChannel = false) {
    const settings = await (0,_settings__WEBPACK_IMPORTED_MODULE_1__.getSettings)();
    const settingsServerOptions = settings?.serverOptions ?? {};
    const passedOptions = options?.serverOptions ?? {};
    const finalOptions = { ...settingsServerOptions, ...passedOptions };
    const finalPlatformId = options?.platformId ?? settings?.platformId;
    try {
        if (finalPlatformId) {
            console.log("Registering Snap with platformId", finalPlatformId);
            const server = new _openfin_snap_sdk__WEBPACK_IMPORTED_MODULE_0__.SnapServer(finalPlatformId);
            console.log("Enabling debug window:", finalOptions.showDebug ?? false);
            await server.start(finalOptions);
            if (createLayoutChannel) {
                try {
                    const channelName = `${fin.me.identity.uuid}-snap-layout`;
                    console.log(`Channel Service: Creating snap preload layout channel: ${channelName}`);
                    const channel = await fin.InterApplicationBus.Channel.create(channelName);
                    channel.register("getLayout", async () => {
                        console.log("Channel Service: Getting layout from Snap");
                        const layout = await server.getLayout();
                        console.log("Channel Service: Got layout from Snap", layout);
                        return layout;
                    });
                    channel.register("applyLayout", async (payload) => {
                        console.log("Channel Service: Applying layout to Snap", payload);
                        console.log("Channel Service: Preparing to apply snapshot");
                        await server.prepareToApplySnapshot();
                        console.log("Channel Service: Applying snapshot");
                        await server.applySnapshot(payload);
                        console.log("Channel Service: Applied snapshot");
                    });
                    channel.onConnection(async (identity) => {
                        console.log("Channel Service: Connection request from:", identity);
                        // eslint-disable-next-line prefer-template
                        if (identity.uuid !== fin.me.identity.uuid) {
                            const message = `Channel Service: Rejecting connection request as it is not coming from within the application. Identity should be: ${fin.me.identity.uuid} and connection request is coming from: ${identity.uuid}`;
                            console.error(message);
                            throw new Error(message);
                        }
                    });
                    channel.onDisconnection(async (identity) => {
                        console.log("Channel Service: Disconnection request from:", identity);
                    });
                    setTimeout(async () => {
                        try {
                            console.log("Channel Client: Connecting to snap preload layout channel to validate connection.");
                            const clientChannelName = `${fin.me.identity.uuid}-snap-layout`;
                            const snapPreloadClient = await fin.InterApplicationBus.Channel.connect(clientChannelName);
                            // fetch the current snap layout
                            console.log("Channel Client: Requesting layout from Snap");
                            const layout = (await snapPreloadClient.dispatch("getLayout"));
                            console.log("Channel Client: Got layout from Snap", layout);
                            // apply the layout
                            console.log("Channel Client: Applying layout to Snap");
                            await snapPreloadClient.dispatch("applyLayout", layout);
                            console.log("Channel Client: Applied layout to Snap");
                            console.log("Channel Client: Intentionally disconnecting from snap preload Channel Service");
                            await snapPreloadClient.disconnect();
                        }
                        catch (clientError) {
                            console.error("Channel Client: Error connecting to snap preload layout Channel Service", clientError);
                        }
                    }, 1000);
                }
                catch (err) {
                    console.error("Channel Service: Error creating snap layout channel", err);
                }
            }
            const app = fin.Application.getCurrentSync();
            await app.on("window-created", async (e) => {
                const win = fin.Window.wrapSync(e);
                const winOptions = await win.getOptions();
                if (!winOptions.includeInSnapshots) {
                    console.log("Window is not registered with Snap because includeInSnapshots is disabled.");
                }
                else {
                    const nativeId = await win.getNativeId();
                    console.log("Registering window with NativeID with Snap", nativeId);
                    await server.registerWindow(win.identity.name, nativeId);
                }
            });
            const hostOptions = (await fin.me.getOptions());
            if (hostOptions.autoShow) {
                console.log("Registering current window with snap");
                await server.registerWindow(fin.me.identity.name, await fin.Window.getCurrentSync().getNativeId());
            }
            else {
                console.log("Current window is not registered with Snap because autoShow is disabled.");
            }
        }
    }
    catch (err) {
        console.error("Error initializing Snap", err);
    }
}


/***/ }),

/***/ "./client/src/settings.ts":
/*!********************************!*\
  !*** ./client/src/settings.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getSettings: () => (/* binding */ getSettings)
/* harmony export */ });
/**
 * Gets settings from the manifest.
 * @param showDebugWindow Whether to enable the debug window regardless of manifest settings.
 * @returns The snap provider options from the manifest.
 */
async function getSettings(showDebugWindow) {
    const app = await fin.Application.getCurrent();
    const manifest = await app.getManifest();
    if (manifest.appAssets?.[0]?.src === "SNAP_ASSET_URL") {
        console.error("Please request the SNAP_ASSET_URL from OpenFin and update manifest.fin.json before running the sample");
    }
    const settings = await getManifestCustomSettings(manifest);
    settings.snapProvider ??= {};
    if (settings.snapProvider.serverOptions === undefined) {
        settings.snapProvider.serverOptions = {
            showDebug: showDebugWindow
        };
    }
    return settings.snapProvider;
}
/**
 * Read the custom settings from the manifest.fin.json.
 * @param manifest The manifest to load the custom settings from.
 * @returns The custom settings from the manifest.
 */
async function getManifestCustomSettings(manifest) {
    return manifest.customSettings ?? {};
}


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it needs to be isolated against other modules in the chunk.
(() => {
/*!***************************************!*\
  !*** ./client/src/preload/preload.ts ***!
  \***************************************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _preload_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./preload.common */ "./client/src/preload/preload.common.ts");

if (window === window.top) {
    console.log("Adding snap support through a preload.");
    window.addEventListener("DOMContentLoaded", async () => {
        await (0,_preload_common__WEBPACK_IMPORTED_MODULE_0__.initialize)({ platformId: fin.me.identity.uuid });
    });
}

})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Ozs7Ozs7O1VDakNEO1VBQ0E7O1VBRUE7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7O1VBRUE7VUFDQTs7VUFFQTtVQUNBO1VBQ0E7Ozs7O1dDdEJBO1dBQ0E7V0FDQTtXQUNBO1dBQ0EseUNBQXlDLHdDQUF3QztXQUNqRjtXQUNBO1dBQ0EsRTs7Ozs7V0NQQSx3Rjs7Ozs7V0NBQTtXQUNBO1dBQ0E7V0FDQSx1REFBdUQsaUJBQWlCO1dBQ3hFO1dBQ0EsZ0RBQWdELGFBQWE7V0FDN0QsRTs7Ozs7Ozs7Ozs7O0FDTjhDO0FBRTlDLElBQUksTUFBTSxLQUFLLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7SUFFdEQsTUFBTSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ3RELE1BQU0sMkRBQVUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3hELENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL29wZW5maW4td29ya3NwYWNlLS1pbnRlZ3JhdGUtd2l0aC1zbmFwLy4uLy4uL25vZGVfbW9kdWxlcy9Ab3BlbmZpbi9zbmFwLXNkay9vcGVuZmluLnNuYXAubWpzIiwid2VicGFjazovL29wZW5maW4td29ya3NwYWNlLS1pbnRlZ3JhdGUtd2l0aC1zbmFwLy4vY2xpZW50L3NyYy9wcmVsb2FkL3ByZWxvYWQuY29tbW9uLnRzIiwid2VicGFjazovL29wZW5maW4td29ya3NwYWNlLS1pbnRlZ3JhdGUtd2l0aC1zbmFwLy4vY2xpZW50L3NyYy9zZXR0aW5ncy50cyIsIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vb3BlbmZpbi13b3Jrc3BhY2UtLWludGVncmF0ZS13aXRoLXNuYXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9vcGVuZmluLXdvcmtzcGFjZS0taW50ZWdyYXRlLXdpdGgtc25hcC93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL29wZW5maW4td29ya3NwYWNlLS1pbnRlZ3JhdGUtd2l0aC1zbmFwLy4vY2xpZW50L3NyYy9wcmVsb2FkL3ByZWxvYWQudHMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGU9ezgyNzplPT57dmFyIHQsbj1cIm9iamVjdFwiPT10eXBlb2YgUmVmbGVjdD9SZWZsZWN0Om51bGwsaT1uJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBuLmFwcGx5P24uYXBwbHk6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbChlLHQsbil9O3Q9biYmXCJmdW5jdGlvblwiPT10eXBlb2Ygbi5vd25LZXlzP24ub3duS2V5czpPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzP2Z1bmN0aW9uKGUpe3JldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhlKS5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKSl9OmZ1bmN0aW9uKGUpe3JldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhlKX07dmFyIGE9TnVtYmVyLmlzTmFOfHxmdW5jdGlvbihlKXtyZXR1cm4gZSE9ZX07ZnVuY3Rpb24gcigpe3IuaW5pdC5jYWxsKHRoaXMpfWUuZXhwb3J0cz1yLGUuZXhwb3J0cy5vbmNlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbihuLGkpe2Z1bmN0aW9uIGEobil7ZS5yZW1vdmVMaXN0ZW5lcih0LHIpLGkobil9ZnVuY3Rpb24gcigpe1wiZnVuY3Rpb25cIj09dHlwZW9mIGUucmVtb3ZlTGlzdGVuZXImJmUucmVtb3ZlTGlzdGVuZXIoXCJlcnJvclwiLGEpLG4oW10uc2xpY2UuY2FsbChhcmd1bWVudHMpKX15KGUsdCxyLHtvbmNlOiEwfSksXCJlcnJvclwiIT09dCYmZnVuY3Rpb24oZSx0LG4pe1wiZnVuY3Rpb25cIj09dHlwZW9mIGUub24mJnkoZSxcImVycm9yXCIsdCxuKX0oZSxhLHtvbmNlOiEwfSl9KSl9LHIuRXZlbnRFbWl0dGVyPXIsci5wcm90b3R5cGUuX2V2ZW50cz12b2lkIDAsci5wcm90b3R5cGUuX2V2ZW50c0NvdW50PTAsci5wcm90b3R5cGUuX21heExpc3RlbmVycz12b2lkIDA7dmFyIG89MTA7ZnVuY3Rpb24gcyhlKXtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBlKXRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSBcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEZ1bmN0aW9uLiBSZWNlaXZlZCB0eXBlICcrdHlwZW9mIGUpfWZ1bmN0aW9uIGMoZSl7cmV0dXJuIHZvaWQgMD09PWUuX21heExpc3RlbmVycz9yLmRlZmF1bHRNYXhMaXN0ZW5lcnM6ZS5fbWF4TGlzdGVuZXJzfWZ1bmN0aW9uIHAoZSx0LG4saSl7dmFyIGEscixvLHA7aWYocyhuKSx2b2lkIDA9PT0ocj1lLl9ldmVudHMpPyhyPWUuX2V2ZW50cz1PYmplY3QuY3JlYXRlKG51bGwpLGUuX2V2ZW50c0NvdW50PTApOih2b2lkIDAhPT1yLm5ld0xpc3RlbmVyJiYoZS5lbWl0KFwibmV3TGlzdGVuZXJcIix0LG4ubGlzdGVuZXI/bi5saXN0ZW5lcjpuKSxyPWUuX2V2ZW50cyksbz1yW3RdKSx2b2lkIDA9PT1vKW89clt0XT1uLCsrZS5fZXZlbnRzQ291bnQ7ZWxzZSBpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBvP289clt0XT1pP1tuLG9dOltvLG5dOmk/by51bnNoaWZ0KG4pOm8ucHVzaChuKSwoYT1jKGUpKT4wJiZvLmxlbmd0aD5hJiYhby53YXJuZWQpe28ud2FybmVkPSEwO3ZhciBsPW5ldyBFcnJvcihcIlBvc3NpYmxlIEV2ZW50RW1pdHRlciBtZW1vcnkgbGVhayBkZXRlY3RlZC4gXCIrby5sZW5ndGgrXCIgXCIrU3RyaW5nKHQpK1wiIGxpc3RlbmVycyBhZGRlZC4gVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gaW5jcmVhc2UgbGltaXRcIik7bC5uYW1lPVwiTWF4TGlzdGVuZXJzRXhjZWVkZWRXYXJuaW5nXCIsbC5lbWl0dGVyPWUsbC50eXBlPXQsbC5jb3VudD1vLmxlbmd0aCxwPWwsY29uc29sZSYmY29uc29sZS53YXJuJiZjb25zb2xlLndhcm4ocCl9cmV0dXJuIGV9ZnVuY3Rpb24gbCgpe2lmKCF0aGlzLmZpcmVkKXJldHVybiB0aGlzLnRhcmdldC5yZW1vdmVMaXN0ZW5lcih0aGlzLnR5cGUsdGhpcy53cmFwRm4pLHRoaXMuZmlyZWQ9ITAsMD09PWFyZ3VtZW50cy5sZW5ndGg/dGhpcy5saXN0ZW5lci5jYWxsKHRoaXMudGFyZ2V0KTp0aGlzLmxpc3RlbmVyLmFwcGx5KHRoaXMudGFyZ2V0LGFyZ3VtZW50cyl9ZnVuY3Rpb24gZChlLHQsbil7dmFyIGk9e2ZpcmVkOiExLHdyYXBGbjp2b2lkIDAsdGFyZ2V0OmUsdHlwZTp0LGxpc3RlbmVyOm59LGE9bC5iaW5kKGkpO3JldHVybiBhLmxpc3RlbmVyPW4saS53cmFwRm49YSxhfWZ1bmN0aW9uIHUoZSx0LG4pe3ZhciBpPWUuX2V2ZW50cztpZih2b2lkIDA9PT1pKXJldHVybltdO3ZhciBhPWlbdF07cmV0dXJuIHZvaWQgMD09PWE/W106XCJmdW5jdGlvblwiPT10eXBlb2YgYT9uP1thLmxpc3RlbmVyfHxhXTpbYV06bj9mdW5jdGlvbihlKXtmb3IodmFyIHQ9bmV3IEFycmF5KGUubGVuZ3RoKSxuPTA7bjx0Lmxlbmd0aDsrK24pdFtuXT1lW25dLmxpc3RlbmVyfHxlW25dO3JldHVybiB0fShhKTpmKGEsYS5sZW5ndGgpfWZ1bmN0aW9uIGgoZSl7dmFyIHQ9dGhpcy5fZXZlbnRzO2lmKHZvaWQgMCE9PXQpe3ZhciBuPXRbZV07aWYoXCJmdW5jdGlvblwiPT10eXBlb2YgbilyZXR1cm4gMTtpZih2b2lkIDAhPT1uKXJldHVybiBuLmxlbmd0aH1yZXR1cm4gMH1mdW5jdGlvbiBmKGUsdCl7Zm9yKHZhciBuPW5ldyBBcnJheSh0KSxpPTA7aTx0OysraSluW2ldPWVbaV07cmV0dXJuIG59ZnVuY3Rpb24geShlLHQsbixpKXtpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBlLm9uKWkub25jZT9lLm9uY2UodCxuKTplLm9uKHQsbik7ZWxzZXtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBlLmFkZEV2ZW50TGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlIFwiZW1pdHRlclwiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBFdmVudEVtaXR0ZXIuIFJlY2VpdmVkIHR5cGUgJyt0eXBlb2YgZSk7ZS5hZGRFdmVudExpc3RlbmVyKHQsKGZ1bmN0aW9uIGEocil7aS5vbmNlJiZlLnJlbW92ZUV2ZW50TGlzdGVuZXIodCxhKSxuKHIpfSkpfX1PYmplY3QuZGVmaW5lUHJvcGVydHkocixcImRlZmF1bHRNYXhMaXN0ZW5lcnNcIix7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gb30sc2V0OmZ1bmN0aW9uKGUpe2lmKFwibnVtYmVyXCIhPXR5cGVvZiBlfHxlPDB8fGEoZSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSBvZiBcImRlZmF1bHRNYXhMaXN0ZW5lcnNcIiBpcyBvdXQgb2YgcmFuZ2UuIEl0IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyLiBSZWNlaXZlZCAnK2UrXCIuXCIpO289ZX19KSxyLmluaXQ9ZnVuY3Rpb24oKXt2b2lkIDAhPT10aGlzLl9ldmVudHMmJnRoaXMuX2V2ZW50cyE9PU9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5fZXZlbnRzfHwodGhpcy5fZXZlbnRzPU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy5fZXZlbnRzQ291bnQ9MCksdGhpcy5fbWF4TGlzdGVuZXJzPXRoaXMuX21heExpc3RlbmVyc3x8dm9pZCAwfSxyLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnM9ZnVuY3Rpb24oZSl7aWYoXCJudW1iZXJcIiE9dHlwZW9mIGV8fGU8MHx8YShlKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHZhbHVlIG9mIFwiblwiIGlzIG91dCBvZiByYW5nZS4gSXQgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuIFJlY2VpdmVkICcrZStcIi5cIik7cmV0dXJuIHRoaXMuX21heExpc3RlbmVycz1lLHRoaXN9LHIucHJvdG90eXBlLmdldE1heExpc3RlbmVycz1mdW5jdGlvbigpe3JldHVybiBjKHRoaXMpfSxyLnByb3RvdHlwZS5lbWl0PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1bXSxuPTE7bjxhcmd1bWVudHMubGVuZ3RoO24rKyl0LnB1c2goYXJndW1lbnRzW25dKTt2YXIgYT1cImVycm9yXCI9PT1lLHI9dGhpcy5fZXZlbnRzO2lmKHZvaWQgMCE9PXIpYT1hJiZ2b2lkIDA9PT1yLmVycm9yO2Vsc2UgaWYoIWEpcmV0dXJuITE7aWYoYSl7dmFyIG87aWYodC5sZW5ndGg+MCYmKG89dFswXSksbyBpbnN0YW5jZW9mIEVycm9yKXRocm93IG87dmFyIHM9bmV3IEVycm9yKFwiVW5oYW5kbGVkIGVycm9yLlwiKyhvP1wiIChcIitvLm1lc3NhZ2UrXCIpXCI6XCJcIikpO3Rocm93IHMuY29udGV4dD1vLHN9dmFyIGM9cltlXTtpZih2b2lkIDA9PT1jKXJldHVybiExO2lmKFwiZnVuY3Rpb25cIj09dHlwZW9mIGMpaShjLHRoaXMsdCk7ZWxzZXt2YXIgcD1jLmxlbmd0aCxsPWYoYyxwKTtmb3Iobj0wO248cDsrK24paShsW25dLHRoaXMsdCl9cmV0dXJuITB9LHIucHJvdG90eXBlLmFkZExpc3RlbmVyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHAodGhpcyxlLHQsITEpfSxyLnByb3RvdHlwZS5vbj1yLnByb3RvdHlwZS5hZGRMaXN0ZW5lcixyLnByb3RvdHlwZS5wcmVwZW5kTGlzdGVuZXI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gcCh0aGlzLGUsdCwhMCl9LHIucHJvdG90eXBlLm9uY2U9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gcyh0KSx0aGlzLm9uKGUsZCh0aGlzLGUsdCkpLHRoaXN9LHIucHJvdG90eXBlLnByZXBlbmRPbmNlTGlzdGVuZXI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gcyh0KSx0aGlzLnByZXBlbmRMaXN0ZW5lcihlLGQodGhpcyxlLHQpKSx0aGlzfSxyLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcj1mdW5jdGlvbihlLHQpe3ZhciBuLGksYSxyLG87aWYocyh0KSx2b2lkIDA9PT0oaT10aGlzLl9ldmVudHMpKXJldHVybiB0aGlzO2lmKHZvaWQgMD09PShuPWlbZV0pKXJldHVybiB0aGlzO2lmKG49PT10fHxuLmxpc3RlbmVyPT09dCkwPT0tLXRoaXMuX2V2ZW50c0NvdW50P3RoaXMuX2V2ZW50cz1PYmplY3QuY3JlYXRlKG51bGwpOihkZWxldGUgaVtlXSxpLnJlbW92ZUxpc3RlbmVyJiZ0aGlzLmVtaXQoXCJyZW1vdmVMaXN0ZW5lclwiLGUsbi5saXN0ZW5lcnx8dCkpO2Vsc2UgaWYoXCJmdW5jdGlvblwiIT10eXBlb2Ygbil7Zm9yKGE9LTEscj1uLmxlbmd0aC0xO3I+PTA7ci0tKWlmKG5bcl09PT10fHxuW3JdLmxpc3RlbmVyPT09dCl7bz1uW3JdLmxpc3RlbmVyLGE9cjticmVha31pZihhPDApcmV0dXJuIHRoaXM7MD09PWE/bi5zaGlmdCgpOmZ1bmN0aW9uKGUsdCl7Zm9yKDt0KzE8ZS5sZW5ndGg7dCsrKWVbdF09ZVt0KzFdO2UucG9wKCl9KG4sYSksMT09PW4ubGVuZ3RoJiYoaVtlXT1uWzBdKSx2b2lkIDAhPT1pLnJlbW92ZUxpc3RlbmVyJiZ0aGlzLmVtaXQoXCJyZW1vdmVMaXN0ZW5lclwiLGUsb3x8dCl9cmV0dXJuIHRoaXN9LHIucHJvdG90eXBlLm9mZj1yLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcixyLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnM9ZnVuY3Rpb24oZSl7dmFyIHQsbixpO2lmKHZvaWQgMD09PShuPXRoaXMuX2V2ZW50cykpcmV0dXJuIHRoaXM7aWYodm9pZCAwPT09bi5yZW1vdmVMaXN0ZW5lcilyZXR1cm4gMD09PWFyZ3VtZW50cy5sZW5ndGg/KHRoaXMuX2V2ZW50cz1PYmplY3QuY3JlYXRlKG51bGwpLHRoaXMuX2V2ZW50c0NvdW50PTApOnZvaWQgMCE9PW5bZV0mJigwPT0tLXRoaXMuX2V2ZW50c0NvdW50P3RoaXMuX2V2ZW50cz1PYmplY3QuY3JlYXRlKG51bGwpOmRlbGV0ZSBuW2VdKSx0aGlzO2lmKDA9PT1hcmd1bWVudHMubGVuZ3RoKXt2YXIgYSxyPU9iamVjdC5rZXlzKG4pO2ZvcihpPTA7aTxyLmxlbmd0aDsrK2kpXCJyZW1vdmVMaXN0ZW5lclwiIT09KGE9cltpXSkmJnRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGEpO3JldHVybiB0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhcInJlbW92ZUxpc3RlbmVyXCIpLHRoaXMuX2V2ZW50cz1PYmplY3QuY3JlYXRlKG51bGwpLHRoaXMuX2V2ZW50c0NvdW50PTAsdGhpc31pZihcImZ1bmN0aW9uXCI9PXR5cGVvZih0PW5bZV0pKXRoaXMucmVtb3ZlTGlzdGVuZXIoZSx0KTtlbHNlIGlmKHZvaWQgMCE9PXQpZm9yKGk9dC5sZW5ndGgtMTtpPj0wO2ktLSl0aGlzLnJlbW92ZUxpc3RlbmVyKGUsdFtpXSk7cmV0dXJuIHRoaXN9LHIucHJvdG90eXBlLmxpc3RlbmVycz1mdW5jdGlvbihlKXtyZXR1cm4gdSh0aGlzLGUsITApfSxyLnByb3RvdHlwZS5yYXdMaXN0ZW5lcnM9ZnVuY3Rpb24oZSl7cmV0dXJuIHUodGhpcyxlLCExKX0sci5saXN0ZW5lckNvdW50PWZ1bmN0aW9uKGUsdCl7cmV0dXJuXCJmdW5jdGlvblwiPT10eXBlb2YgZS5saXN0ZW5lckNvdW50P2UubGlzdGVuZXJDb3VudCh0KTpoLmNhbGwoZSx0KX0sci5wcm90b3R5cGUubGlzdGVuZXJDb3VudD1oLHIucHJvdG90eXBlLmV2ZW50TmFtZXM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZXZlbnRzQ291bnQ+MD90KHRoaXMuX2V2ZW50cyk6W119fX0sdD17fTtmdW5jdGlvbiBuKGkpe3ZhciBhPXRbaV07aWYodm9pZCAwIT09YSlyZXR1cm4gYS5leHBvcnRzO3ZhciByPXRbaV09e2V4cG9ydHM6e319O3JldHVybiBlW2ldKHIsci5leHBvcnRzLG4pLHIuZXhwb3J0c31uLmQ9KGUsdCk9Pntmb3IodmFyIGkgaW4gdCluLm8odCxpKSYmIW4ubyhlLGkpJiZPYmplY3QuZGVmaW5lUHJvcGVydHkoZSxpLHtlbnVtZXJhYmxlOiEwLGdldDp0W2ldfSl9LG4ubz0oZSx0KT0+T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsdCk7dmFyIGk9e307bi5kKGkse3E6KCk9Pmx9KTt2YXIgYT1uKDgyNyk7Y29uc3Qgcj1cIm9wZW5maW4tc25hcFwiLG89XCIxLjMuM1wiLHM9KGUsdCk9PmAke2V9ICR7dCBpbnN0YW5jZW9mIEVycm9yP3QubWVzc2FnZTpcInN0cmluZ1wiPT10eXBlb2YgdD90OkpTT04uc3RyaW5naWZ5KHQpfWAsYz1hc3luYygpPT57dHJ5e3JldHVybihhd2FpdCBmaW4uU3lzdGVtLmdldEFwcEFzc2V0SW5mbyh7YWxpYXM6cn0pKS52ZXJzaW9uPT09b31jYXRjaChlKXtyZXR1cm4hMX19LHA9XCJpbnRlcm5hbC1nZW5lcmF0ZWQtd2luZG93LVwiO2NsYXNzIGx7Y29uc3RydWN0b3IoZSl7aWYodGhpcy5zZXJ2ZXJfaWQ9ZSx0aGlzLmVtaXR0ZXI9bmV3IGEuRXZlbnRFbWl0dGVyLHRoaXMuX19leHRlbnNpb25zPVtdLCFmaW4pdGhyb3cgbmV3IEVycm9yKFwiT3BlbkZpbiBpcyBub3QgYXZhaWxhYmxlXCIpfWFzeW5jIHN0YXJ0KGUpe3RyeXtjb25zdCBlPWF3YWl0IGZpbi5TeXN0ZW0uZ2V0UnVudGltZUluZm8oKTtcIng2NFwiIT09ZT8uYXJjaGl0ZWN0dXJlJiZjb25zb2xlLndhcm4oYFRoZSBhcmNoaXRlY3R1cmUgb2YgdGhlIGNvbm5lY3RlZCBPcGVuRmluIHJ1bnRpbWUgaXMgJyR7ZS5hcmNoaXRlY3R1cmV9JyAtIFdpbmRvdyBzbmFwcGluZyBpcyBjdXJyZW50bHkgb25seSBzdXBwb3J0ZWQgd2l0aCA2NC1iaXQgYXBwbGljYXRpb25zLiBTbmFwcGluZyB3aWxsIGJlIGRpc2FibGVkLmApfWNhdGNoKGUpe2NvbnNvbGUud2FybihgQ291bGQgbm90IGdldCBydW50aW1lIGluZm86ICR7ZX1gKX1jb25zdCB0PWF3YWl0IGZpbi5TeXN0ZW0ucXVlcnlQZXJtaXNzaW9uRm9yQ3VycmVudENvbnRleHQoXCJTeXN0ZW0ubGF1bmNoRXh0ZXJuYWxQcm9jZXNzXCIpO2lmKCF0LmdyYW50ZWQpdGhyb3cgbmV3IEVycm9yKFwiVGhlICdTeXN0ZW0ubGF1bmNoRXh0ZXJuYWxQcm9jZXNzJyBwZXJtaXNzaW9uIGlzIHJlcXVpcmVkIHRvIGxhdW5jaCB0aGUgU25hcCBzZXJ2ZXJcIik7aWYodC5yYXdWYWx1ZSl7aWYoZT8uZXhlY3V0YWJsZVBhdGgmJiF0LnJhd1ZhbHVlPy5leGVjdXRhYmxlcz8uZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJUaGUgJ1N5c3RlbS5sYXVuY2hFeHRlcm5hbFByb2Nlc3MuYXNzZXRzJyBwZXJtaXNzaW9uIGlzIHJlcXVpcmVkIHRvIGxhdW5jaCB0aGUgU25hcCBzZXJ2ZXIgZnJvbSBhbiBleGVjdXRhYmxlIHBhdGhcIik7aWYoIWU/LmV4ZWN1dGFibGVQYXRoJiYhdC5yYXdWYWx1ZT8uYXNzZXRzPy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIlRoZSAnU3lzdGVtLmxhdW5jaEV4dGVybmFsUHJvY2Vzcy5hc3NldHMnIHBlcm1pc3Npb24gaXMgcmVxdWlyZWQgdG8gbGF1bmNoIHRoZSBTbmFwIHNlcnZlciBmcm9tIGEgVVJMXCIpfWU/LmV4ZWN1dGFibGVQYXRofHxhd2FpdChhc3luYyBlPT57Y29uc3QgdD1hd2FpdCBmaW4uQXBwbGljYXRpb24uZ2V0Q3VycmVudFN5bmMoKS5nZXRNYW5pZmVzdCgpLG49dC5hcHBBc3NldHM/LmZpbmQoKGU9PmUuYWxpYXM9PT1yKSk7aWYobilyZXR1cm4gdm9pZCBjb25zb2xlLndhcm4oXCJEZXRlY3RlZCBTbmFwIHBhY2thZ2UgaW4gYXBwIG1hbmlmZXN0IGFwcEFzc2V0c1wiLG4pO2lmKGF3YWl0IGMoKSlyZXR1cm4gdm9pZCBjb25zb2xlLmluZm8oXCJVc2luZyBleGlzdGluZyBTbmFwIHBhY2thZ2VcIik7Y29uc3QgaT1lPz9gaHR0cHM6Ly9jZG4ub3BlbmZpbi5jby9yZWxlYXNlL3NuYXAvJHtvfS9zbmFwLnppcGA7Y29uc29sZS5pbmZvKGBEb3dubG9hZGluZyBTbmFwIGFzc2V0IGZyb206ICcke2l9J2ApO2NvbnN0IGE9e2FsaWFzOnIsc3JjOmAke2l9YCx0YXJnZXQ6XCJPcGVuRmluU25hcC5leGVcIix2ZXJzaW9uOm99O2NvbnNvbGUuaW5mbyhcIkRvd25sb2FkaW5nIFNuYXAgcGFja2FnZVwiLGEpO3RyeXthd2FpdCBmaW4uU3lzdGVtLmRvd25sb2FkQXNzZXQoYSwoKCk9Pnt9KSl9Y2F0Y2goZSl7dGhyb3cgbmV3IEVycm9yKHMoXCJVbmFibGUgdG8gZG93bmxvYWQgU25hcCBwYWNrYWdlLlwiLGUpKX19KShlPy5jdXN0b21TbmFwQXNzZXRTb3VyY2UpO2NvbnN0IG49YXdhaXQgdGhpcy5idWlsZF9jb21tYW5kX2xpbmUoZSk7bGV0IGk9e2FsaWFzOnIsYXJndW1lbnRzOm4sbGlmZXRpbWU6XCJ3aW5kb3dcIn07ZT8uZXhlY3V0YWJsZVBhdGgmJihpPXtwYXRoOmUuZXhlY3V0YWJsZVBhdGgsYXJndW1lbnRzOm4sbGlmZXRpbWU6XCJ3aW5kb3dcIn0pO3RyeXt0aGlzLnNuYXBfaWRlbnRpdHk9YXdhaXQgZmluLlN5c3RlbS5sYXVuY2hFeHRlcm5hbFByb2Nlc3MoaSl9Y2F0Y2goZSl7dGhyb3cgbmV3IEVycm9yKHMoXCJGYWlsZWQgdG8gbGF1bmNoIHRoZSBTbmFwIHNlcnZlci5cIixlKSl9cmV0dXJuIHRoaXMuY29ubmVjdCgpfWFzeW5jIGNvbm5lY3QoKXt0aGlzLmNsaWVudD1hd2FpdCBmaW4uSW50ZXJBcHBsaWNhdGlvbkJ1cy5DaGFubmVsLmNvbm5lY3QoYHNuYXAtc2VydmVyLWNvcmUtJHt0aGlzLnNlcnZlcl9pZH1gKSx0aGlzLmNsaWVudC5yZWdpc3RlcihcInNuYXBfaGFuZHNoYWtlXCIsKGFzeW5jKGUsdCk9Pnt0cnl7YXdhaXQgZmluLlN5c3RlbS5yZWdpc3RlclVzYWdlKHt0eXBlOlwiYWRhcHRlci1mZWF0dXJlXCIsZGF0YTp7YXBpVmVyc2lvbjplLnZlcnNpb24sY29tcG9uZW50TmFtZTpcInNuYXAtc2VydmVyXCJ9fSl9Y2F0Y2h7Y29uc29sZS53YXJuKFwiU25hcFNESzogRmFpbGVkIHRvIHJlZ2lzdGVyIHVzYWdlIGZvciBTbmFwIFNlcnZlclwiKX19KSk7dHJ5e2F3YWl0IGZpbi5TeXN0ZW0ucmVnaXN0ZXJVc2FnZSh7dHlwZTpcImFkYXB0ZXItZmVhdHVyZVwiLGRhdGE6e2FwaVZlcnNpb246XCIxLjMuM1wiLGNvbXBvbmVudE5hbWU6XCJzbmFwLWNsaWVudFwifX0pfWNhdGNoe2NvbnNvbGUud2FybihcIlNuYXBTREs6IEZhaWxlZCB0byByZWdpc3RlciB1c2FnZSBmb3IgU25hcCBTZXJ2ZXJcIil9dGhpcy5jbGllbnQucmVnaXN0ZXIoXCJzbmFwX3VwZGF0ZXNcIiwoKGUsdCk9PnRoaXMuaGFuZGxlU25hcEV2ZW50cyhlLHQpKSksdGhpcy5fX2V4dGVuc2lvbnMuZm9yRWFjaCgoZT0+ZS5vbkNvbm5lY3RlZCh0aGlzLmNsaWVudCkpKX1fX2FkZEV4dGVuc2lvbihlKXt0aGlzLl9fZXh0ZW5zaW9ucy5wdXNoKGUpfWFzeW5jIHN0b3AoKXtpZighdGhpcy5jbGllbnQpdGhyb3cgbmV3IEVycm9yKFwiU25hcCBzZXJ2ZXIgaXMgbm90IHJ1bm5pbmdcIik7YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcInNodXRkb3duXCJ9KSl9YXN5bmMgc2hvd0RlYnVnV2luZG93KGUpe2lmKCF0aGlzLmNsaWVudCl0aHJvdyBuZXcgRXJyb3IoXCJTbmFwIHNlcnZlciBpcyBub3QgcnVubmluZ1wiKTthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwic2hvd0RlYnVnV2luZG93XCIscGF5bG9hZDp7c2hvdzplfX0pKX1hc3luYyBnZXRMYXlvdXQoKXtpZighdGhpcy5jbGllbnQpdGhyb3cgbmV3IEVycm9yKFwiU25hcCBzZXJ2ZXIgaXMgbm90IHJ1bm5pbmdcIik7Y29uc3QgZT1hd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwic2VyaWFsaXNlTGF5b3V0XCJ9KSk7cmV0dXJuIGU/LnBheWxvYWQubGF5b3V0fWFzeW5jIHNldExheW91dChlLHQ9ITApe2lmKCF0aGlzLmNsaWVudCl0aHJvdyBuZXcgRXJyb3IoXCJTbmFwIHNlcnZlciBpcyBub3QgcnVubmluZ1wiKTthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiZGVzZXJpYWxpc2VMYXlvdXRcIixwYXlsb2FkOntsYXlvdXQ6ZSxyZXNldDp0fX0pKX1hc3luYyBlbnRlckRlZmVycmVkTGF5b3V0KCl7aWYoIXRoaXMuY2xpZW50KXRocm93IG5ldyBFcnJvcihcIlNuYXAgc2VydmVyIGlzIG5vdCBydW5uaW5nXCIpO2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJlbnRlckJhdGNoTW9kZVwifSkpfWFzeW5jIGV4aXREZWZlcnJlZExheW91dCgpe2lmKCF0aGlzLmNsaWVudCl0aHJvdyBuZXcgRXJyb3IoXCJTbmFwIHNlcnZlciBpcyBub3QgcnVubmluZ1wiKTthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiZXhpdEJhdGNoTW9kZVwifSkpfWFzeW5jIHByZXBhcmVUb0FwcGx5U25hcHNob3QoZSx0KXtpZighZXx8ZS5vcHRpb25zPy5jbG9zZUV4aXN0aW5nV2luZG93c3x8ZS5vcHRpb25zPy5jbG9zZVNuYXBzaG90V2luZG93cylyZXR1cm4gdGhpcy5uZWVkVG9SZXNldExheW91dD0hMCx2b2lkIGF3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJyZXNldEFsbFwifSkpO3RoaXMubmVlZFRvUmVzZXRMYXlvdXQ9ITE7Y29uc3Qgbj1lLnNuYXBzaG90LGk9SlNPTi5zdHJpbmdpZnkobixudWxsLDIpLGE9bi5zbmFwO2lmKCFhKXJldHVybjthd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwicHJlcGFyZVRvQXBwbHlMYXlvdXRcIn0pKTtjb25zdCByPXQ/P3Ysbz0oYXdhaXQgdGhpcy5nZXRMYXlvdXQoKSk/LmNsaWVudHMubWFwKChlPT5lLmlkKSk/P1tdLHM9ZihuLndpbmRvd3MpLGM9QXJyYXkuZnJvbShzLmtleXMoKSkuZmlsdGVyKChlPT5vLmluY2x1ZGVzKGUpKSk7YS5jbGllbnRzLmZpbHRlcigoZT0+Yy5pbmNsdWRlcyhlLmlkKSkpLmZvckVhY2goKGU9Pntjb25zdCB0PWUuaWQsbj1yKHQpO2UuaWQ9bix5KGEuY29ubmVjdGlvbnMsdCxuKTtjb25zdCBpPXMuZ2V0KHQpO2kuY3VzdG9tRGF0YS5zbmFwQ2xpZW50SWQ9bixpLm5hbWU9bn0pKTtjb25zdCBwPUpTT04uc3RyaW5naWZ5KG4sbnVsbCwyKTtjb25zb2xlLmRlYnVnKGBTbmFwIFNESyBtb2RpZmllZCBzbmFwc2hvdCBkYXRhIGJlZm9yZSBhcHBseWluZyBpdC5cXG5PcmlnaW5hbCBzbmFwc2hvdDpcXG4ke2l9XFxuTW9kaWZpZWQgc25hcHNob3Q6XFxuJHtwfWApfWFzeW5jIGRlY29yYXRlU25hcHNob3QoZSl7cmV0dXJuey4uLmUsc25hcDphd2FpdCB0aGlzLmdldExheW91dCgpfX1hc3luYyBhcHBseVNuYXBzaG90KGUpe2Uuc25hcCYmYXdhaXQgdGhpcy5zZXRMYXlvdXQoZS5zbmFwLHRoaXMubmVlZFRvUmVzZXRMYXlvdXQpfWFzeW5jIGxhdW5jaChlKXtpZighdGhpcy5jbGllbnQpdGhyb3cgbmV3IEVycm9yKFwiTm90IGNvbm5lY3RlZCB0byBhbiBTbmFwIHNlcnZlclwiKTtlLmFwcEFzc2V0SW5mbyYmKGUucGF0aD1hd2FpdCBkKHt0YXJnZXQ6ZS5wYXRoLC4uLmUuYXBwQXNzZXRJbmZvfSkpLGNvbnNvbGUubG9nKFwib3B0aW9uczogXCIsZSk7Y29uc3QgdD17YWN0aW9uOlwic3RhcnRQcm9jZXNzXCIscGF5bG9hZDp7Li4uZSxhcmdzOmUuYXJnc3x8W119fTtpZihlLnN0cmF0ZWd5KXtjb25zdHt0eXBlOm4sLi4uaX09ZS5zdHJhdGVneTt0LnBheWxvYWQuc3RyYXRlZ3k9e3R5cGU6bixwYXJhbWV0ZXJzOnsuLi5pfX19Y29uc3Qgbj1hd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix0KSk7aWYobj8ucGF5bG9hZD8uc3VjY2VzcylyZXR1cm57cHJvY2Vzc19pZDpuLnBheWxvYWQucHJvY2Vzc19pZH07dGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gbGF1bmNoIHByb2Nlc3M6ICR7bj8ucGF5bG9hZD8uZXJyb3J9YCl9YXN5bmMgcmVnaXN0ZXJXaW5kb3coZSx0LG4pe2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJob29rQW5kUmVnaXN0ZXJXaW5kb3dcIixwYXlsb2FkOntjbGllbnRJZDplLHdpbmRvd0hhbmRsZTp0LHJlc2l6aW5nQmVoYXZpb3I6bn19KSl9YXN5bmMgZW5hYmxlQXV0b1dpbmRvd1JlZ2lzdHJhdGlvbigpe2NvbnN0IGU9ZT0+dGhpcy5oYW5kbGVOZXdXaW5kb3coZSk7cmV0dXJuIGF3YWl0IGZpbi5QbGF0Zm9ybS5nZXRDdXJyZW50U3luYygpLmFkZExpc3RlbmVyKFwid2luZG93LWNyZWF0ZWRcIixlKSxhc3luYygpPT57YXdhaXQgZmluLlN5c3RlbS5yZW1vdmVMaXN0ZW5lcihcIndpbmRvdy1jcmVhdGVkXCIsZSl9fWFzeW5jIGF0dGFjaFdpbmRvd3MoZSx0LG4saSl7YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImF0dGFjaFwiLHBheWxvYWQ6e3RhcmdldENsaWVudElkOmUsdG9BdHRhY2hDbGllbnRJZDp0LHRhcmdldFNpZGU6bixvZmZzZXQ6aX19KSl9YXN5bmMgZGV0YWNoRnJvbUdyb3VwKGUpe2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJkZXRhY2hGcm9tR3JvdXBcIixwYXlsb2FkOntjbGllbnRJZDplfX0pKX1hc3luYyBnZXRBdHRhY2hlZChlKXtyZXR1cm4oYXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImdldEF0dGFjaGVkSW5zdGFuY2VzXCIscGF5bG9hZDp7Y2xpZW50SWQ6ZX19KSkpLnBheWxvYWQuYXR0YWNoZWR9YXN5bmMgaGFzQXR0YWNobWVudHMoZSl7cmV0dXJuKGF3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJoYXNBdHRhY2htZW50c1wiLHBheWxvYWQ6e2NsaWVudElkOmV9fSkpKS5wYXlsb2FkLmhhc0F0dGFjaG1lbnRzfWFkZEV2ZW50TGlzdGVuZXIoZSx0KXt0aGlzLmVtaXR0ZXIub24oZSx0KX1yZW1vdmVFdmVudExpc3RlbmVyKGUsdCl7dGhpcy5lbWl0dGVyLm9mZihlLHQpfW9uY2UoZSx0KXt0aGlzLmVtaXR0ZXIub25jZShlLHQpfWFzeW5jIGdldEdyb3VwSWRGb3JXaW5kb3coZSl7Y29uc3QgdD1cIm51bWJlclwiPT10eXBlb2YgZT97bmF0aXZlV2luZG93SWQ6ZX06e2NsaWVudElkOmV9LG49YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcImdldEdyb3VwSWRGb3JXaW5kb3dcIixwYXlsb2FkOnR9KSk7aWYoIW4ucGF5bG9hZC5ncm91cElkKXRocm93IG5ldyBFcnJvcihcIk5vIGdyb3VwIGZvdW5kIGZvciB3aW5kb3dcIik7cmV0dXJuIG4ucGF5bG9hZC5ncm91cElkfWFzeW5jIGdldFdpbmRvd1Jlc2l6YWJsZShlKXtjb25zdCB0PVwibnVtYmVyXCI9PXR5cGVvZiBlP3tuYXRpdmVXaW5kb3dJZDplfTp7Y2xpZW50SWQ6ZX0sbj1hd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiZ2V0UmVzaXphYmxlXCIscGF5bG9hZDp0fSkpO2lmKG51bGw9PT1uLnBheWxvYWQucmVzaXphYmxlKXRocm93IG5ldyBFcnJvcihcIk5vIHdpbmRvdyBmb3VuZCBmb3IgZ2l2ZW4gSURcIik7cmV0dXJuIG4ucGF5bG9hZC5yZXNpemFibGV9YXN5bmMgc2V0V2luZG93UmVzaXphYmxlKGUsdCl7Y29uc3Qgbj1cIm51bWJlclwiPT10eXBlb2YgZT97bmF0aXZlV2luZG93SWQ6ZSxyZXNpemFibGU6dH06e2NsaWVudElkOmUscmVzaXphYmxlOnR9O2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJzZXRSZXNpemFibGVcIixwYXlsb2FkOm59KSl9YXN5bmMgZ2V0V2luZG93c0luR3JvdXAoZSl7Y29uc3QgdD1hd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiZ2V0V2luZG93c0luR3JvdXBcIixwYXlsb2FkOntncm91cElkOmV9fSkpO3JldHVybiB0LnBheWxvYWQud2luZG93cz90LnBheWxvYWQud2luZG93cy5tYXAoKGU9Pih7bmF0aXZlSWQ6ZVswXSxjbGllbnRJZDplWzFdfSkpKTpbXX1hc3luYyBnZXRBbGxHcm91cElkcygpe3JldHVybihhd2FpdCh0aGlzLmNsaWVudD8uZGlzcGF0Y2goXCJzbmFwX2FwaV9pbnZva2VcIix7YWN0aW9uOlwiZ2V0QWxsR3JvdXBJZHNcIn0pKSkucGF5bG9hZC5ncm91cElkc31hc3luYyBtaW5pbWl6ZUdyb3VwKGUpe2F3YWl0KHRoaXMuY2xpZW50Py5kaXNwYXRjaChcInNuYXBfYXBpX2ludm9rZVwiLHthY3Rpb246XCJtaW5pbWl6ZUdyb3VwXCIscGF5bG9hZDp7Z3JvdXBJZDplfX0pKX1hc3luYyByZXN0b3JlR3JvdXAoZSl7YXdhaXQodGhpcy5jbGllbnQ/LmRpc3BhdGNoKFwic25hcF9hcGlfaW52b2tlXCIse2FjdGlvbjpcInJlc3RvcmVHcm91cFwiLHBheWxvYWQ6e2dyb3VwSWQ6ZX19KSl9YXN5bmMgaGFuZGxlTmV3V2luZG93KGUpe2NvbnN0IHQ9YXdhaXQgZmluLldpbmRvdy53cmFwKHt1dWlkOmUudXVpZCxuYW1lOmUubmFtZX0pLG49YXdhaXQgdC5nZXROYXRpdmVJZCgpO2xldCBpPXQuaWRlbnRpdHkubmFtZTtjb25zdCBhPWF3YWl0IHQuZ2V0T3B0aW9ucygpO2lmKHZvaWQgMCE9PWEuaW5jbHVkZUluU25hcHNob3RzJiYhMT09PWEuaW5jbHVkZUluU25hcHNob3RzKXJldHVybiB2b2lkIGNvbnNvbGUubG9nKGBTbmFwU0RLOiBOb3QgcmVnaXN0ZXJpbmcgJHtlLnV1aWR9OiR7ZS5uYW1lfSwgV2luZG93IGlzIGV4cGxpY2l0bHkgZXhjbHVkZWQgLWluY2x1ZGVJblNuYXBzaG90cyA9PSBmYWxzZWApO2NvbnN0IHI9YS5jdXN0b21EYXRhfHx7fTtyLnNuYXBDbGllbnRJZD9pPXIuc25hcENsaWVudElkOmF3YWl0IHQudXBkYXRlT3B0aW9ucyh7Y3VzdG9tRGF0YTp7Li4ucixzbmFwQ2xpZW50SWQ6aX19KSxjb25zb2xlLmxvZyhgU25hcFNESzogQXV0by1yZWdpc3RlcmluZyB3aW5kb3c6IHNuYXBDbGllbnRJZDoke2l9LCBoYW5kbGUgJHtufSwgdXVpZDoke2UudXVpZH0sIG5hbWU6JHtlLm5hbWV9YCksYXdhaXQgdGhpcy5yZWdpc3RlcldpbmRvdyhpLG4sci5zbmFwUmVzaXppbmdCZWhhdmlvcil9ZW1pdF9ldmVudChlLC4uLnQpe3RoaXMuZW1pdHRlci5lbWl0KGUsLi4udCl9aGFuZGxlU25hcEV2ZW50cyhlLHQpe3N3aXRjaCh0aGlzLmVtaXRfZXZlbnQoXCJhbGwtZXZlbnRzXCIse3R5cGU6ZS5hY3Rpb24scGF5bG9hZDplLnBheWxvYWR9KSxlLmFjdGlvbil7Y2FzZVwiY2xpZW50UmVnaXN0ZXJlZFwiOnRoaXMuZW1pdF9ldmVudChcImNsaWVudC1yZWdpc3RlcmVkXCIse2NsaWVudElkOmUucGF5bG9hZC5jbGllbnRJZCx3aW5kb3dIYW5kbGU6YCMke2UucGF5bG9hZC53aW5kb3dIYW5kbGUudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCl9YCxvd25pbmdQcm9jZXNzSWQ6ZS5wYXlsb2FkLm93bmluZ1Byb2Nlc3NJZH0pO2JyZWFrO2Nhc2VcImNsaWVudFVuUmVnaXN0ZXJlZFwiOnRoaXMuZW1pdF9ldmVudChcImNsaWVudC11bnJlZ2lzdGVyZWRcIix7Li4uZS5wYXlsb2FkfSk7YnJlYWs7Y2FzZVwibW92ZVNpemVDb21wbGV0ZWRcIjp0aGlzLmVtaXRfZXZlbnQoXCJtb3ZlLXNpemUtY29tcGxldGVkXCIsey4uLmUucGF5bG9hZH0pO2JyZWFrO2Nhc2VcImNsaWVudHNBdHRhY2hlZFwiOnRoaXMuZW1pdF9ldmVudChcImNsaWVudHMtYXR0YWNoZWRcIix7Li4uZS5wYXlsb2FkfSk7YnJlYWs7Y2FzZVwiY2xpZW50RGV0YWNoZWRcIjp0aGlzLmVtaXRfZXZlbnQoXCJjbGllbnQtZGV0YWNoZWRcIix7Li4uZS5wYXlsb2FkfSk7YnJlYWs7Y2FzZVwiZ3JvdXBzQ2hhbmdlZFwiOnRoaXMuZW1pdF9ldmVudChcImdyb3Vwcy1jaGFuZ2VkXCIsey4uLmUucGF5bG9hZH0pO2JyZWFrO2Nhc2VcImNsaWVudEFjdGl2YXRlZFwiOnRoaXMuZW1pdF9ldmVudChcImNsaWVudC1hY3RpdmF0ZWRcIix7Li4uZS5wYXlsb2FkfSk7YnJlYWs7Y2FzZVwiY2xpZW50RGVhY3RpdmF0ZWRcIjp0aGlzLmVtaXRfZXZlbnQoXCJjbGllbnQtZGVhY3RpdmF0ZWRcIix7Li4uZS5wYXlsb2FkfSl9fWFzeW5jIGJ1aWxkX2NvbW1hbmRfbGluZShlKXtsZXQgdD1gLS1pZCAke3RoaXMuc2VydmVyX2lkfSBgO2U/LnNob3dEZWJ1ZyYmKHQrPVwiIC0tc2hvdy1kZWJ1ZyBcIiksZT8uZGlzYWJsZUdQVUFjY2VsZXJhdGVkRHJhZ2dpbmcmJih0Kz1cIiAtLWRpc2FibGUtZ3B1LWFjY2VsZXJhdGVkLWRyYWdnaW5nIHRydWUgXCIpLGU/LmRpc2FibGVCbHVyRHJvcFByZXZpZXcmJih0Kz1cIiAtLWJsdXItZHJvcC1wcmV2aWV3IGZhbHNlIFwiKSx2b2lkIDAhPT1lPy5ibHVyRWZmZWN0UGVyZm9ybWFuY2VUaHJlc2hvbGQmJih0Kz1gIC0tYmx1ci1lZmZlY3QtcGVyZm9ybWFuY2UtdGhyZXNob2xkPSR7ZT8uYmx1ckVmZmVjdFBlcmZvcm1hbmNlVGhyZXNob2xkfSBgKSxlPy5kaXNhYmxlVXNlclVuc3RpY2smJih0Kz1cIiAtLWRpc2FibGUtdXNlci11bnN0aWNrIFwiKSwhMCE9PWU/LmtleVRvU3RpY2smJlwic3RyaW5nXCIhPXR5cGVvZiBlPy5rZXlUb1N0aWNrfHwodCs9YCAtLWtzPSR7ITA9PT1lLmtleVRvU3RpY2s/XCJjdHJsXCI6ZS5rZXlUb1N0aWNrfSBgKSxlPy5rZXlUb1Vuc3RpY2smJih0Kz1gIC0ta3VzPSR7ZS5rZXlUb1Vuc3RpY2t9IGApLGU/LmhpZGVUYXNrYmFyRW50cnkmJih0Kz1cIiAtLW5vLXRiIFwiKSxlPy50YXNrYmFySWNvbkdyb3VwJiYodCs9YCAtLXRiLWlkPSR7ZT8udGFza2Jhckljb25Hcm91cH0gYCksZT8udGFza2Jhckljb24mJih0Kz1gIC0tdGItaWNvbj0ke2U/LnRhc2tiYXJJY29ufSBgKSxlPy5kaXNhYmxlUnVudGltZUhlYXJ0YmVhdGluZyYmKHQrPVwiIC0tbm8taGIgXCIpLGU/LmF1dG9IaWRlQ2xpZW50VGFza2Jhckljb25zJiYodCs9XCIgLS10Yi1hdXRvLWhpZGUgXCIpLGU/LnRoZW1lJiYodCs9YCAtLXRobT0ke2UudGhlbWV9IGApLGU/LmRlZmF1bHRSZXNpemluZ0JlaGF2aW9yJiYodCs9YCAtLXJlcz0ke2U/LmRlZmF1bHRSZXNpemluZ0JlaGF2aW9yfSBgKTtjb25zdCBuPWF3YWl0IGZpbi5TeXN0ZW0uZ2V0UnVudGltZUluZm8oKTtyZXR1cm4gdCs9YC0tcnVudGltZS1wb3J0ICR7bi5wb3J0fSBgLHQrPWAtLXJ1bnRpbWUtdmVyc2lvbiAke24udmVyc2lvbn0gYCx0LnRyaW0oKX19Y29uc3QgZD1hc3luYyBlPT57bGV0IHQ9KGF3YWl0IGZpbi5TeXN0ZW0uZ2V0UnVudGltZUluZm8oKSkuYXJnc1tcImxvY2FsLXN0YXJ0dXAtdXJsXCJdLnJlcGxhY2UoXCJjb25maWcuanNvblwiLFwiXCIpO2NvbnN0IG49dC5pbmNsdWRlcyhcIlxcXFxcIik/XCJcXFxcXCI6XCIvXCI7cmV0dXJuIHQuZW5kc1dpdGgobikmJih0PXQuc2xpY2UoMCwtMSkpLFt0LFwiYXNzZXRzXCIsZS5hbGlhcyxlLnZlcnNpb24sZS50YXJnZXRdLmpvaW4obil9LHU9KCk9PlwidW5kZWZpbmVkXCIhPXR5cGVvZiBjcnlwdG8mJlwicmFuZG9tVVVJRFwiaW4gY3J5cHRvJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBjcnlwdG8ucmFuZG9tVVVJRD9jcnlwdG8ucmFuZG9tVVVJRCgpOlwiMTAwMDAwMDAtMTAwMC00MDAwLTgwMDAtMTAwMDAwMDAwMDAwXCIucmVwbGFjZSgvWzAxOF0vZywoZT0+KGVeY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSgxKSlbMF0mMTU+PmUvNCkudG9TdHJpbmcoMTYpKSksaD1lPT4vXmFwcDpcXC9bXi9dK1xcL1teL10rJC8udGVzdChlPz9cIlwiKSxmPWU9Pntjb25zdCB0PW5ldyBNYXA7cmV0dXJuIGUuZm9yRWFjaCgoZT0+e2NvbnN0IG49IWUubmFtZSxpPWUubmFtZT8uc3RhcnRzV2l0aChwKT8/ITEsYT1lLmN1c3RvbURhdGE/LnNuYXBDbGllbnRJZDsobnx8aXx8aChlLm5hbWUpKSYmYSYmdC5zZXQoYSxlKX0pKSx0fSx5PShlLHQsbik9PntPYmplY3QudmFsdWVzKGUpLmZvckVhY2goKGU9PntlLmF0dGFjaGVkQ2xpZW50SWQ9PT10P2UuYXR0YWNoZWRDbGllbnRJZD1uOmUudGFyZ2V0Q2xpZW50SWQ9PT10JiYoZS50YXJnZXRDbGllbnRJZD1uKX0pKX0sdj1lPT57aWYoIWgoZSkpcmV0dXJuYCR7cH0ke3UoKX1gO2NvbnN0IHQ9ZS5zcGxpdChcIi9cIik7cmV0dXJuIHRbdC5sZW5ndGgtMV09dSgpLHQuam9pbihcIi9cIil9O3ZhciB3PWkucTtleHBvcnR7dyBhcyBTbmFwU2VydmVyfTsiLCJpbXBvcnQgdHlwZSBPcGVuRmluIGZyb20gXCJAb3BlbmZpbi9jb3JlXCI7XG5pbXBvcnQgKiBhcyBTbmFwIGZyb20gXCJAb3BlbmZpbi9zbmFwLXNka1wiO1xuaW1wb3J0IHsgZ2V0U2V0dGluZ3MgfSBmcm9tIFwiLi4vc2V0dGluZ3NcIjtcbmltcG9ydCB0eXBlIHsgU25hcFByb3ZpZGVyT3B0aW9ucyB9IGZyb20gXCIuLi9zaGFwZXNcIjtcblxuLyoqXG4gKiBJbml0aWFsaXplIHRoZSBzbmFwIGNvbXBvbmVudHMuXG4gKiBAcGFyYW0gb3B0aW9ucyBUaGUgb3B0aW9ucyBmb3IgaW5pdGlhbGl6aW5nIHRoZSBzbmFwIHByb3ZpZGVyLlxuICogQHBhcmFtIGNyZWF0ZUxheW91dENoYW5uZWwgV2hldGhlciB0byBjcmVhdGUgYSBzaW1wbGUgY2hhbm5lbCBhcGkgc2VydmljZSB0aGF0IGV4cG9zZXMgdGhlIGdldExheW91dCBhbmQgYXBwbHlMYXlvdXQgZnVuY3Rpb25hbGl0eSBvZiBzbmFwLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZShcblx0b3B0aW9uczogU25hcFByb3ZpZGVyT3B0aW9ucyxcblx0Y3JlYXRlTGF5b3V0Q2hhbm5lbDogYm9vbGVhbiA9IGZhbHNlXG4pOiBQcm9taXNlPHZvaWQ+IHtcblx0Y29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBnZXRTZXR0aW5ncygpO1xuXHRjb25zdCBzZXR0aW5nc1NlcnZlck9wdGlvbnMgPSBzZXR0aW5ncz8uc2VydmVyT3B0aW9ucyA/PyB7fTtcblx0Y29uc3QgcGFzc2VkT3B0aW9ucyA9IG9wdGlvbnM/LnNlcnZlck9wdGlvbnMgPz8ge307XG5cdGNvbnN0IGZpbmFsT3B0aW9ucyA9IHsgLi4uc2V0dGluZ3NTZXJ2ZXJPcHRpb25zLCAuLi5wYXNzZWRPcHRpb25zIH07XG5cdGNvbnN0IGZpbmFsUGxhdGZvcm1JZCA9IG9wdGlvbnM/LnBsYXRmb3JtSWQgPz8gc2V0dGluZ3M/LnBsYXRmb3JtSWQ7XG5cdHRyeSB7XG5cdFx0aWYgKGZpbmFsUGxhdGZvcm1JZCkge1xuXHRcdFx0Y29uc29sZS5sb2coXCJSZWdpc3RlcmluZyBTbmFwIHdpdGggcGxhdGZvcm1JZFwiLCBmaW5hbFBsYXRmb3JtSWQpO1xuXHRcdFx0Y29uc3Qgc2VydmVyID0gbmV3IFNuYXAuU25hcFNlcnZlcihmaW5hbFBsYXRmb3JtSWQpO1xuXHRcdFx0Y29uc29sZS5sb2coXCJFbmFibGluZyBkZWJ1ZyB3aW5kb3c6XCIsIGZpbmFsT3B0aW9ucy5zaG93RGVidWcgPz8gZmFsc2UpO1xuXHRcdFx0YXdhaXQgc2VydmVyLnN0YXJ0KGZpbmFsT3B0aW9ucyk7XG5cdFx0XHRpZiAoY3JlYXRlTGF5b3V0Q2hhbm5lbCkge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdGNvbnN0IGNoYW5uZWxOYW1lID0gYCR7ZmluLm1lLmlkZW50aXR5LnV1aWR9LXNuYXAtbGF5b3V0YDtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhgQ2hhbm5lbCBTZXJ2aWNlOiBDcmVhdGluZyBzbmFwIHByZWxvYWQgbGF5b3V0IGNoYW5uZWw6ICR7Y2hhbm5lbE5hbWV9YCk7XG5cdFx0XHRcdFx0Y29uc3QgY2hhbm5lbCA9IGF3YWl0IGZpbi5JbnRlckFwcGxpY2F0aW9uQnVzLkNoYW5uZWwuY3JlYXRlKGNoYW5uZWxOYW1lKTtcblx0XHRcdFx0XHRjaGFubmVsLnJlZ2lzdGVyKFwiZ2V0TGF5b3V0XCIsIGFzeW5jICgpID0+IHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBTZXJ2aWNlOiBHZXR0aW5nIGxheW91dCBmcm9tIFNuYXBcIik7XG5cdFx0XHRcdFx0XHRjb25zdCBsYXlvdXQgPSBhd2FpdCBzZXJ2ZXIuZ2V0TGF5b3V0KCk7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgU2VydmljZTogR290IGxheW91dCBmcm9tIFNuYXBcIiwgbGF5b3V0KTtcblx0XHRcdFx0XHRcdHJldHVybiBsYXlvdXQ7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0Y2hhbm5lbC5yZWdpc3RlcihcImFwcGx5TGF5b3V0XCIsIGFzeW5jIChwYXlsb2FkOiB1bmtub3duKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgU2VydmljZTogQXBwbHlpbmcgbGF5b3V0IHRvIFNuYXBcIiwgcGF5bG9hZCk7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgU2VydmljZTogUHJlcGFyaW5nIHRvIGFwcGx5IHNuYXBzaG90XCIpO1xuXHRcdFx0XHRcdFx0YXdhaXQgc2VydmVyLnByZXBhcmVUb0FwcGx5U25hcHNob3QoKTtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBTZXJ2aWNlOiBBcHBseWluZyBzbmFwc2hvdFwiKTtcblx0XHRcdFx0XHRcdGF3YWl0IHNlcnZlci5hcHBseVNuYXBzaG90KHBheWxvYWQgYXMgU25hcC5TbmFwU25hcHNob3QpO1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIFNlcnZpY2U6IEFwcGxpZWQgc25hcHNob3RcIik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0Y2hhbm5lbC5vbkNvbm5lY3Rpb24oYXN5bmMgKGlkZW50aXR5KSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkNoYW5uZWwgU2VydmljZTogQ29ubmVjdGlvbiByZXF1ZXN0IGZyb206XCIsIGlkZW50aXR5KTtcblx0XHRcdFx0XHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItdGVtcGxhdGVcblx0XHRcdFx0XHRcdGlmIChpZGVudGl0eS51dWlkICE9PSBmaW4ubWUuaWRlbnRpdHkudXVpZCkge1xuXHRcdFx0XHRcdFx0XHRjb25zdCBtZXNzYWdlID0gYENoYW5uZWwgU2VydmljZTogUmVqZWN0aW5nIGNvbm5lY3Rpb24gcmVxdWVzdCBhcyBpdCBpcyBub3QgY29taW5nIGZyb20gd2l0aGluIHRoZSBhcHBsaWNhdGlvbi4gSWRlbnRpdHkgc2hvdWxkIGJlOiAke2Zpbi5tZS5pZGVudGl0eS51dWlkfSBhbmQgY29ubmVjdGlvbiByZXF1ZXN0IGlzIGNvbWluZyBmcm9tOiAke2lkZW50aXR5LnV1aWR9YDtcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcihtZXNzYWdlKTtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGNoYW5uZWwub25EaXNjb25uZWN0aW9uKGFzeW5jIChpZGVudGl0eSkgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIFNlcnZpY2U6IERpc2Nvbm5lY3Rpb24gcmVxdWVzdCBmcm9tOlwiLCBpZGVudGl0eSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcblx0XHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFxuXHRcdFx0XHRcdFx0XHRcdFwiQ2hhbm5lbCBDbGllbnQ6IENvbm5lY3RpbmcgdG8gc25hcCBwcmVsb2FkIGxheW91dCBjaGFubmVsIHRvIHZhbGlkYXRlIGNvbm5lY3Rpb24uXCJcblx0XHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdFx0Y29uc3QgY2xpZW50Q2hhbm5lbE5hbWUgPSBgJHtmaW4ubWUuaWRlbnRpdHkudXVpZH0tc25hcC1sYXlvdXRgO1xuXHRcdFx0XHRcdFx0XHRjb25zdCBzbmFwUHJlbG9hZENsaWVudCA9IGF3YWl0IGZpbi5JbnRlckFwcGxpY2F0aW9uQnVzLkNoYW5uZWwuY29ubmVjdChjbGllbnRDaGFubmVsTmFtZSk7XG5cblx0XHRcdFx0XHRcdFx0Ly8gZmV0Y2ggdGhlIGN1cnJlbnQgc25hcCBsYXlvdXRcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIENsaWVudDogUmVxdWVzdGluZyBsYXlvdXQgZnJvbSBTbmFwXCIpO1xuXHRcdFx0XHRcdFx0XHRjb25zdCBsYXlvdXQgPSAoYXdhaXQgc25hcFByZWxvYWRDbGllbnQuZGlzcGF0Y2goXCJnZXRMYXlvdXRcIikpIGFzIFNuYXAuU25hcExheW91dDtcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIENsaWVudDogR290IGxheW91dCBmcm9tIFNuYXBcIiwgbGF5b3V0KTtcblxuXHRcdFx0XHRcdFx0XHQvLyBhcHBseSB0aGUgbGF5b3V0XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBDbGllbnQ6IEFwcGx5aW5nIGxheW91dCB0byBTbmFwXCIpO1xuXHRcdFx0XHRcdFx0XHRhd2FpdCBzbmFwUHJlbG9hZENsaWVudC5kaXNwYXRjaChcImFwcGx5TGF5b3V0XCIsIGxheW91dCk7XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQ2hhbm5lbCBDbGllbnQ6IEFwcGxpZWQgbGF5b3V0IHRvIFNuYXBcIik7XG5cblx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDaGFubmVsIENsaWVudDogSW50ZW50aW9uYWxseSBkaXNjb25uZWN0aW5nIGZyb20gc25hcCBwcmVsb2FkIENoYW5uZWwgU2VydmljZVwiKTtcblx0XHRcdFx0XHRcdFx0YXdhaXQgc25hcFByZWxvYWRDbGllbnQuZGlzY29ubmVjdCgpO1xuXHRcdFx0XHRcdFx0fSBjYXRjaCAoY2xpZW50RXJyb3IpIHtcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFx0XHRcdFx0XHRcIkNoYW5uZWwgQ2xpZW50OiBFcnJvciBjb25uZWN0aW5nIHRvIHNuYXAgcHJlbG9hZCBsYXlvdXQgQ2hhbm5lbCBTZXJ2aWNlXCIsXG5cdFx0XHRcdFx0XHRcdFx0Y2xpZW50RXJyb3Jcblx0XHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9LCAxMDAwKTtcblx0XHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcIkNoYW5uZWwgU2VydmljZTogRXJyb3IgY3JlYXRpbmcgc25hcCBsYXlvdXQgY2hhbm5lbFwiLCBlcnIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRjb25zdCBhcHAgPSBmaW4uQXBwbGljYXRpb24uZ2V0Q3VycmVudFN5bmMoKTtcblx0XHRcdGF3YWl0IGFwcC5vbihcIndpbmRvdy1jcmVhdGVkXCIsIGFzeW5jIChlKSA9PiB7XG5cdFx0XHRcdGNvbnN0IHdpbiA9IGZpbi5XaW5kb3cud3JhcFN5bmMoZSk7XG5cdFx0XHRcdGNvbnN0IHdpbk9wdGlvbnMgPSBhd2FpdCB3aW4uZ2V0T3B0aW9ucygpO1xuXHRcdFx0XHRpZiAoIXdpbk9wdGlvbnMuaW5jbHVkZUluU25hcHNob3RzKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJXaW5kb3cgaXMgbm90IHJlZ2lzdGVyZWQgd2l0aCBTbmFwIGJlY2F1c2UgaW5jbHVkZUluU25hcHNob3RzIGlzIGRpc2FibGVkLlwiKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zdCBuYXRpdmVJZCA9IGF3YWl0IHdpbi5nZXROYXRpdmVJZCgpO1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiUmVnaXN0ZXJpbmcgd2luZG93IHdpdGggTmF0aXZlSUQgd2l0aCBTbmFwXCIsIG5hdGl2ZUlkKTtcblx0XHRcdFx0XHRhd2FpdCBzZXJ2ZXIucmVnaXN0ZXJXaW5kb3cod2luLmlkZW50aXR5Lm5hbWUsIG5hdGl2ZUlkKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRjb25zdCBob3N0T3B0aW9ucyA9IChhd2FpdCBmaW4ubWUuZ2V0T3B0aW9ucygpKSBhcyBPcGVuRmluLldpbmRvd09wdGlvbnM7XG5cdFx0XHRpZiAoaG9zdE9wdGlvbnMuYXV0b1Nob3cpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coXCJSZWdpc3RlcmluZyBjdXJyZW50IHdpbmRvdyB3aXRoIHNuYXBcIik7XG5cdFx0XHRcdGF3YWl0IHNlcnZlci5yZWdpc3RlcldpbmRvdyhmaW4ubWUuaWRlbnRpdHkubmFtZSwgYXdhaXQgZmluLldpbmRvdy5nZXRDdXJyZW50U3luYygpLmdldE5hdGl2ZUlkKCkpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS5sb2coXCJDdXJyZW50IHdpbmRvdyBpcyBub3QgcmVnaXN0ZXJlZCB3aXRoIFNuYXAgYmVjYXVzZSBhdXRvU2hvdyBpcyBkaXNhYmxlZC5cIik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9IGNhdGNoIChlcnIpIHtcblx0XHRjb25zb2xlLmVycm9yKFwiRXJyb3IgaW5pdGlhbGl6aW5nIFNuYXBcIiwgZXJyKTtcblx0fVxufVxuIiwiaW1wb3J0IHR5cGUgeyBPcGVuRmluIH0gZnJvbSBcIkBvcGVuZmluL2NvcmVcIjtcbmltcG9ydCB0eXBlIHsgQ3VzdG9tU2V0dGluZ3MsIFNuYXBQcm92aWRlck9wdGlvbnMgfSBmcm9tIFwiLi9zaGFwZXNcIjtcblxuLyoqXG4gKiBHZXRzIHNldHRpbmdzIGZyb20gdGhlIG1hbmlmZXN0LlxuICogQHBhcmFtIHNob3dEZWJ1Z1dpbmRvdyBXaGV0aGVyIHRvIGVuYWJsZSB0aGUgZGVidWcgd2luZG93IHJlZ2FyZGxlc3Mgb2YgbWFuaWZlc3Qgc2V0dGluZ3MuXG4gKiBAcmV0dXJucyBUaGUgc25hcCBwcm92aWRlciBvcHRpb25zIGZyb20gdGhlIG1hbmlmZXN0LlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2V0dGluZ3Moc2hvd0RlYnVnV2luZG93PzogYm9vbGVhbik6IFByb21pc2U8U25hcFByb3ZpZGVyT3B0aW9ucz4ge1xuXHRjb25zdCBhcHAgPSBhd2FpdCBmaW4uQXBwbGljYXRpb24uZ2V0Q3VycmVudCgpO1xuXHRjb25zdCBtYW5pZmVzdCA9IGF3YWl0IGFwcC5nZXRNYW5pZmVzdCgpO1xuXHRpZiAobWFuaWZlc3QuYXBwQXNzZXRzPy5bMF0/LnNyYyA9PT0gXCJTTkFQX0FTU0VUX1VSTFwiKSB7XG5cdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFwiUGxlYXNlIHJlcXVlc3QgdGhlIFNOQVBfQVNTRVRfVVJMIGZyb20gT3BlbkZpbiBhbmQgdXBkYXRlIG1hbmlmZXN0LmZpbi5qc29uIGJlZm9yZSBydW5uaW5nIHRoZSBzYW1wbGVcIlxuXHRcdCk7XG5cdH1cblx0Y29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBnZXRNYW5pZmVzdEN1c3RvbVNldHRpbmdzKG1hbmlmZXN0KTtcblx0c2V0dGluZ3Muc25hcFByb3ZpZGVyID8/PSB7fTtcblx0aWYgKHNldHRpbmdzLnNuYXBQcm92aWRlci5zZXJ2ZXJPcHRpb25zID09PSB1bmRlZmluZWQpIHtcblx0XHRzZXR0aW5ncy5zbmFwUHJvdmlkZXIuc2VydmVyT3B0aW9ucyA9IHtcblx0XHRcdHNob3dEZWJ1Zzogc2hvd0RlYnVnV2luZG93XG5cdFx0fTtcblx0fVxuXHRyZXR1cm4gc2V0dGluZ3Muc25hcFByb3ZpZGVyO1xufVxuXG4vKipcbiAqIFJlYWQgdGhlIGN1c3RvbSBzZXR0aW5ncyBmcm9tIHRoZSBtYW5pZmVzdC5maW4uanNvbi5cbiAqIEBwYXJhbSBtYW5pZmVzdCBUaGUgbWFuaWZlc3QgdG8gbG9hZCB0aGUgY3VzdG9tIHNldHRpbmdzIGZyb20uXG4gKiBAcmV0dXJucyBUaGUgY3VzdG9tIHNldHRpbmdzIGZyb20gdGhlIG1hbmlmZXN0LlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRNYW5pZmVzdEN1c3RvbVNldHRpbmdzKG1hbmlmZXN0OiBPcGVuRmluLk1hbmlmZXN0KTogUHJvbWlzZTxDdXN0b21TZXR0aW5ncz4ge1xuXHRyZXR1cm4gKG1hbmlmZXN0IGFzIE9wZW5GaW4uTWFuaWZlc3QgJiB7IGN1c3RvbVNldHRpbmdzPzogQ3VzdG9tU2V0dGluZ3MgfSkuY3VzdG9tU2V0dGluZ3MgPz8ge307XG59XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsImltcG9ydCB7IGluaXRpYWxpemUgfSBmcm9tIFwiLi9wcmVsb2FkLmNvbW1vblwiO1xuXG5pZiAod2luZG93ID09PSB3aW5kb3cudG9wKSB7XG5cdGNvbnNvbGUubG9nKFwiQWRkaW5nIHNuYXAgc3VwcG9ydCB0aHJvdWdoIGEgcHJlbG9hZC5cIik7XG5cblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGFzeW5jICgpID0+IHtcblx0XHRhd2FpdCBpbml0aWFsaXplKHsgcGxhdGZvcm1JZDogZmluLm1lLmlkZW50aXR5LnV1aWQgfSk7XG5cdH0pO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9