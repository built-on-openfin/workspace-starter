var e={};function t(e){return null==e}e.d=(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const a={share:new class{async initialize(e,t,a){this._definition=e,this._logger=t("WorkspacesShareProvider"),this._helpers=a,this._logger.info("Initializing")}async closedown(){this._logger?.info("Closedown")}async getShareTypes(){return["workspace"]}async getEntries(e){return[{label:"Share Workspace",type:"workspace",payload:{windowIdentity:e}}]}async share(e,a){if("workspace"===e){const i=await(this._helpers?.getPlatform?.());if(i){let s;const r=a?.workspaceId;if(s=t(r)?await i.getCurrentWorkspace():await i.Storage.getWorkspace(r),!t(s)){const r=await async function(e,a,i,s,r,n){if(t(i))a?.warn("Endpoint client is not available.");else if(t(i.requestResponse))a?.warn("Endpoint client requestResponse is not available.");else{if(!t(s)){try{const l=24,h=await i.requestResponse(s,{type:r,data:n});if(h){let i=h.id;if(t(i)){const e=h.url.lastIndexOf("/");-1!==e&&(i=h.url.slice(e+1))}if(!t(i)){const t=await e.Application.getInfo();let s;if(t.manifestUrl.startsWith("http")?s=`${t.manifestUrl.replace("http","fin")}?$$shareType=${r}&$$payload=${btoa(JSON.stringify({id:i}))}`:a?.error("We do not support file based manifest launches. The manifest has to be served over http/https:",t.manifestUrl),function(e){return null!=e&&"string"==typeof e}(o=s)&&o.trim().length>0)return await fin.Clipboard.writeText({data:s}),{title:"Share Request Raised",message:`The share request you raised has been copied to the **clipboard** and will be valid for ${l} hours. \n Share Url: \n * **${s}**`,status:"shared"}}}}catch(e){a?.error("Error saving share request:",e)}return{title:"Share Request Failed",message:"The share request you raised could not be generated.",status:"error"}}a?.warn("Endpoint id is not available.")}var o}(i,this._logger,await(this._helpers?.getEndpointClient?.()),this._definition?.data?.setEndpointId,e,s);await this.showConfirmation(r,a?.windowIdentity)}}}}async handle(e,a){if("workspace"===e){const i=await async function(e,a,i,s,r){if(t(a))e?.warn("Endpoint client is not available.");else if(t(a.requestResponse))e?.warn("Endpoint client requestResponse is not available.");else{if(!t(i)){try{const i=await a.requestResponse("share-get",{id:r});return t(i)?{confirmation:{title:"Share Load Expired",message:"The share request has expired and is no longer available.",status:"error"}}:s!==i.type?(e?.warn(`Share entry of mismatched type specified: ${i.type} it should be ${s}`),{confirmation:{title:"Share Load Failed",message:"The specified share link does not contain the correct data for the share type.",status:"error"}}):{payload:i.data,confirmation:{title:"Share Request Applied",message:"The share request has been fetched and applied.",status:"loaded"}}}catch(t){e?.error("There has been an error trying to load and apply the share link.",t)}return{confirmation:{title:"Share Load Failed",message:"The specified share link cannot be loaded.",status:"error"}}}e?.warn("Endpoint id is not available.")}}(this._logger,await(this._helpers?.getEndpointClient?.()),this._definition?.data?.getEndpointId,e,a.id),s=await(this._helpers?.getPlatform?.());if(s){const e=i?.payload;!t(e)&&this._helpers?.launchWorkspace&&(await s.Storage.saveWorkspace(e),await this._helpers.launchWorkspace(e.workspaceId,this._logger))}await this.showConfirmation(i?.confirmation)}}async showConfirmation(e,a){if(!t(e)&&this._helpers?.getShareClient){this._logger?.info(e);const i=await this._helpers.getShareClient();if(i){const s="error"===e.status?"error":"success";if(e.iconUrl=this._definition?.data?.images[s],this._helpers?.getThemeClient&&!t(e.iconUrl)){const t=await this._helpers.getThemeClient();e.iconUrl=await t.themeUrl(e.iconUrl)}await i.confirmation(e,this._definition?.data?.confirmationMode,a)}}}}};export{a as entryPoints};
//# sourceMappingURL=workspaces.bundle.js.map