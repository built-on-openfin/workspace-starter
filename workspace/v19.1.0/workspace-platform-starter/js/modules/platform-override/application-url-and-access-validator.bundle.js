var e={d:(n,t)=>{for(var s in t)e.o(t,s)&&!e.o(n,s)&&Object.defineProperty(n,s,{enumerable:!0,get:t[s]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)},n={};e.d(n,{k:()=>t});const t={platformOverride:new class{async initialize(e,n,t){this._definition=e,this._logger=n("ApplicationUrlAndAccessValidatorPlatformOverride"),this._helpers=t,this._logger.info("Initializing")}async closedown(){this._logger?.info("Closedown")}async getConstructorOverride(e){return n=>{if(void 0===this._helpers)throw new Error("Helpers are required for the the application validator platform override. Please ensure that the platform has been initialized correctly.");const t=this._definition?.data??{},s=this._logger,r=this._helpers,i=r.getUtilClient(),a={},o=i.general.isStringValue,l=i.general.isEmpty,p=i.general.randomUUID;return class extends n{constructor(){super(),s?.info(`Options passed: ${JSON.stringify(e)} and module data: ${JSON.stringify(t)} with session id: ${r.sessionId}`)}async getSavedPage(e){s?.info(`Requesting saved page with id: ${e}`);const n=await super.getSavedPage(e);if(n){s?.info(`Processing page layout for page with id: ${e}`);const t=await this.validateAppUrlAndAccess(n.layout);n.layout=JSON.parse(t)}return n}async applySnapshot(e,n){s?.info("Processing snapshot windows for app url changes or access updates");const t=await this.validateAppUrlAndAccess(e.snapshot.windows);return e.snapshot.windows=JSON.parse(t),s?.info("Passing processed snapshot to base applySnapshot."),super.applySnapshot(e,n)}async validateAppUrlAndAccess(e){const n={},s={};let i;const c=[];r.getApps&&c.push(...await r.getApps());let f=JSON.stringify(e,((e,r)=>{if(Array.isArray(r))return r;if(o(r?.name)&&!r.name.startsWith("internal-generated-")&&!l(r.url)){const e=r.name.split("/")[0];let a;if(i={exists:!1},n[e])i=n[e];else{if(a=c.find((n=>n.appId===e)),a)if(i={exists:!0},"window"===a.launchPreference?.options?.type)Array.isArray(a.launchPreference.options?.updatable)&&a.launchPreference.options?.updatable.findIndex((e=>"url"===e.name))>-1?i={exists:!0}:a.launchPreference.options.window?.url&&(i={url:a.launchPreference.options.window.url,exists:!0});else if("view"===a.launchPreference?.options?.type)Array.isArray(a.launchPreference.options?.updatable)&&a.launchPreference.options?.updatable.findIndex((e=>"url"===e.name))>-1?i={exists:!0}:a.launchPreference.options.view?.url&&(i={url:a.launchPreference.options.view.url,exists:!0});else if("inline-view"!==a?.manifestType&&"inline-window"!==a?.manifestType||!a.manifest.url){if("view"===a?.manifestType||"window"===a?.manifestType){const e=`[[${a.appId}]]`;if(l(s[e])){const n={manifest:a.manifest,originalUrl:r.url};s[e]=n}i={url:`[[${a.appId}]]`,exists:!0}}}else i={url:a.manifest.url,exists:!0};else i={exists:!1};n[e]=i}i.exists?r.url=i.url??r.url:t.deniedAccessUrl&&(r.url=t.deniedAccessUrl,r.customData={appId:e},r.name=`internal-generated-${p()}`)}return r}));const d=Object.keys(s);if(d.length>0)for(const e of d){const n=a[e];let t=s[e].originalUrl;l(n)||n.manifest!==s[e].manifest?(t=await this.getUrlFromManifest(s[e].manifest,s[e].originalUrl),a[e]={manifest:s[e].manifest,url:t}):t=n.url,f=f.replaceAll(e,t)}return f}async getUrlFromManifest(e,n){try{const t=await fin.System.fetchManifest(e);return t.url?t.url:(s?.warn(`No url found in manifest for ${n}`),n)}catch(e){return s?.error(`Error fetching manifest for ${n}`,e),n}}}}}}};var s=n.k;export{s as entryPoints};
//# sourceMappingURL=application-url-and-access-validator.bundle.js.map